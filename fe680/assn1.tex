\documentclass[11pt]{article}

    \usepackage[breakable]{tcolorbox}
    \usepackage{parskip} % Stop auto-indenting (to mimic markdown behaviour)
    

    % Basic figure setup, for now with no caption control since it's done
    % automatically by Pandoc (which extracts ![](path) syntax from Markdown).
    \usepackage{graphicx}
    % Keep aspect ratio if custom image width or height is specified
    \setkeys{Gin}{keepaspectratio}
    % Maintain compatibility with old templates. Remove in nbconvert 6.0
    \let\Oldincludegraphics\includegraphics
    % Ensure that by default, figures have no caption (until we provide a
    % proper Figure object with a Caption API and a way to capture that
    % in the conversion process - todo).
    \usepackage{caption}
    \DeclareCaptionFormat{nocaption}{}
    \captionsetup{format=nocaption,aboveskip=0pt,belowskip=0pt}

    \usepackage{float}
    \floatplacement{figure}{H} % forces figures to be placed at the correct location
    \usepackage{xcolor} % Allow colors to be defined
    \usepackage{enumerate} % Needed for markdown enumerations to work
    \usepackage{geometry} % Used to adjust the document margins
    \usepackage{amsmath} % Equations
    \usepackage{amssymb} % Equations
    \usepackage{textcomp} % defines textquotesingle
    % Hack from http://tex.stackexchange.com/a/47451/13684:
    \AtBeginDocument{%
        \def\PYZsq{\textquotesingle}% Upright quotes in Pygmentized code
    }
    \usepackage{upquote} % Upright quotes for verbatim code
    \usepackage{eurosym} % defines \euro

    \usepackage{iftex}
    \ifPDFTeX
        \usepackage[T1]{fontenc}
        \IfFileExists{alphabeta.sty}{
              \usepackage{alphabeta}
          }{
              \usepackage[mathletters]{ucs}
              \usepackage[utf8x]{inputenc}
          }
    \else
        \usepackage{fontspec}
        \usepackage{unicode-math}
    \fi

    \usepackage{fancyvrb} % verbatim replacement that allows latex
    \usepackage{grffile} % extends the file name processing of package graphics
                         % to support a larger range
    \makeatletter % fix for old versions of grffile with XeLaTeX
    \@ifpackagelater{grffile}{2019/11/01}
    {
      % Do nothing on new versions
    }
    {
      \def\Gread@@xetex#1{%
        \IfFileExists{"\Gin@base".bb}%
        {\Gread@eps{\Gin@base.bb}}%
        {\Gread@@xetex@aux#1}%
      }
    }
    \makeatother
    \usepackage[Export]{adjustbox} % Used to constrain images to a maximum size
    \adjustboxset{max size={0.9\linewidth}{0.9\paperheight}}

    % The hyperref package gives us a pdf with properly built
    % internal navigation ('pdf bookmarks' for the table of contents,
    % internal cross-reference links, web links for URLs, etc.)
    \usepackage{hyperref}
    % The default LaTeX title has an obnoxious amount of whitespace. By default,
    % titling removes some of it. It also provides customization options.
    \usepackage{titling}
    \usepackage{longtable} % longtable support required by pandoc >1.10
    \usepackage{booktabs}  % table support for pandoc > 1.12.2
    \usepackage{array}     % table support for pandoc >= 2.11.3
    \usepackage{calc}      % table minipage width calculation for pandoc >= 2.11.1
    \usepackage[inline]{enumitem} % IRkernel/repr support (it uses the enumerate* environment)
    \usepackage[normalem]{ulem} % ulem is needed to support strikethroughs (\sout)
                                % normalem makes italics be italics, not underlines
    \usepackage{soul}      % strikethrough (\st) support for pandoc >= 3.0.0
    \usepackage{mathrsfs}
    

    
    % Colors for the hyperref package
    \definecolor{urlcolor}{rgb}{0,.145,.698}
    \definecolor{linkcolor}{rgb}{.71,0.21,0.01}
    \definecolor{citecolor}{rgb}{.12,.54,.11}

    % ANSI colors
    \definecolor{ansi-black}{HTML}{3E424D}
    \definecolor{ansi-black-intense}{HTML}{282C36}
    \definecolor{ansi-red}{HTML}{E75C58}
    \definecolor{ansi-red-intense}{HTML}{B22B31}
    \definecolor{ansi-green}{HTML}{00A250}
    \definecolor{ansi-green-intense}{HTML}{007427}
    \definecolor{ansi-yellow}{HTML}{DDB62B}
    \definecolor{ansi-yellow-intense}{HTML}{B27D12}
    \definecolor{ansi-blue}{HTML}{208FFB}
    \definecolor{ansi-blue-intense}{HTML}{0065CA}
    \definecolor{ansi-magenta}{HTML}{D160C4}
    \definecolor{ansi-magenta-intense}{HTML}{A03196}
    \definecolor{ansi-cyan}{HTML}{60C6C8}
    \definecolor{ansi-cyan-intense}{HTML}{258F8F}
    \definecolor{ansi-white}{HTML}{C5C1B4}
    \definecolor{ansi-white-intense}{HTML}{A1A6B2}
    \definecolor{ansi-default-inverse-fg}{HTML}{FFFFFF}
    \definecolor{ansi-default-inverse-bg}{HTML}{000000}

    % common color for the border for error outputs.
    \definecolor{outerrorbackground}{HTML}{FFDFDF}

    % commands and environments needed by pandoc snippets
    % extracted from the output of `pandoc -s`
    \providecommand{\tightlist}{%
      \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
    \DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
    % Add ',fontsize=\small' for more characters per line
    \newenvironment{Shaded}{}{}
    \newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{{#1}}}
    \newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{{#1}}}}
    \newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{{#1}}}
    \newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{{#1}}}
    \newcommand{\RegionMarkerTok}[1]{{#1}}
    \newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\NormalTok}[1]{{#1}}

    % Additional commands for more recent versions of Pandoc
    \newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.53,0.00,0.00}{{#1}}}
    \newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.73,0.40,0.53}{{#1}}}
    \newcommand{\ImportTok}[1]{{#1}}
    \newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.73,0.13,0.13}{\textit{{#1}}}}
    \newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\VariableTok}[1]{\textcolor[rgb]{0.10,0.09,0.49}{{#1}}}
    \newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.40,0.40,0.40}{{#1}}}
    \newcommand{\BuiltInTok}[1]{{#1}}
    \newcommand{\ExtensionTok}[1]{{#1}}
    \newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.74,0.48,0.00}{{#1}}}
    \newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.49,0.56,0.16}{{#1}}}
    \newcommand{\InformationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\WarningTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \makeatletter
    \newsavebox\pandoc@box
    \newcommand*\pandocbounded[1]{%
      \sbox\pandoc@box{#1}%
      % scaling factors for width and height
      \Gscale@div\@tempa\textheight{\dimexpr\ht\pandoc@box+\dp\pandoc@box\relax}%
      \Gscale@div\@tempb\linewidth{\wd\pandoc@box}%
      % select the smaller of both
      \ifdim\@tempb\p@<\@tempa\p@
        \let\@tempa\@tempb
      \fi
      % scaling accordingly (\@tempa < 1)
      \ifdim\@tempa\p@<\p@
        \scalebox{\@tempa}{\usebox\pandoc@box}%
      % scaling not needed, use as it is
      \else
        \usebox{\pandoc@box}%
      \fi
    }
    \makeatother

    % Define a nice break command that doesn't care if a line doesn't already
    % exist.
    \def\br{\hspace*{\fill} \\* }
    % Math Jax compatibility definitions
    \def\gt{>}
    \def\lt{<}
    \let\Oldtex\TeX
    \let\Oldlatex\LaTeX
    \renewcommand{\TeX}{\textrm{\Oldtex}}
    \renewcommand{\LaTeX}{\textrm{\Oldlatex}}
    % Document parameters
    % Document title
    \title{assn1}
    
    
    
    
    
    
    
% Pygments definitions
\makeatletter
\def\PY@reset{\let\PY@it=\relax \let\PY@bf=\relax%
    \let\PY@ul=\relax \let\PY@tc=\relax%
    \let\PY@bc=\relax \let\PY@ff=\relax}
\def\PY@tok#1{\csname PY@tok@#1\endcsname}
\def\PY@toks#1+{\ifx\relax#1\empty\else%
    \PY@tok{#1}\expandafter\PY@toks\fi}
\def\PY@do#1{\PY@bc{\PY@tc{\PY@ul{%
    \PY@it{\PY@bf{\PY@ff{#1}}}}}}}
\def\PY#1#2{\PY@reset\PY@toks#1+\relax+\PY@do{#2}}

\@namedef{PY@tok@w}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.73,0.73}{##1}}}
\@namedef{PY@tok@c}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cp}{\def\PY@tc##1{\textcolor[rgb]{0.61,0.40,0.00}{##1}}}
\@namedef{PY@tok@k}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kp}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kt}{\def\PY@tc##1{\textcolor[rgb]{0.69,0.00,0.25}{##1}}}
\@namedef{PY@tok@o}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@ow}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\@namedef{PY@tok@nb}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@nf}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@nc}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@nn}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@ne}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.80,0.25,0.22}{##1}}}
\@namedef{PY@tok@nv}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@no}{\def\PY@tc##1{\textcolor[rgb]{0.53,0.00,0.00}{##1}}}
\@namedef{PY@tok@nl}{\def\PY@tc##1{\textcolor[rgb]{0.46,0.46,0.00}{##1}}}
\@namedef{PY@tok@ni}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.44,0.44,0.44}{##1}}}
\@namedef{PY@tok@na}{\def\PY@tc##1{\textcolor[rgb]{0.41,0.47,0.13}{##1}}}
\@namedef{PY@tok@nt}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@nd}{\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\@namedef{PY@tok@s}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sd}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@si}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.64,0.35,0.47}{##1}}}
\@namedef{PY@tok@se}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.36,0.12}{##1}}}
\@namedef{PY@tok@sr}{\def\PY@tc##1{\textcolor[rgb]{0.64,0.35,0.47}{##1}}}
\@namedef{PY@tok@ss}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@sx}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@m}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@gh}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\@namedef{PY@tok@gu}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.50,0.00,0.50}{##1}}}
\@namedef{PY@tok@gd}{\def\PY@tc##1{\textcolor[rgb]{0.63,0.00,0.00}{##1}}}
\@namedef{PY@tok@gi}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.52,0.00}{##1}}}
\@namedef{PY@tok@gr}{\def\PY@tc##1{\textcolor[rgb]{0.89,0.00,0.00}{##1}}}
\@namedef{PY@tok@ge}{\let\PY@it=\textit}
\@namedef{PY@tok@gs}{\let\PY@bf=\textbf}
\@namedef{PY@tok@ges}{\let\PY@bf=\textbf\let\PY@it=\textit}
\@namedef{PY@tok@gp}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\@namedef{PY@tok@go}{\def\PY@tc##1{\textcolor[rgb]{0.44,0.44,0.44}{##1}}}
\@namedef{PY@tok@gt}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.27,0.87}{##1}}}
\@namedef{PY@tok@err}{\def\PY@bc##1{{\setlength{\fboxsep}{\string -\fboxrule}\fcolorbox[rgb]{1.00,0.00,0.00}{1,1,1}{\strut ##1}}}}
\@namedef{PY@tok@kc}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kd}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kn}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kr}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@bp}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@fm}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@vc}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@vg}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@vi}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@vm}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@sa}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sb}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sc}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@dl}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@s2}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sh}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@s1}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@mb}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mf}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mh}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mi}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@il}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mo}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@ch}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cm}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cpf}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@c1}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cs}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}

\def\PYZbs{\char`\\}
\def\PYZus{\char`\_}
\def\PYZob{\char`\{}
\def\PYZcb{\char`\}}
\def\PYZca{\char`\^}
\def\PYZam{\char`\&}
\def\PYZlt{\char`\<}
\def\PYZgt{\char`\>}
\def\PYZsh{\char`\#}
\def\PYZpc{\char`\%}
\def\PYZdl{\char`\$}
\def\PYZhy{\char`\-}
\def\PYZsq{\char`\'}
\def\PYZdq{\char`\"}
\def\PYZti{\char`\~}
% for compatibility with earlier versions
\def\PYZat{@}
\def\PYZlb{[}
\def\PYZrb{]}
\makeatother


    % For linebreaks inside Verbatim environment from package fancyvrb.
    \makeatletter
        \newbox\Wrappedcontinuationbox
        \newbox\Wrappedvisiblespacebox
        \newcommand*\Wrappedvisiblespace {\textcolor{red}{\textvisiblespace}}
        \newcommand*\Wrappedcontinuationsymbol {\textcolor{red}{\llap{\tiny$\m@th\hookrightarrow$}}}
        \newcommand*\Wrappedcontinuationindent {3ex }
        \newcommand*\Wrappedafterbreak {\kern\Wrappedcontinuationindent\copy\Wrappedcontinuationbox}
        % Take advantage of the already applied Pygments mark-up to insert
        % potential linebreaks for TeX processing.
        %        {, <, #, %, $, ' and ": go to next line.
        %        _, }, ^, &, >, - and ~: stay at end of broken line.
        % Use of \textquotesingle for straight quote.
        \newcommand*\Wrappedbreaksatspecials {%
            \def\PYGZus{\discretionary{\char`\_}{\Wrappedafterbreak}{\char`\_}}%
            \def\PYGZob{\discretionary{}{\Wrappedafterbreak\char`\{}{\char`\{}}%
            \def\PYGZcb{\discretionary{\char`\}}{\Wrappedafterbreak}{\char`\}}}%
            \def\PYGZca{\discretionary{\char`\^}{\Wrappedafterbreak}{\char`\^}}%
            \def\PYGZam{\discretionary{\char`\&}{\Wrappedafterbreak}{\char`\&}}%
            \def\PYGZlt{\discretionary{}{\Wrappedafterbreak\char`\<}{\char`\<}}%
            \def\PYGZgt{\discretionary{\char`\>}{\Wrappedafterbreak}{\char`\>}}%
            \def\PYGZsh{\discretionary{}{\Wrappedafterbreak\char`\#}{\char`\#}}%
            \def\PYGZpc{\discretionary{}{\Wrappedafterbreak\char`\%}{\char`\%}}%
            \def\PYGZdl{\discretionary{}{\Wrappedafterbreak\char`\$}{\char`\$}}%
            \def\PYGZhy{\discretionary{\char`\-}{\Wrappedafterbreak}{\char`\-}}%
            \def\PYGZsq{\discretionary{}{\Wrappedafterbreak\textquotesingle}{\textquotesingle}}%
            \def\PYGZdq{\discretionary{}{\Wrappedafterbreak\char`\"}{\char`\"}}%
            \def\PYGZti{\discretionary{\char`\~}{\Wrappedafterbreak}{\char`\~}}%
        }
        % Some characters . , ; ? ! / are not pygmentized.
        % This macro makes them "active" and they will insert potential linebreaks
        \newcommand*\Wrappedbreaksatpunct {%
            \lccode`\~`\.\lowercase{\def~}{\discretionary{\hbox{\char`\.}}{\Wrappedafterbreak}{\hbox{\char`\.}}}%
            \lccode`\~`\,\lowercase{\def~}{\discretionary{\hbox{\char`\,}}{\Wrappedafterbreak}{\hbox{\char`\,}}}%
            \lccode`\~`\;\lowercase{\def~}{\discretionary{\hbox{\char`\;}}{\Wrappedafterbreak}{\hbox{\char`\;}}}%
            \lccode`\~`\:\lowercase{\def~}{\discretionary{\hbox{\char`\:}}{\Wrappedafterbreak}{\hbox{\char`\:}}}%
            \lccode`\~`\?\lowercase{\def~}{\discretionary{\hbox{\char`\?}}{\Wrappedafterbreak}{\hbox{\char`\?}}}%
            \lccode`\~`\!\lowercase{\def~}{\discretionary{\hbox{\char`\!}}{\Wrappedafterbreak}{\hbox{\char`\!}}}%
            \lccode`\~`\/\lowercase{\def~}{\discretionary{\hbox{\char`\/}}{\Wrappedafterbreak}{\hbox{\char`\/}}}%
            \catcode`\.\active
            \catcode`\,\active
            \catcode`\;\active
            \catcode`\:\active
            \catcode`\?\active
            \catcode`\!\active
            \catcode`\/\active
            \lccode`\~`\~
        }
    \makeatother

    \let\OriginalVerbatim=\Verbatim
    \makeatletter
    \renewcommand{\Verbatim}[1][1]{%
        %\parskip\z@skip
        \sbox\Wrappedcontinuationbox {\Wrappedcontinuationsymbol}%
        \sbox\Wrappedvisiblespacebox {\FV@SetupFont\Wrappedvisiblespace}%
        \def\FancyVerbFormatLine ##1{\hsize\linewidth
            \vtop{\raggedright\hyphenpenalty\z@\exhyphenpenalty\z@
                \doublehyphendemerits\z@\finalhyphendemerits\z@
                \strut ##1\strut}%
        }%
        % If the linebreak is at a space, the latter will be displayed as visible
        % space at end of first line, and a continuation symbol starts next line.
        % Stretch/shrink are however usually zero for typewriter font.
        \def\FV@Space {%
            \nobreak\hskip\z@ plus\fontdimen3\font minus\fontdimen4\font
            \discretionary{\copy\Wrappedvisiblespacebox}{\Wrappedafterbreak}
            {\kern\fontdimen2\font}%
        }%

        % Allow breaks at special characters using \PYG... macros.
        \Wrappedbreaksatspecials
        % Breaks at punctuation characters . , ; ? ! and / need catcode=\active
        \OriginalVerbatim[#1,codes*=\Wrappedbreaksatpunct]%
    }
    \makeatother

    % Exact colors from NB
    \definecolor{incolor}{HTML}{303F9F}
    \definecolor{outcolor}{HTML}{D84315}
    \definecolor{cellborder}{HTML}{CFCFCF}
    \definecolor{cellbackground}{HTML}{F7F7F7}

    % prompt
    \makeatletter
    \newcommand{\boxspacing}{\kern\kvtcb@left@rule\kern\kvtcb@boxsep}
    \makeatother
    \newcommand{\prompt}[4]{
        {\ttfamily\llap{{\color{#2}[#3]:\hspace{3pt}#4}}\vspace{-\baselineskip}}
    }
    

    
    % Prevent overflowing lines due to hard-to-break entities
    \sloppy
    % Setup hyperref package
    \hypersetup{
      breaklinks=true,  % so long urls are correctly broken across lines
      colorlinks=true,
      urlcolor=urlcolor,
      linkcolor=linkcolor,
      citecolor=citecolor,
      }
    % Slightly bigger margins than the latex defaults
    
    \geometry{verbose,tmargin=1in,bmargin=1in,lmargin=1in,rmargin=1in}
    
    

\begin{document}
    
    \maketitle
    
    

    
    \section{Environment}\label{environment}

    \subsection{Imports}\label{imports}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{63}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{p}{:}\PY{n+nc}{dep}\PY{+w}{ }\PY{n}{polars}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{p}{\PYZob{}}\PY{+w}{ }\PY{n}{version}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{l+s}{\PYZdq{}}\PY{l+s}{0.46}\PY{l+s}{\PYZdq{}}\PY{p}{,}\PY{+w}{ }\PY{n}{features}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{p}{[}\PY{+w}{ }\PY{l+s}{\PYZdq{}}\PY{l+s}{lazy}\PY{l+s}{\PYZdq{}}\PY{p}{,}\PY{+w}{ }\PY{l+s}{\PYZdq{}}\PY{l+s}{cum\PYZus{}agg}\PY{l+s}{\PYZdq{}}\PY{p}{,}\PY{+w}{ }\PY{l+s}{\PYZdq{}}\PY{l+s}{list\PYZus{}arithmetic}\PY{l+s}{\PYZdq{}}\PY{p}{,}\PY{+w}{ }\PY{l+s}{\PYZdq{}}\PY{l+s}{round\PYZus{}series}\PY{l+s}{\PYZdq{}}\PY{+w}{ }\PY{p}{]}\PY{+w}{ }\PY{p}{\PYZcb{}}
\PY{p}{:}\PY{n+nc}{dep}\PY{+w}{ }\PY{n}{nalgebra}
\PY{p}{:}\PY{n+nc}{dep}\PY{+w}{ }\PY{n}{argmin}
\PY{p}{:}\PY{n+nc}{dep}\PY{+w}{ }\PY{n}{argmin}\PY{o}{\PYZhy{}}\PY{n}{math}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{p}{\PYZob{}}\PY{+w}{ }\PY{n}{version}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{l+s}{\PYZdq{}}\PY{l+s}{0.4}\PY{l+s}{\PYZdq{}}\PY{p}{,}\PY{+w}{ }\PY{n}{features}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{p}{[}\PY{l+s}{\PYZdq{}}\PY{l+s}{nalgebra\PYZus{}latest}\PY{l+s}{\PYZdq{}}\PY{p}{,}\PY{+w}{ }\PY{l+s}{\PYZdq{}}\PY{l+s}{vec}\PY{l+s}{\PYZdq{}}\PY{p}{]}\PY{+w}{ }\PY{p}{\PYZcb{}}
\PY{p}{:}\PY{n+nc}{dep}\PY{+w}{ }\PY{n}{itertools}
\PY{p}{:}\PY{n+nc}{dep}\PY{+w}{ }\PY{n}{plotters}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{p}{\PYZob{}}\PY{+w}{ }\PY{n}{version}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{l+s}{\PYZdq{}}\PY{l+s}{0.3}\PY{l+s}{\PYZdq{}}\PY{p}{,}\PY{+w}{ }\PY{n}{features}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{p}{[}\PY{l+s}{\PYZdq{}}\PY{l+s}{evcxr}\PY{l+s}{\PYZdq{}}\PY{p}{,}\PY{+w}{ }\PY{l+s}{\PYZdq{}}\PY{l+s}{all\PYZus{}series}\PY{l+s}{\PYZdq{}}\PY{p}{]}\PY{+w}{ }\PY{p}{\PYZcb{}}
\end{Verbatim}
\end{tcolorbox}

    \href{https://pola.rs/}{Polars} is a new DataFrame library meant to
replace pandas, which is written in Rust. It has both a Python and a
Rust interface

It's by far the largest library here, so it will take some time to
compile. I have only enabled the features that I will use.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{64}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{use}\PY{+w}{ }\PY{n}{polars}\PY{p}{::}\PY{n}{prelude}\PY{p}{:}\PY{p}{:}\PY{o}{*}\PY{p}{;}
\PY{k}{use}\PY{+w}{ }\PY{n}{plotters}\PY{p}{::}\PY{n}{prelude}\PY{p}{:}\PY{p}{:}\PY{o}{*}\PY{p}{;}
\end{Verbatim}
\end{tcolorbox}

    \subsection{Plot Output}\label{plot-output}

    The standard plot output for the \texttt{plotters} library becomes HTML,
even though it's just an SVG. I introduce a wrapper here so that it
forces it to label itself SVG, which LaTeX can render.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{66}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{use}\PY{+w}{ }\PY{n}{plotters}\PY{p}{::}\PY{n}{coord}\PY{p}{::}\PY{n}{Shift}\PY{p}{;}

\PY{k}{pub}\PY{+w}{ }\PY{k}{struct}\PY{+w}{ }\PY{n+nc}{PlotWrapper}\PY{p}{(}\PY{n+nb}{String}\PY{p}{)}\PY{p}{;}

\PY{k}{impl}\PY{+w}{ }\PY{n}{PlotWrapper}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{    }\PY{k}{pub}\PY{+w}{ }\PY{k}{fn}\PY{+w}{ }\PY{n+nf}{evcxr\PYZus{}display}\PY{p}{(}\PY{o}{\PYZam{}}\PY{n+nb+bp}{self}\PY{p}{)}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{        }\PY{n+nf+fm}{println!}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{\PYZob{}\PYZcb{}}\PY{l+s}{\PYZdq{}}\PY{p}{,}\PY{+w}{ }\PY{n+nb+bp}{self}\PY{p}{.}\PY{l+m+mi}{0}\PY{p}{)}\PY{p}{;}
\PY{+w}{    }\PY{p}{\PYZcb{}}
\PY{p}{\PYZcb{}}

\PY{k}{pub}\PY{+w}{ }\PY{k}{fn}\PY{+w}{ }\PY{n+nf}{my\PYZus{}evcxr\PYZus{}figure}\PY{o}{\PYZlt{}}
\PY{+w}{    }\PY{n}{Draw}\PY{p}{:}\PY{+w}{ }\PY{n+nb}{FnOnce}\PY{p}{(}\PY{n}{DrawingArea}\PY{o}{\PYZlt{}}\PY{n}{SVGBackend}\PY{p}{,}\PY{+w}{ }\PY{n}{Shift}\PY{o}{\PYZgt{}}\PY{p}{)}\PY{+w}{ }\PY{p}{\PYZhy{}\PYZgt{}}\PY{+w}{ }\PY{n+nb}{Result}\PY{o}{\PYZlt{}}\PY{p}{(}\PY{p}{)}\PY{p}{,}\PY{+w}{ }\PY{n+nb}{Box}\PY{o}{\PYZlt{}}\PY{k}{dyn}\PY{+w}{ }\PY{n}{std}\PY{p}{::}\PY{n}{error}\PY{p}{::}\PY{n}{Error}\PY{o}{\PYZgt{}}\PY{o}{\PYZgt{}}\PY{p}{,}
\PY{o}{\PYZgt{}}\PY{p}{(}
\PY{+w}{    }\PY{n}{size}\PY{p}{:}\PY{+w}{ }\PY{p}{(}\PY{k+kt}{u32}\PY{p}{,}\PY{+w}{ }\PY{k+kt}{u32}\PY{p}{)}\PY{p}{,}
\PY{+w}{    }\PY{n}{draw}\PY{p}{:}\PY{+w}{ }\PY{n+nc}{Draw}\PY{p}{,}
\PY{p}{)}\PY{+w}{ }\PY{p}{\PYZhy{}\PYZgt{}}\PY{+w}{ }\PY{n+nc}{PlotWrapper}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{    }\PY{k+kd}{let}\PY{+w}{ }\PY{k}{mut}\PY{+w}{ }\PY{n}{buffer}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n+nb}{String}\PY{p}{::}\PY{n}{new}\PY{p}{(}\PY{p}{)}\PY{p}{;}
\PY{+w}{    }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{root}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{SVGBackend}\PY{p}{::}\PY{n}{with\PYZus{}string}\PY{p}{(}\PY{o}{\PYZam{}}\PY{k}{mut}\PY{+w}{ }\PY{n}{buffer}\PY{p}{,}\PY{+w}{ }\PY{n}{size}\PY{p}{)}\PY{p}{.}\PY{n}{into\PYZus{}drawing\PYZus{}area}\PY{p}{(}\PY{p}{)}\PY{p}{;}
\PY{+w}{    }\PY{n}{draw}\PY{p}{(}\PY{n}{root}\PY{p}{)}\PY{p}{.}\PY{n}{expect}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{Drawing failure}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{;}
\PY{+w}{    }\PY{c+c1}{// buffer now contains the raw SVG content.}
\PY{+w}{    }\PY{n}{PlotWrapper}\PY{p}{(}\PY{n+nf+fm}{format!}\PY{p}{(}
\PY{+w}{        }\PY{l+s}{\PYZdq{}}\PY{l+s}{EVCXR\PYZus{}BEGIN\PYZus{}CONTENT text/svg}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{\PYZob{}\PYZcb{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{EVCXR\PYZus{}END\PYZus{}CONTENT}\PY{l+s}{\PYZdq{}}\PY{p}{,}\PY{+w}{ }\PY{n}{buffer}
\PY{+w}{    }\PY{p}{)}\PY{p}{)}
\PY{p}{\PYZcb{}}
\end{Verbatim}
\end{tcolorbox}

    \subsection{Dataframe Formatting}\label{dataframe-formatting}

    The default printing for dataframes works fine in the context of the
Jupyter environment, but doesn't render well to a \(\LaTeX\) report. We
will define a special hook for outputting HTML tables.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{67}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{use}\PY{+w}{ }\PY{n}{std}\PY{p}{::}\PY{n}{fmt}\PY{p}{::}\PY{n}{Write}\PY{p}{;}

\PY{l+s+sd}{/// Escapes LaTeX special characters (currently only underscores).}
\PY{k}{fn}\PY{+w}{ }\PY{n+nf}{escape\PYZus{}latex}\PY{p}{(}\PY{n}{s}\PY{p}{:}\PY{+w}{ }\PY{k+kp}{\PYZam{}}\PY{k+kt}{str}\PY{p}{)}\PY{+w}{ }\PY{p}{\PYZhy{}\PYZgt{}}\PY{+w}{ }\PY{n+nb}{String}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{    }\PY{n}{s}\PY{p}{.}\PY{n}{replace}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{\PYZus{}}\PY{l+s}{\PYZdq{}}\PY{p}{,}\PY{+w}{ }\PY{l+s}{\PYZdq{}}\PY{l+s+se}{\PYZbs{}\PYZbs{}}\PY{l+s}{\PYZus{}}\PY{l+s}{\PYZdq{}}\PY{p}{)}
\PY{p}{\PYZcb{}}

\PY{l+s+sd}{/// Formats an `AnyValue` to display only the underlying data:}
\PY{l+s+sd}{/// \PYZhy{} Floats are formatted to four decimal places.}
\PY{l+s+sd}{/// \PYZhy{} Null values become \PYZdq{}null\PYZdq{}.}
\PY{l+s+sd}{/// \PYZhy{} Lists of f64 are rendered like \PYZdq{}[0.3512, 0.2422, 0.3788]\PYZdq{}.}
\PY{k}{fn}\PY{+w}{ }\PY{n+nf}{format\PYZus{}any\PYZus{}value}\PY{p}{(}\PY{n}{value}\PY{p}{:}\PY{+w}{ }\PY{k+kp}{\PYZam{}}\PY{n+nc}{AnyValue}\PY{p}{)}\PY{+w}{ }\PY{p}{\PYZhy{}\PYZgt{}}\PY{+w}{ }\PY{n+nb}{String}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{    }\PY{k}{match}\PY{+w}{ }\PY{n}{value}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{        }\PY{n}{AnyValue}\PY{p}{::}\PY{n}{Null}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{l+s}{\PYZdq{}}\PY{l+s}{null}\PY{l+s}{\PYZdq{}}\PY{p}{.}\PY{n}{to\PYZus{}owned}\PY{p}{(}\PY{p}{)}\PY{p}{,}
\PY{+w}{        }\PY{n}{AnyValue}\PY{p}{::}\PY{n+nb}{String}\PY{p}{(}\PY{n}{s}\PY{p}{)}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{n}{s}\PY{p}{.}\PY{n}{to\PYZus{}string}\PY{p}{(}\PY{p}{)}\PY{p}{,}
\PY{+w}{        }\PY{n}{AnyValue}\PY{p}{::}\PY{n}{StringOwned}\PY{p}{(}\PY{n}{s}\PY{p}{)}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{n}{s}\PY{p}{.}\PY{n}{to\PYZus{}string}\PY{p}{(}\PY{p}{)}\PY{p}{,}
\PY{+w}{        }\PY{n}{AnyValue}\PY{p}{::}\PY{n}{Boolean}\PY{p}{(}\PY{n}{b}\PY{p}{)}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{n}{b}\PY{p}{.}\PY{n}{to\PYZus{}string}\PY{p}{(}\PY{p}{)}\PY{p}{,}
\PY{+w}{        }\PY{n}{AnyValue}\PY{p}{::}\PY{n}{Int32}\PY{p}{(}\PY{n}{i}\PY{p}{)}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{n}{i}\PY{p}{.}\PY{n}{to\PYZus{}string}\PY{p}{(}\PY{p}{)}\PY{p}{,}
\PY{+w}{        }\PY{n}{AnyValue}\PY{p}{::}\PY{n}{Int64}\PY{p}{(}\PY{n}{i}\PY{p}{)}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{n}{i}\PY{p}{.}\PY{n}{to\PYZus{}string}\PY{p}{(}\PY{p}{)}\PY{p}{,}
\PY{+w}{        }\PY{n}{AnyValue}\PY{p}{::}\PY{n}{Float32}\PY{p}{(}\PY{n}{f}\PY{p}{)}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{n+nf+fm}{format!}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{\PYZob{}:.4\PYZcb{}}\PY{l+s}{\PYZdq{}}\PY{p}{,}\PY{+w}{ }\PY{n}{f}\PY{p}{)}\PY{p}{,}
\PY{+w}{        }\PY{n}{AnyValue}\PY{p}{::}\PY{n}{Float64}\PY{p}{(}\PY{n}{f}\PY{p}{)}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{n+nf+fm}{format!}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{\PYZob{}:.4\PYZcb{}}\PY{l+s}{\PYZdq{}}\PY{p}{,}\PY{+w}{ }\PY{n}{f}\PY{p}{)}\PY{p}{,}
\PY{+w}{        }\PY{n}{AnyValue}\PY{p}{::}\PY{n}{List}\PY{p}{(}\PY{n}{series}\PY{p}{)}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{            }\PY{c+c1}{// Try to treat the list as a list of f64.}
\PY{+w}{            }\PY{k}{if}\PY{+w}{ }\PY{k+kd}{let}\PY{+w}{ }\PY{n+nb}{Ok}\PY{p}{(}\PY{n}{ca}\PY{p}{)}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{series}\PY{p}{.}\PY{k+kt}{f64}\PY{p}{(}\PY{p}{)}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{                }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{formatted}\PY{p}{:}\PY{+w}{ }\PY{n+nb}{Vec}\PY{o}{\PYZlt{}}\PY{n+nb}{String}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{ca}
\PY{+w}{                    }\PY{p}{.}\PY{n}{into\PYZus{}iter}\PY{p}{(}\PY{p}{)}
\PY{+w}{                    }\PY{p}{.}\PY{n}{map}\PY{p}{(}\PY{o}{|}\PY{n}{opt}\PY{o}{|}\PY{+w}{ }\PY{k}{match}\PY{+w}{ }\PY{n}{opt}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{                        }\PY{n+nb}{Some}\PY{p}{(}\PY{n}{val}\PY{p}{)}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{n+nf+fm}{format!}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{\PYZob{}:.4\PYZcb{}}\PY{l+s}{\PYZdq{}}\PY{p}{,}\PY{+w}{ }\PY{n}{val}\PY{p}{)}\PY{p}{,}
\PY{+w}{                        }\PY{n+nb}{None}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{l+s}{\PYZdq{}}\PY{l+s}{null}\PY{l+s}{\PYZdq{}}\PY{p}{.}\PY{n}{to\PYZus{}owned}\PY{p}{(}\PY{p}{)}\PY{p}{,}
\PY{+w}{                    }\PY{p}{\PYZcb{}}\PY{p}{)}
\PY{+w}{                    }\PY{p}{.}\PY{n}{collect}\PY{p}{(}\PY{p}{)}\PY{p}{;}
\PY{+w}{                }\PY{n+nf+fm}{format!}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{[\PYZob{}\PYZcb{}]}\PY{l+s}{\PYZdq{}}\PY{p}{,}\PY{+w}{ }\PY{n}{formatted}\PY{p}{.}\PY{n}{join}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{, }\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
\PY{+w}{            }\PY{p}{\PYZcb{}}\PY{+w}{ }\PY{k}{else}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{                }\PY{c+c1}{// Fallback: use the debug formatting.}
\PY{+w}{                }\PY{n+nf+fm}{format!}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{\PYZob{}:?\PYZcb{}}\PY{l+s}{\PYZdq{}}\PY{p}{,}\PY{+w}{ }\PY{n}{series}\PY{p}{)}
\PY{+w}{            }\PY{p}{\PYZcb{}}
\PY{+w}{        }\PY{p}{\PYZcb{}}
\PY{+w}{        }\PY{n}{\PYZus{}}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{n+nf+fm}{format!}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{\PYZob{}:?\PYZcb{}}\PY{l+s}{\PYZdq{}}\PY{p}{,}\PY{+w}{ }\PY{n}{value}\PY{p}{)}\PY{p}{,}
\PY{+w}{    }\PY{p}{\PYZcb{}}
\PY{p}{\PYZcb{}}

\PY{l+s+sd}{/// Converts a Polars DataFrame into a LaTeX table using the tabularx environment.}
\PY{l+s+sd}{/// The table will be wrapped to the width of the page, and column names are escaped.}
\PY{k}{fn}\PY{+w}{ }\PY{n+nf}{df\PYZus{}to\PYZus{}latex}\PY{p}{(}\PY{n}{df}\PY{p}{:}\PY{+w}{ }\PY{k+kp}{\PYZam{}}\PY{n+nc}{DataFrame}\PY{p}{)}\PY{+w}{ }\PY{p}{\PYZhy{}\PYZgt{}}\PY{+w}{ }\PY{n+nb}{String}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{    }\PY{k+kd}{let}\PY{+w}{ }\PY{k}{mut}\PY{+w}{ }\PY{n}{latex}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n+nb}{String}\PY{p}{::}\PY{n}{new}\PY{p}{(}\PY{p}{)}\PY{p}{;}
\PY{+w}{    }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{num\PYZus{}cols}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{df}\PY{p}{.}\PY{n}{width}\PY{p}{(}\PY{p}{)}\PY{p}{;}

\PY{+w}{    }\PY{c+c1}{// Begin the tabularx environment with dynamic p\PYZhy{}columns.}
\PY{+w}{    }\PY{c+c1}{// This uses TeX’s \PYZbs{}dimexpr to compute each column’s width as:}
\PY{+w}{    }\PY{c+c1}{// \PYZbs{}textwidth divided by num\PYZus{}cols minus 2\PYZbs{}tabcolsep (for cell padding)}
\PY{+w}{    }\PY{n+nf+fm}{write!}\PY{p}{(}
\PY{+w}{        }\PY{n}{latex}\PY{p}{,}
\PY{+w}{        }\PY{l+s}{\PYZdq{}}\PY{l+s+se}{\PYZbs{}\PYZbs{}}\PY{l+s}{begin\PYZob{}\PYZob{}tabularx\PYZcb{}\PYZcb{}\PYZob{}\PYZob{}}\PY{l+s+se}{\PYZbs{}\PYZbs{}}\PY{l+s}{textwidth\PYZcb{}\PYZcb{}\PYZob{}\PYZob{}|*\PYZob{}num\PYZus{}cols\PYZcb{}\PYZob{}\PYZob{}p\PYZob{}\PYZob{}}\PY{l+s+se}{\PYZbs{}\PYZbs{}}\PY{l+s}{dimexpr}\PY{l+s+se}{\PYZbs{}\PYZbs{}}\PY{l+s}{textwidth/\PYZob{}num\PYZus{}cols\PYZcb{}\PYZhy{}2}\PY{l+s+se}{\PYZbs{}\PYZbs{}}\PY{l+s}{tabcolsep}\PY{l+s+se}{\PYZbs{}\PYZbs{}}\PY{l+s}{relax\PYZcb{}\PYZcb{}|\PYZcb{}\PYZcb{}\PYZcb{}\PYZcb{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}\PYZbs{}}\PY{l+s}{hline}\PY{l+s}{\PYZdq{}}
\PY{+w}{    }\PY{p}{)}
\PY{+w}{    }\PY{p}{.}\PY{n}{unwrap}\PY{p}{(}\PY{p}{)}\PY{p}{;}
\PY{+w}{    }\PY{c+c1}{// Begin the tabularx environment. Each column is given as an \PYZsq{}X\PYZsq{} (flexible column).}
\PY{+w}{    }\PY{c+c1}{// latex.push\PYZus{}str(\PYZdq{}\PYZbs{}\PYZbs{}begin\PYZob{}tabularx\PYZcb{}\PYZob{}\PYZbs{}\PYZbs{}textwidth\PYZcb{}\PYZob{}|\PYZdq{});}
\PY{+w}{    }\PY{c+c1}{// for \PYZus{} in 0..df.width() \PYZob{}}
\PY{+w}{    }\PY{c+c1}{//     latex.push\PYZus{}str(\PYZdq{}X|\PYZdq{});}
\PY{+w}{    }\PY{c+c1}{// \PYZcb{}}
\PY{+w}{    }\PY{c+c1}{// latex.push\PYZus{}str(\PYZdq{}\PYZcb{}\PYZbs{}n\PYZbs{}\PYZbs{}hline\PYZbs{}n\PYZdq{});}
\PY{+w}{    }
\PY{+w}{    }\PY{c+c1}{// Header row: escape underscores in column names.}
\PY{+w}{    }\PY{k}{for}\PY{+w}{ }\PY{p}{(}\PY{n}{i}\PY{p}{,}\PY{+w}{ }\PY{n}{series}\PY{p}{)}\PY{+w}{ }\PY{k}{in}\PY{+w}{ }\PY{n}{df}\PY{p}{.}\PY{n}{get\PYZus{}columns}\PY{p}{(}\PY{p}{)}\PY{p}{.}\PY{n}{iter}\PY{p}{(}\PY{p}{)}\PY{p}{.}\PY{n}{enumerate}\PY{p}{(}\PY{p}{)}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{        }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{col\PYZus{}name}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{escape\PYZus{}latex}\PY{p}{(}\PY{n}{series}\PY{p}{.}\PY{n}{name}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{;}
\PY{+w}{        }\PY{n+nf+fm}{write!}\PY{p}{(}\PY{n}{latex}\PY{p}{,}\PY{+w}{ }\PY{l+s}{\PYZdq{}}\PY{l+s}{\PYZob{}\PYZcb{}}\PY{l+s}{\PYZdq{}}\PY{p}{,}\PY{+w}{ }\PY{n}{col\PYZus{}name}\PY{p}{)}\PY{p}{.}\PY{n}{unwrap}\PY{p}{(}\PY{p}{)}\PY{p}{;}
\PY{+w}{        }\PY{k}{if}\PY{+w}{ }\PY{n}{i}\PY{+w}{ }\PY{o}{\PYZlt{}}\PY{+w}{ }\PY{n}{df}\PY{p}{.}\PY{n}{width}\PY{p}{(}\PY{p}{)}\PY{+w}{ }\PY{o}{\PYZhy{}}\PY{+w}{ }\PY{l+m+mi}{1}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{            }\PY{n}{latex}\PY{p}{.}\PY{n}{push\PYZus{}str}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{ \PYZam{} }\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{;}
\PY{+w}{        }\PY{p}{\PYZcb{}}\PY{+w}{ }\PY{k}{else}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{            }\PY{n}{latex}\PY{p}{.}\PY{n}{push\PYZus{}str}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{ }\PY{l+s+se}{\PYZbs{}\PYZbs{}}\PY{l+s+se}{\PYZbs{}\PYZbs{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}\PYZbs{}}\PY{l+s}{hline}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{;}
\PY{+w}{        }\PY{p}{\PYZcb{}}
\PY{+w}{    }\PY{p}{\PYZcb{}}
\PY{+w}{    }
\PY{+w}{    }\PY{c+c1}{// Body rows.}
\PY{+w}{    }\PY{k}{for}\PY{+w}{ }\PY{n}{row}\PY{+w}{ }\PY{k}{in}\PY{+w}{ }\PY{l+m+mi}{0}\PY{o}{..}\PY{n}{df}\PY{p}{.}\PY{n}{height}\PY{p}{(}\PY{p}{)}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{        }\PY{k}{for}\PY{+w}{ }\PY{p}{(}\PY{n}{j}\PY{p}{,}\PY{+w}{ }\PY{n}{series}\PY{p}{)}\PY{+w}{ }\PY{k}{in}\PY{+w}{ }\PY{n}{df}\PY{p}{.}\PY{n}{get\PYZus{}columns}\PY{p}{(}\PY{p}{)}\PY{p}{.}\PY{n}{iter}\PY{p}{(}\PY{p}{)}\PY{p}{.}\PY{n}{enumerate}\PY{p}{(}\PY{p}{)}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{            }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{cell}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{series}\PY{p}{.}\PY{n}{get}\PY{p}{(}\PY{n}{row}\PY{p}{)}\PY{p}{.}\PY{n}{unwrap}\PY{p}{(}\PY{p}{)}\PY{p}{;}
\PY{+w}{            }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{cell\PYZus{}str}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{format\PYZus{}any\PYZus{}value}\PY{p}{(}\PY{o}{\PYZam{}}\PY{n}{cell}\PY{p}{)}\PY{p}{;}
\PY{+w}{            }\PY{c+c1}{// Escape special characters in cell contents if needed.}
\PY{+w}{            }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{cell\PYZus{}str}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{escape\PYZus{}latex}\PY{p}{(}\PY{o}{\PYZam{}}\PY{n}{cell\PYZus{}str}\PY{p}{)}\PY{p}{;}
\PY{+w}{            }\PY{n+nf+fm}{write!}\PY{p}{(}\PY{n}{latex}\PY{p}{,}\PY{+w}{ }\PY{l+s}{\PYZdq{}}\PY{l+s}{\PYZob{}\PYZcb{}}\PY{l+s}{\PYZdq{}}\PY{p}{,}\PY{+w}{ }\PY{n}{cell\PYZus{}str}\PY{p}{)}\PY{p}{.}\PY{n}{unwrap}\PY{p}{(}\PY{p}{)}\PY{p}{;}
\PY{+w}{            }\PY{k}{if}\PY{+w}{ }\PY{n}{j}\PY{+w}{ }\PY{o}{\PYZlt{}}\PY{+w}{ }\PY{n}{df}\PY{p}{.}\PY{n}{width}\PY{p}{(}\PY{p}{)}\PY{+w}{ }\PY{o}{\PYZhy{}}\PY{+w}{ }\PY{l+m+mi}{1}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{                }\PY{n}{latex}\PY{p}{.}\PY{n}{push\PYZus{}str}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{ \PYZam{} }\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{;}
\PY{+w}{            }\PY{p}{\PYZcb{}}\PY{+w}{ }\PY{k}{else}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{                }\PY{n}{latex}\PY{p}{.}\PY{n}{push\PYZus{}str}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{ }\PY{l+s+se}{\PYZbs{}\PYZbs{}}\PY{l+s+se}{\PYZbs{}\PYZbs{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}\PYZbs{}}\PY{l+s}{hline}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{;}
\PY{+w}{            }\PY{p}{\PYZcb{}}
\PY{+w}{        }\PY{p}{\PYZcb{}}
\PY{+w}{    }\PY{p}{\PYZcb{}}
\PY{+w}{    }\PY{n}{latex}\PY{p}{.}\PY{n}{push\PYZus{}str}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s+se}{\PYZbs{}\PYZbs{}}\PY{l+s}{end\PYZob{}tabularx\PYZcb{}}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{;}
\PY{+w}{    }\PY{n}{latex}
\PY{p}{\PYZcb{}}

\PY{l+s+sd}{/// A newtype wrapper for Polars\PYZsq{} DataFrame that implements a custom display for evcxr.}
\PY{l+s+sd}{/// When output in an evcxr notebook, this prints LaTeX code between the special markers.}
\PY{k}{struct}\PY{+w}{ }\PY{n+nc}{LaTeXDataFrame}\PY{p}{(}\PY{n}{DataFrame}\PY{p}{)}\PY{p}{;}

\PY{k}{impl}\PY{+w}{ }\PY{n}{LaTeXDataFrame}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{    }\PY{k}{pub}\PY{+w}{ }\PY{k}{fn}\PY{+w}{ }\PY{n+nf}{evcxr\PYZus{}display}\PY{p}{(}\PY{o}{\PYZam{}}\PY{n+nb+bp}{self}\PY{p}{)}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{        }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{latex}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{df\PYZus{}to\PYZus{}latex}\PY{p}{(}\PY{o}{\PYZam{}}\PY{n+nb+bp}{self}\PY{p}{.}\PY{l+m+mi}{0}\PY{p}{)}\PY{p}{;}
\PY{+w}{        }\PY{n+nf+fm}{println!}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{EVCXR\PYZus{}BEGIN\PYZus{}CONTENT text/latex}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{\PYZob{}\PYZcb{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{EVCXR\PYZus{}END\PYZus{}CONTENT}\PY{l+s}{\PYZdq{}}\PY{p}{,}\PY{+w}{ }\PY{n}{latex}\PY{p}{)}\PY{p}{;}
\PY{+w}{    }\PY{p}{\PYZcb{}}
\PY{p}{\PYZcb{}}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{68}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{use}\PY{+w}{ }\PY{n}{std}\PY{p}{::}\PY{n}{fmt}\PY{p}{::}\PY{n}{Write}\PY{p}{;}

\PY{l+s+sd}{/// Formats an `AnyValue` to show just the underlying data,}

\PY{l+s+sd}{/// rendering null values as \PYZdq{}null\PYZdq{}.}

\PY{k}{fn}\PY{+w}{ }\PY{n+nf}{format\PYZus{}any\PYZus{}value}\PY{p}{(}\PY{n}{value}\PY{p}{:}\PY{+w}{ }\PY{k+kp}{\PYZam{}}\PY{n+nc}{AnyValue}\PY{p}{)}\PY{+w}{ }\PY{p}{\PYZhy{}\PYZgt{}}\PY{+w}{ }\PY{n+nb}{String}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{    }\PY{k}{match}\PY{+w}{ }\PY{n}{value}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{        }\PY{n}{AnyValue}\PY{p}{::}\PY{n}{Null}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{l+s}{\PYZdq{}}\PY{l+s}{null}\PY{l+s}{\PYZdq{}}\PY{p}{.}\PY{n}{to\PYZus{}owned}\PY{p}{(}\PY{p}{)}\PY{p}{,}

\PY{+w}{        }\PY{n}{AnyValue}\PY{p}{::}\PY{n+nb}{String}\PY{p}{(}\PY{n}{s}\PY{p}{)}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{n}{s}\PY{p}{.}\PY{n}{to\PYZus{}string}\PY{p}{(}\PY{p}{)}\PY{p}{,}

\PY{+w}{        }\PY{n}{AnyValue}\PY{p}{::}\PY{n}{StringOwned}\PY{p}{(}\PY{n}{s}\PY{p}{)}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{n}{s}\PY{p}{.}\PY{n}{to\PYZus{}string}\PY{p}{(}\PY{p}{)}\PY{p}{,}

\PY{+w}{        }\PY{n}{AnyValue}\PY{p}{::}\PY{n}{Boolean}\PY{p}{(}\PY{n}{b}\PY{p}{)}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{n}{b}\PY{p}{.}\PY{n}{to\PYZus{}string}\PY{p}{(}\PY{p}{)}\PY{p}{,}

\PY{+w}{        }\PY{n}{AnyValue}\PY{p}{::}\PY{n}{UInt32}\PY{p}{(}\PY{n}{u}\PY{p}{)}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{n}{u}\PY{p}{.}\PY{n}{to\PYZus{}string}\PY{p}{(}\PY{p}{)}\PY{p}{,}

\PY{+w}{        }\PY{n}{AnyValue}\PY{p}{::}\PY{n}{UInt64}\PY{p}{(}\PY{n}{u}\PY{p}{)}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{n}{u}\PY{p}{.}\PY{n}{to\PYZus{}string}\PY{p}{(}\PY{p}{)}\PY{p}{,}

\PY{+w}{        }\PY{n}{AnyValue}\PY{p}{::}\PY{n}{Int32}\PY{p}{(}\PY{n}{i}\PY{p}{)}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{n}{i}\PY{p}{.}\PY{n}{to\PYZus{}string}\PY{p}{(}\PY{p}{)}\PY{p}{,}

\PY{+w}{        }\PY{n}{AnyValue}\PY{p}{::}\PY{n}{Int64}\PY{p}{(}\PY{n}{i}\PY{p}{)}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{n}{i}\PY{p}{.}\PY{n}{to\PYZus{}string}\PY{p}{(}\PY{p}{)}\PY{p}{,}

\PY{+w}{        }\PY{n}{AnyValue}\PY{p}{::}\PY{n}{Float32}\PY{p}{(}\PY{n}{f}\PY{p}{)}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{n+nf+fm}{format!}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{\PYZob{}:.4\PYZcb{}}\PY{l+s}{\PYZdq{}}\PY{p}{,}\PY{+w}{ }\PY{n}{f}\PY{p}{)}\PY{p}{,}

\PY{+w}{        }\PY{n}{AnyValue}\PY{p}{::}\PY{n}{Float64}\PY{p}{(}\PY{n}{f}\PY{p}{)}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{n+nf+fm}{format!}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{\PYZob{}:.4\PYZcb{}}\PY{l+s}{\PYZdq{}}\PY{p}{,}\PY{+w}{ }\PY{n}{f}\PY{p}{)}\PY{p}{,}

\PY{+w}{        }\PY{n}{AnyValue}\PY{p}{::}\PY{n}{List}\PY{p}{(}\PY{n}{series}\PY{p}{)}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{            }\PY{c+c1}{// Attempt to treat the list as a list of f64.}
\PY{+w}{            }\PY{k}{if}\PY{+w}{ }\PY{k+kd}{let}\PY{+w}{ }\PY{n+nb}{Ok}\PY{p}{(}\PY{n}{ca}\PY{p}{)}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{series}\PY{p}{.}\PY{k+kt}{f64}\PY{p}{(}\PY{p}{)}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{                }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{formatted}\PY{p}{:}\PY{+w}{ }\PY{n+nb}{Vec}\PY{o}{\PYZlt{}}\PY{n+nb}{String}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{ca}
\PY{+w}{                    }\PY{p}{.}\PY{n}{into\PYZus{}iter}\PY{p}{(}\PY{p}{)}
\PY{+w}{                    }\PY{p}{.}\PY{n}{map}\PY{p}{(}\PY{o}{|}\PY{n}{opt}\PY{o}{|}\PY{+w}{ }\PY{k}{match}\PY{+w}{ }\PY{n}{opt}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{                        }\PY{n+nb}{Some}\PY{p}{(}\PY{n}{val}\PY{p}{)}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{n+nf+fm}{format!}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{\PYZob{}:.4\PYZcb{}}\PY{l+s}{\PYZdq{}}\PY{p}{,}\PY{+w}{ }\PY{n}{val}\PY{p}{)}\PY{p}{,}
\PY{+w}{                        }\PY{n+nb}{None}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{l+s}{\PYZdq{}}\PY{l+s}{null}\PY{l+s}{\PYZdq{}}\PY{p}{.}\PY{n}{to\PYZus{}owned}\PY{p}{(}\PY{p}{)}\PY{p}{,}
\PY{+w}{                    }\PY{p}{\PYZcb{}}\PY{p}{)}
\PY{+w}{                    }\PY{p}{.}\PY{n}{collect}\PY{p}{(}\PY{p}{)}\PY{p}{;}
\PY{+w}{                }\PY{n+nf+fm}{format!}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{[\PYZob{}\PYZcb{}]}\PY{l+s}{\PYZdq{}}\PY{p}{,}\PY{+w}{ }\PY{n}{formatted}\PY{p}{.}\PY{n}{join}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{, }\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
\PY{+w}{            }\PY{p}{\PYZcb{}}\PY{+w}{ }\PY{k}{else}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{                }\PY{c+c1}{// Fallback: if not a list of f64, use the default debug formatting.}
\PY{+w}{                }\PY{n+nf+fm}{format!}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{\PYZob{}:?\PYZcb{}}\PY{l+s}{\PYZdq{}}\PY{p}{,}\PY{+w}{ }\PY{n}{series}\PY{p}{)}
\PY{+w}{            }\PY{p}{\PYZcb{}}
\PY{+w}{        }\PY{p}{\PYZcb{}}

\PY{+w}{        }\PY{c+c1}{// Fallback for other types.}
\PY{+w}{        }\PY{n}{\PYZus{}}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{n+nf+fm}{format!}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{\PYZob{}:?\PYZcb{}}\PY{l+s}{\PYZdq{}}\PY{p}{,}\PY{+w}{ }\PY{n}{value}\PY{p}{)}\PY{p}{,}
\PY{+w}{    }\PY{p}{\PYZcb{}}
\PY{p}{\PYZcb{}}

\PY{l+s+sd}{/// Converts a Polars DataFrame into an HTML table string.}

\PY{l+s+sd}{/// The header includes the column name and its type,}

\PY{l+s+sd}{/// while the cells display the unwrapped values, rendering nulls as \PYZdq{}null\PYZdq{}.}

\PY{k}{fn}\PY{+w}{ }\PY{n+nf}{df\PYZus{}to\PYZus{}html}\PY{p}{(}\PY{n}{df}\PY{p}{:}\PY{+w}{ }\PY{k+kp}{\PYZam{}}\PY{n+nc}{DataFrame}\PY{p}{)}\PY{+w}{ }\PY{p}{\PYZhy{}\PYZgt{}}\PY{+w}{ }\PY{n+nb}{String}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{    }\PY{k+kd}{let}\PY{+w}{ }\PY{k}{mut}\PY{+w}{ }\PY{n}{html}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n+nb}{String}\PY{p}{::}\PY{n}{new}\PY{p}{(}\PY{p}{)}\PY{p}{;}

\PY{+w}{    }\PY{c+c1}{// Start the table with a border.}

\PY{+w}{    }\PY{n}{html}\PY{p}{.}\PY{n}{push\PYZus{}str}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{\PYZlt{}table border=}\PY{l+s+se}{\PYZbs{}\PYZdq{}}\PY{l+s}{1}\PY{l+s+se}{\PYZbs{}\PYZdq{}}\PY{l+s}{\PYZgt{}}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{;}

\PY{+w}{    }\PY{c+c1}{// Build header row with column names and types.}

\PY{+w}{    }\PY{n}{html}\PY{p}{.}\PY{n}{push\PYZus{}str}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{\PYZlt{}thead\PYZgt{}\PYZlt{}tr\PYZgt{}}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{;}

\PY{+w}{    }\PY{k}{for}\PY{+w}{ }\PY{n}{series}\PY{+w}{ }\PY{k}{in}\PY{+w}{ }\PY{n}{df}\PY{p}{.}\PY{n}{get\PYZus{}columns}\PY{p}{(}\PY{p}{)}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{        }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{col\PYZus{}name}\PY{p}{:}\PY{+w}{ }\PY{k+kp}{\PYZam{}}\PY{k+kt}{str}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{series}\PY{p}{.}\PY{n}{name}\PY{p}{(}\PY{p}{)}\PY{p}{;}

\PY{+w}{        }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{dtype}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{series}\PY{p}{.}\PY{n}{dtype}\PY{p}{(}\PY{p}{)}\PY{p}{;}

\PY{+w}{        }\PY{c+c1}{// Map Polars data types to concise labels.}

\PY{+w}{        }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{type\PYZus{}str}\PY{p}{:}\PY{+w}{ }\PY{n+nb}{String}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{k}{match}\PY{+w}{ }\PY{n}{dtype}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{            }\PY{n}{DataType}\PY{p}{::}\PY{n+nb}{String}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{l+s}{\PYZdq{}}\PY{l+s}{str}\PY{l+s}{\PYZdq{}}\PY{p}{.}\PY{n}{to\PYZus{}owned}\PY{p}{(}\PY{p}{)}\PY{p}{,}

\PY{+w}{            }\PY{n}{DataType}\PY{p}{::}\PY{n}{Float64}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{l+s}{\PYZdq{}}\PY{l+s}{f64}\PY{l+s}{\PYZdq{}}\PY{p}{.}\PY{n}{to\PYZus{}owned}\PY{p}{(}\PY{p}{)}\PY{p}{,}

\PY{+w}{            }\PY{n}{DataType}\PY{p}{::}\PY{n}{Float32}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{l+s}{\PYZdq{}}\PY{l+s}{f32}\PY{l+s}{\PYZdq{}}\PY{p}{.}\PY{n}{to\PYZus{}owned}\PY{p}{(}\PY{p}{)}\PY{p}{,}

\PY{+w}{            }\PY{n}{DataType}\PY{p}{::}\PY{n}{UInt32}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{l+s}{\PYZdq{}}\PY{l+s}{u32}\PY{l+s}{\PYZdq{}}\PY{p}{.}\PY{n}{to\PYZus{}owned}\PY{p}{(}\PY{p}{)}\PY{p}{,}

\PY{+w}{            }\PY{n}{DataType}\PY{p}{::}\PY{n}{UInt64}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{l+s}{\PYZdq{}}\PY{l+s}{u64}\PY{l+s}{\PYZdq{}}\PY{p}{.}\PY{n}{to\PYZus{}owned}\PY{p}{(}\PY{p}{)}\PY{p}{,}

\PY{+w}{            }\PY{n}{DataType}\PY{p}{::}\PY{n}{Int32}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{l+s}{\PYZdq{}}\PY{l+s}{i32}\PY{l+s}{\PYZdq{}}\PY{p}{.}\PY{n}{to\PYZus{}owned}\PY{p}{(}\PY{p}{)}\PY{p}{,}

\PY{+w}{            }\PY{n}{DataType}\PY{p}{::}\PY{n}{Int64}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{l+s}{\PYZdq{}}\PY{l+s}{i64}\PY{l+s}{\PYZdq{}}\PY{p}{.}\PY{n}{to\PYZus{}owned}\PY{p}{(}\PY{p}{)}\PY{p}{,}

\PY{+w}{            }\PY{n}{DataType}\PY{p}{::}\PY{n}{List}\PY{p}{(}\PY{n}{inner}\PY{p}{)}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{                }\PY{k}{if}\PY{+w}{ }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{DataType}\PY{p}{::}\PY{n}{Float64}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{o}{*}\PY{o}{*}\PY{n}{inner}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{                    }\PY{l+s}{\PYZdq{}}\PY{l+s}{List\PYZlt{}f64\PYZgt{}}\PY{l+s}{\PYZdq{}}\PY{p}{.}\PY{n}{to\PYZus{}owned}\PY{p}{(}\PY{p}{)}
\PY{+w}{                }\PY{p}{\PYZcb{}}\PY{+w}{ }\PY{k}{else}\PY{+w}{ }\PY{k}{if}\PY{+w}{ }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{DataType}\PY{p}{::}\PY{n}{Float32}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{o}{*}\PY{o}{*}\PY{n}{inner}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{                    }\PY{l+s}{\PYZdq{}}\PY{l+s}{List\PYZlt{}f32\PYZgt{}}\PY{l+s}{\PYZdq{}}\PY{p}{.}\PY{n}{to\PYZus{}owned}\PY{p}{(}\PY{p}{)}
\PY{+w}{                }\PY{p}{\PYZcb{}}\PY{+w}{ }\PY{k}{else}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{                    }\PY{n+nf+fm}{format!}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{List\PYZlt{}\PYZob{}:?\PYZcb{}\PYZgt{}}\PY{l+s}{\PYZdq{}}\PY{p}{,}\PY{+w}{ }\PY{n}{inner}\PY{p}{)}
\PY{+w}{                }\PY{p}{\PYZcb{}}
\PY{+w}{            }\PY{p}{\PYZcb{}}

\PY{+w}{            }\PY{n}{\PYZus{}}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{n+nf+fm}{format!}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{\PYZob{}:?\PYZcb{}}\PY{l+s}{\PYZdq{}}\PY{p}{,}\PY{+w}{ }\PY{n}{dtype}\PY{p}{)}\PY{p}{,}
\PY{+w}{        }\PY{p}{\PYZcb{}}\PY{p}{;}

\PY{+w}{        }\PY{n+nf+fm}{write!}\PY{p}{(}\PY{n}{html}\PY{p}{,}\PY{+w}{ }\PY{l+s}{\PYZdq{}}\PY{l+s}{\PYZlt{}th\PYZgt{}\PYZob{}\PYZcb{} (\PYZob{}\PYZcb{})\PYZlt{}/th\PYZgt{}}\PY{l+s}{\PYZdq{}}\PY{p}{,}\PY{+w}{ }\PY{n}{col\PYZus{}name}\PY{p}{,}\PY{+w}{ }\PY{n}{type\PYZus{}str}\PY{p}{)}\PY{p}{.}\PY{n}{unwrap}\PY{p}{(}\PY{p}{)}\PY{p}{;}
\PY{+w}{    }\PY{p}{\PYZcb{}}

\PY{+w}{    }\PY{n}{html}\PY{p}{.}\PY{n}{push\PYZus{}str}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{\PYZlt{}/tr\PYZgt{}\PYZlt{}/thead\PYZgt{}}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{;}

\PY{+w}{    }\PY{c+c1}{// Build table body by iterating over rows.}

\PY{+w}{    }\PY{n}{html}\PY{p}{.}\PY{n}{push\PYZus{}str}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{\PYZlt{}tbody\PYZgt{}}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{;}

\PY{+w}{    }\PY{k}{for}\PY{+w}{ }\PY{n}{i}\PY{+w}{ }\PY{k}{in}\PY{+w}{ }\PY{l+m+mi}{0}\PY{o}{..}\PY{n}{df}\PY{p}{.}\PY{n}{height}\PY{p}{(}\PY{p}{)}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{        }\PY{n}{html}\PY{p}{.}\PY{n}{push\PYZus{}str}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{\PYZlt{}tr\PYZgt{}}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{;}

\PY{+w}{        }\PY{k}{for}\PY{+w}{ }\PY{n}{series}\PY{+w}{ }\PY{k}{in}\PY{+w}{ }\PY{n}{df}\PY{p}{.}\PY{n}{get\PYZus{}columns}\PY{p}{(}\PY{p}{)}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{            }\PY{c+c1}{// Get the value, which may be AnyValue::Null.}

\PY{+w}{            }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{cell}\PY{p}{:}\PY{+w}{ }\PY{n+nc}{AnyValue}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{series}\PY{p}{.}\PY{n}{get}\PY{p}{(}\PY{n}{i}\PY{p}{)}\PY{p}{.}\PY{n}{unwrap}\PY{p}{(}\PY{p}{)}\PY{p}{;}

\PY{+w}{            }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{cell\PYZus{}str}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{format\PYZus{}any\PYZus{}value}\PY{p}{(}\PY{o}{\PYZam{}}\PY{n}{cell}\PY{p}{)}\PY{p}{;}

\PY{+w}{            }\PY{n+nf+fm}{write!}\PY{p}{(}\PY{n}{html}\PY{p}{,}\PY{+w}{ }\PY{l+s}{\PYZdq{}}\PY{l+s}{\PYZlt{}td\PYZgt{}\PYZob{}\PYZcb{}\PYZlt{}/td\PYZgt{}}\PY{l+s}{\PYZdq{}}\PY{p}{,}\PY{+w}{ }\PY{n}{cell\PYZus{}str}\PY{p}{)}\PY{p}{.}\PY{n}{unwrap}\PY{p}{(}\PY{p}{)}\PY{p}{;}
\PY{+w}{        }\PY{p}{\PYZcb{}}

\PY{+w}{        }\PY{n}{html}\PY{p}{.}\PY{n}{push\PYZus{}str}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{\PYZlt{}/tr\PYZgt{}}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{;}
\PY{+w}{    }\PY{p}{\PYZcb{}}

\PY{+w}{    }\PY{n}{html}\PY{p}{.}\PY{n}{push\PYZus{}str}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{\PYZlt{}/tbody\PYZgt{}\PYZlt{}/table\PYZgt{}}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{;}

\PY{+w}{    }\PY{n}{html}
\PY{p}{\PYZcb{}}

\PY{l+s+sd}{/// A newtype wrapper for Polars\PYZsq{} DataFrame to enable custom evcxr display.}

\PY{k}{struct}\PY{+w}{ }\PY{n+nc}{HTMLDataFrame}\PY{p}{(}\PY{n}{DataFrame}\PY{p}{)}\PY{p}{;}

\PY{k}{impl}\PY{+w}{ }\PY{n}{HTMLDataFrame}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{    }\PY{l+s+sd}{/// Custom evcxr display method that outputs the HTML representation.}

\PY{+w}{    }\PY{k}{pub}\PY{+w}{ }\PY{k}{fn}\PY{+w}{ }\PY{n+nf}{evcxr\PYZus{}display}\PY{p}{(}\PY{o}{\PYZam{}}\PY{n+nb+bp}{self}\PY{p}{)}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{        }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{html}\PY{p}{:}\PY{+w}{ }\PY{n+nb}{String}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{df\PYZus{}to\PYZus{}html}\PY{p}{(}\PY{o}{\PYZam{}}\PY{n+nb+bp}{self}\PY{p}{.}\PY{l+m+mi}{0}\PY{p}{)}\PY{p}{;}

\PY{+w}{        }\PY{n+nf+fm}{println!}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{EVCXR\PYZus{}BEGIN\PYZus{}CONTENT text/html}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{\PYZob{}\PYZcb{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{EVCXR\PYZus{}END\PYZus{}CONTENT}\PY{l+s}{\PYZdq{}}\PY{p}{,}\PY{+w}{ }\PY{n}{html}\PY{p}{)}\PY{p}{;}
\PY{+w}{    }\PY{p}{\PYZcb{}}
\PY{p}{\PYZcb{}}
\end{Verbatim}
\end{tcolorbox}

    \section{Problem 1}\label{problem-1}

    \subsection{a)}\label{a}

    Initialize data.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{69}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kd}{let}\PY{+w}{ }\PY{n}{df}\PY{p}{:}\PY{+w}{ }\PY{n+nc}{DataFrame}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{df}\PY{o}{!}\PY{p}{(}
\PY{+w}{    }\PY{l+s}{\PYZdq{}}\PY{l+s}{rate type}\PY{l+s}{\PYZdq{}}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{p}{[}\PY{l+s}{\PYZdq{}}\PY{l+s}{cash}\PY{l+s}{\PYZdq{}}\PY{p}{,}\PY{+w}{ }\PY{l+s}{\PYZdq{}}\PY{l+s}{cash}\PY{l+s}{\PYZdq{}}\PY{p}{,}\PY{+w}{ }\PY{l+s}{\PYZdq{}}\PY{l+s}{forwards}\PY{l+s}{\PYZdq{}}\PY{p}{,}\PY{+w}{ }\PY{l+s}{\PYZdq{}}\PY{l+s}{forwards}\PY{l+s}{\PYZdq{}}\PY{p}{,}\PY{+w}{ }\PY{l+s}{\PYZdq{}}\PY{l+s}{forwards}\PY{l+s}{\PYZdq{}}\PY{p}{,}\PY{+w}{ }\PY{l+s}{\PYZdq{}}\PY{l+s}{swaps}\PY{l+s}{\PYZdq{}}\PY{p}{,}\PY{+w}{ }\PY{l+s}{\PYZdq{}}\PY{l+s}{swaps}\PY{l+s}{\PYZdq{}}\PY{p}{,}\PY{+w}{ }\PY{l+s}{\PYZdq{}}\PY{l+s}{swaps}\PY{l+s}{\PYZdq{}}\PY{p}{,}\PY{+w}{ }\PY{l+s}{\PYZdq{}}\PY{l+s}{swaps}\PY{l+s}{\PYZdq{}}\PY{p}{,}\PY{+w}{ }\PY{l+s}{\PYZdq{}}\PY{l+s}{swaps}\PY{l+s}{\PYZdq{}}\PY{p}{]}\PY{p}{,}
\PY{+w}{    }\PY{l+s}{\PYZdq{}}\PY{l+s}{maturity}\PY{l+s}{\PYZdq{}}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{p}{[}\PY{l+m+mf}{1.0}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{2.0}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{3.0}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{4.0}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{5.0}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{6.0}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{7.0}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{8.0}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{9.0}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{10.0}\PY{p}{]}\PY{p}{,}
\PY{+w}{    }\PY{l+s}{\PYZdq{}}\PY{l+s}{inputs}\PY{l+s}{\PYZdq{}}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{p}{[}\PY{l+m+mf}{0.03180}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.03222}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.03261}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.03290}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.03345}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.03405}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.03442}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.03350}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.03300}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.03541}\PY{p}{]}\PY{p}{,}
\PY{+w}{    }\PY{l+s}{\PYZdq{}}\PY{l+s}{bond cash flow}\PY{l+s}{\PYZdq{}}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{p}{[}\PY{l+m+mi}{3}\PY{p}{,}\PY{+w}{ }\PY{l+m+mi}{3}\PY{p}{,}\PY{+w}{ }\PY{l+m+mi}{3}\PY{p}{,}\PY{+w}{ }\PY{l+m+mi}{3}\PY{p}{,}\PY{+w}{ }\PY{l+m+mi}{3}\PY{p}{,}\PY{+w}{ }\PY{l+m+mi}{3}\PY{p}{,}\PY{+w}{ }\PY{l+m+mi}{3}\PY{p}{,}\PY{+w}{ }\PY{l+m+mi}{3}\PY{p}{,}\PY{+w}{ }\PY{l+m+mi}{103}\PY{p}{,}\PY{+w}{ }\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,}
\PY{p}{)}\PY{o}{?}\PY{p}{;}

\PY{n}{LaTeXDataFrame}\PY{p}{(}\PY{n}{df}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}
 
            
\prompt{Out}{outcolor}{69}{}
    
    \begin{tabularx}{\textwidth}{|*4{p{\dimexpr\textwidth/4-2\tabcolsep\relax}|}}
\hlinerate type & maturity & inputs & bond cash flow \\
\hline
cash & 1.0000 & 0.0318 & 3 \\
\hline
cash & 2.0000 & 0.0322 & 3 \\
\hline
forwards & 3.0000 & 0.0326 & 3 \\
\hline
forwards & 4.0000 & 0.0329 & 3 \\
\hline
forwards & 5.0000 & 0.0335 & 3 \\
\hline
swaps & 6.0000 & 0.0340 & 3 \\
\hline
swaps & 7.0000 & 0.0344 & 3 \\
\hline
swaps & 8.0000 & 0.0335 & 3 \\
\hline
swaps & 9.0000 & 0.0330 & 103 \\
\hline
swaps & 10.0000 & 0.0354 & 0 \\
\hline
\end{tabularx}

    

    Place the inputs into their appropriate curves.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{70}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kd}{let}\PY{+w}{ }\PY{n}{df}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{df}
\PY{+w}{    }\PY{p}{.}\PY{n}{lazy}\PY{p}{(}\PY{p}{)}
\PY{+w}{    }\PY{p}{.}\PY{n}{with\PYZus{}column}\PY{p}{(}
\PY{+w}{        }\PY{n}{when}\PY{p}{(}\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{rate type}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{.}\PY{n}{eq}\PY{p}{(}\PY{n}{lit}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{cash}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\PY{+w}{            }\PY{p}{.}\PY{n}{then}\PY{p}{(}\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{inputs}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
\PY{+w}{            }\PY{p}{.}\PY{n}{otherwise}\PY{p}{(}\PY{n}{lit}\PY{p}{(}\PY{n}{NULL}\PY{p}{)}\PY{p}{)}
\PY{+w}{            }\PY{p}{.}\PY{n}{alias}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{zero curve}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{+w}{    }\PY{p}{)}
\PY{+w}{    }\PY{p}{.}\PY{n}{with\PYZus{}column}\PY{p}{(}
\PY{+w}{        }\PY{n}{when}\PY{p}{(}\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{rate type}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{.}\PY{n}{eq}\PY{p}{(}\PY{n}{lit}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{forwards}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\PY{+w}{            }\PY{p}{.}\PY{n}{then}\PY{p}{(}\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{inputs}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
\PY{+w}{            }\PY{p}{.}\PY{n}{otherwise}\PY{p}{(}\PY{n}{lit}\PY{p}{(}\PY{n}{NULL}\PY{p}{)}\PY{p}{)}
\PY{+w}{            }\PY{p}{.}\PY{n}{alias}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{forward curve}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{+w}{    }\PY{p}{)}
\PY{+w}{    }\PY{p}{.}\PY{n}{with\PYZus{}column}\PY{p}{(}
\PY{+w}{        }\PY{n}{when}\PY{p}{(}\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{rate type}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{.}\PY{n}{eq}\PY{p}{(}\PY{n}{lit}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{swaps}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\PY{+w}{            }\PY{p}{.}\PY{n}{then}\PY{p}{(}\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{inputs}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
\PY{+w}{            }\PY{p}{.}\PY{n}{otherwise}\PY{p}{(}\PY{n}{lit}\PY{p}{(}\PY{n}{NULL}\PY{p}{)}\PY{p}{)}
\PY{+w}{            }\PY{p}{.}\PY{n}{alias}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{par curve}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{+w}{    }\PY{p}{)}
\PY{+w}{    }\PY{p}{.}\PY{n}{collect}\PY{p}{(}\PY{p}{)}\PY{o}{?}\PY{p}{;}

\PY{n}{LaTeXDataFrame}\PY{p}{(}\PY{n}{df}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}
 
            
\prompt{Out}{outcolor}{70}{}
    
    \begin{tabularx}{\textwidth}{|*7{p{\dimexpr\textwidth/7-2\tabcolsep\relax}|}}
\hlinerate type & maturity & inputs & bond cash flow & zero curve & forward curve & par curve \\
\hline
cash & 1.0000 & 0.0318 & 3 & 0.0318 & null & null \\
\hline
cash & 2.0000 & 0.0322 & 3 & 0.0322 & null & null \\
\hline
forwards & 3.0000 & 0.0326 & 3 & null & 0.0326 & null \\
\hline
forwards & 4.0000 & 0.0329 & 3 & null & 0.0329 & null \\
\hline
forwards & 5.0000 & 0.0335 & 3 & null & 0.0335 & null \\
\hline
swaps & 6.0000 & 0.0340 & 3 & null & null & 0.0340 \\
\hline
swaps & 7.0000 & 0.0344 & 3 & null & null & 0.0344 \\
\hline
swaps & 8.0000 & 0.0335 & 3 & null & null & 0.0335 \\
\hline
swaps & 9.0000 & 0.0330 & 103 & null & null & 0.0330 \\
\hline
swaps & 10.0000 & 0.0354 & 0 & null & null & 0.0354 \\
\hline
\end{tabularx}

    

    Bootstrap forwards from zero curve.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{71}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{fn}\PY{+w}{ }\PY{n+nf}{bootstrap\PYZus{}forward}\PY{p}{(}\PY{k}{mut}\PY{+w}{ }\PY{n}{df}\PY{p}{:}\PY{+w}{ }\PY{n+nc}{DataFrame}\PY{p}{)}\PY{+w}{ }\PY{p}{\PYZhy{}\PYZgt{}}\PY{+w}{ }\PY{n+nc}{PolarsResult}\PY{o}{\PYZlt{}}\PY{n}{DataFrame}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{    }\PY{k+kd}{let}\PY{+w}{ }\PY{k}{mut}\PY{+w}{ }\PY{n}{bootstrapped\PYZus{}forward\PYZus{}curve}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{k}{match}\PY{+w}{ }\PY{n}{df}\PY{p}{.}\PY{n}{column}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{forward curve}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{        }\PY{n+nb}{Ok}\PY{p}{(}\PY{n}{col}\PY{p}{)}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{n}{col}\PY{p}{.}\PY{k+kt}{f64}\PY{p}{(}\PY{p}{)}\PY{o}{?}\PY{p}{.}\PY{n}{to\PYZus{}vec}\PY{p}{(}\PY{p}{)}\PY{p}{,}

\PY{+w}{        }\PY{c+c1}{// forward curve does not exist, initialize with first zero curve value}
\PY{+w}{        }\PY{n+nb}{Err}\PY{p}{(}\PY{n}{\PYZus{}}\PY{p}{)}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{            }\PY{k+kd}{let}\PY{+w}{ }\PY{k}{mut}\PY{+w}{ }\PY{n}{b}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n+nf+fm}{vec!}\PY{p}{[}\PY{n+nb}{None}\PY{p}{;}\PY{+w}{ }\PY{n}{df}\PY{p}{.}\PY{n}{height}\PY{p}{(}\PY{p}{)}\PY{p}{]}\PY{p}{;}

\PY{+w}{            }\PY{n}{b}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n+nb}{Some}\PY{p}{(}\PY{n}{df}\PY{p}{.}\PY{n}{column}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{zero curve}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{o}{?}\PY{p}{.}\PY{k+kt}{f64}\PY{p}{(}\PY{p}{)}\PY{o}{?}\PY{p}{.}\PY{n}{get}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{)}\PY{p}{.}\PY{n}{unwrap}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{;}

\PY{+w}{            }\PY{n}{b}
\PY{+w}{        }\PY{p}{\PYZcb{}}
\PY{+w}{    }\PY{p}{\PYZcb{}}\PY{p}{;}

\PY{+w}{    }\PY{c+c1}{// initialize with value with zero curve, since zero = forward for maturity = 1}

\PY{+w}{    }\PY{n}{bootstrapped\PYZus{}forward\PYZus{}curve}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n+nb}{Some}\PY{p}{(}\PY{n}{df}\PY{p}{.}\PY{n}{column}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{zero curve}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{o}{?}\PY{p}{.}\PY{k+kt}{f64}\PY{p}{(}\PY{p}{)}\PY{o}{?}\PY{p}{.}\PY{n}{get}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{)}\PY{p}{.}\PY{n}{unwrap}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{;}

\PY{+w}{    }\PY{c+c1}{// bootstrap from start of null}

\PY{+w}{    }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{start\PYZus{}idx}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{bootstrapped\PYZus{}forward\PYZus{}curve}
\PY{+w}{        }\PY{p}{.}\PY{n}{iter}\PY{p}{(}\PY{p}{)}
\PY{+w}{        }\PY{p}{.}\PY{n}{position}\PY{p}{(}\PY{o}{|}\PY{o}{\PYZam{}}\PY{n}{x}\PY{o}{|}\PY{+w}{ }\PY{n}{x}\PY{p}{.}\PY{n}{is\PYZus{}none}\PY{p}{(}\PY{p}{)}\PY{p}{)}
\PY{+w}{        }\PY{p}{.}\PY{n}{unwrap}\PY{p}{(}\PY{p}{)}\PY{p}{;}

\PY{+w}{    }\PY{k}{for}\PY{+w}{ }\PY{n}{i}\PY{+w}{ }\PY{k}{in}\PY{+w}{ }\PY{n}{start\PYZus{}idx}\PY{o}{..}\PY{n}{df}\PY{p}{.}\PY{n}{height}\PY{p}{(}\PY{p}{)}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{        }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{zero\PYZus{}val\PYZus{}opt}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{df}\PY{p}{.}\PY{n}{column}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{zero curve}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{o}{?}\PY{p}{.}\PY{k+kt}{f64}\PY{p}{(}\PY{p}{)}\PY{o}{?}\PY{p}{.}\PY{n}{get}\PY{p}{(}\PY{n}{i}\PY{p}{)}\PY{p}{;}

\PY{+w}{        }\PY{n}{bootstrapped\PYZus{}forward\PYZus{}curve}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{k}{if}\PY{+w}{ }\PY{k+kd}{let}\PY{+w}{ }\PY{n+nb}{Some}\PY{p}{(}\PY{n}{zero\PYZus{}val}\PY{p}{)}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{zero\PYZus{}val\PYZus{}opt}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{            }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{maturity\PYZus{}val}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{df}\PY{p}{.}\PY{n}{column}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{maturity}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{o}{?}\PY{p}{.}\PY{k+kt}{f64}\PY{p}{(}\PY{p}{)}\PY{o}{?}\PY{p}{.}\PY{n}{get}\PY{p}{(}\PY{n}{i}\PY{p}{)}\PY{p}{.}\PY{n}{unwrap}\PY{p}{(}\PY{p}{)}\PY{p}{;}

\PY{+w}{            }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{previous\PYZus{}forward\PYZus{}vals}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{o}{\PYZam{}}\PY{n}{bootstrapped\PYZus{}forward\PYZus{}curve}\PY{p}{[}\PY{o}{..}\PY{n}{i}\PY{p}{]}\PY{p}{;}

\PY{+w}{            }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{prod}\PY{p}{:}\PY{+w}{ }\PY{k+kt}{f64}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{previous\PYZus{}forward\PYZus{}vals}
\PY{+w}{                }\PY{p}{.}\PY{n}{iter}\PY{p}{(}\PY{p}{)}
\PY{+w}{                }\PY{p}{.}\PY{n}{map}\PY{p}{(}\PY{o}{|}\PY{n}{x}\PY{o}{|}\PY{+w}{ }\PY{l+m+mf}{1.0}\PY{+w}{ }\PY{o}{/}\PY{+w}{ }\PY{p}{(}\PY{l+m+mf}{1.0}\PY{+w}{ }\PY{o}{+}\PY{+w}{ }\PY{n}{x}\PY{p}{.}\PY{n}{unwrap\PYZus{}or}\PY{p}{(}\PY{l+m+mf}{0.0}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\PY{+w}{                }\PY{p}{.}\PY{n}{product}\PY{p}{(}\PY{p}{)}\PY{p}{;}

\PY{+w}{            }\PY{n+nb}{Some}\PY{p}{(}\PY{p}{(}\PY{n}{zero\PYZus{}val}\PY{+w}{ }\PY{o}{+}\PY{+w}{ }\PY{l+m+mf}{1.0}\PY{p}{)}\PY{p}{.}\PY{n}{powf}\PY{p}{(}\PY{n}{maturity\PYZus{}val}\PY{p}{)}\PY{+w}{ }\PY{o}{*}\PY{+w}{ }\PY{n}{prod}\PY{+w}{ }\PY{o}{\PYZhy{}}\PY{+w}{ }\PY{l+m+mf}{1.0}\PY{p}{)}
\PY{+w}{        }\PY{p}{\PYZcb{}}\PY{+w}{ }\PY{k}{else}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{            }\PY{n+nb}{None}
\PY{+w}{        }\PY{p}{\PYZcb{}}\PY{p}{;}
\PY{+w}{    }\PY{p}{\PYZcb{}}

\PY{+w}{    }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{bootstrapped\PYZus{}series}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{Column}\PY{p}{::}\PY{n}{new}\PY{p}{(}
\PY{+w}{        }\PY{l+s}{\PYZdq{}}\PY{l+s}{bootstrapped forward curve}\PY{l+s}{\PYZdq{}}\PY{p}{.}\PY{n}{into}\PY{p}{(}\PY{p}{)}\PY{p}{,}
\PY{+w}{        }\PY{n}{bootstrapped\PYZus{}forward\PYZus{}curve}\PY{p}{,}
\PY{+w}{    }\PY{p}{)}\PY{p}{;}

\PY{+w}{    }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{forward\PYZus{}series}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{df}\PY{p}{.}\PY{n}{column}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{forward curve}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{o}{?}\PY{p}{;}

\PY{+w}{    }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{mask}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{forward\PYZus{}series}\PY{p}{.}\PY{n}{is\PYZus{}not\PYZus{}null}\PY{p}{(}\PY{p}{)}\PY{p}{;}

\PY{+w}{    }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{updated\PYZus{}forward\PYZus{}series}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{forward\PYZus{}series}\PY{p}{.}\PY{n}{zip\PYZus{}with}\PY{p}{(}\PY{o}{\PYZam{}}\PY{n}{mask}\PY{p}{,}\PY{+w}{ }\PY{o}{\PYZam{}}\PY{n}{bootstrapped\PYZus{}series}\PY{p}{)}\PY{o}{?}\PY{p}{;}

\PY{+w}{    }\PY{n}{df}\PY{p}{.}\PY{n}{replace}\PY{p}{(}
\PY{+w}{        }\PY{l+s}{\PYZdq{}}\PY{l+s}{forward curve}\PY{l+s}{\PYZdq{}}\PY{p}{,}
\PY{+w}{        }\PY{n}{updated\PYZus{}forward\PYZus{}series}\PY{p}{.}\PY{n}{as\PYZus{}series}\PY{p}{(}\PY{p}{)}\PY{p}{.}\PY{n}{unwrap}\PY{p}{(}\PY{p}{)}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{,}
\PY{+w}{    }\PY{p}{)}\PY{o}{?}\PY{p}{;}

\PY{+w}{    }\PY{n+nb}{Ok}\PY{p}{(}\PY{n}{df}\PY{p}{)}
\PY{p}{\PYZcb{}}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{72}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kd}{let}\PY{+w}{ }\PY{n}{df}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{bootstrap\PYZus{}forward}\PY{p}{(}\PY{n}{df}\PY{p}{)}\PY{o}{?}\PY{p}{;}
\PY{n}{LaTeXDataFrame}\PY{p}{(}\PY{n}{df}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}
 
            
\prompt{Out}{outcolor}{72}{}
    
    \begin{tabularx}{\textwidth}{|*7{p{\dimexpr\textwidth/7-2\tabcolsep\relax}|}}
\hlinerate type & maturity & inputs & bond cash flow & zero curve & forward curve & par curve \\
\hline
cash & 1.0000 & 0.0318 & 3 & 0.0318 & 0.0318 & null \\
\hline
cash & 2.0000 & 0.0322 & 3 & 0.0322 & 0.0326 & null \\
\hline
forwards & 3.0000 & 0.0326 & 3 & null & 0.0326 & null \\
\hline
forwards & 4.0000 & 0.0329 & 3 & null & 0.0329 & null \\
\hline
forwards & 5.0000 & 0.0335 & 3 & null & 0.0335 & null \\
\hline
swaps & 6.0000 & 0.0340 & 3 & null & null & 0.0340 \\
\hline
swaps & 7.0000 & 0.0344 & 3 & null & null & 0.0344 \\
\hline
swaps & 8.0000 & 0.0335 & 3 & null & null & 0.0335 \\
\hline
swaps & 9.0000 & 0.0330 & 103 & null & null & 0.0330 \\
\hline
swaps & 10.0000 & 0.0354 & 0 & null & null & 0.0354 \\
\hline
\end{tabularx}

    

    Create the discount curve from the forward curve.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{73}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kd}{let}\PY{+w}{ }\PY{n}{df}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{df}
\PY{+w}{    }\PY{p}{.}\PY{n}{lazy}\PY{p}{(}\PY{p}{)}
\PY{+w}{    }\PY{p}{.}\PY{n}{with\PYZus{}column}\PY{p}{(}
\PY{+w}{        }\PY{n}{when}\PY{p}{(}\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{forward curve}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{.}\PY{n}{is\PYZus{}not\PYZus{}null}\PY{p}{(}\PY{p}{)}\PY{p}{)}
\PY{+w}{            }\PY{p}{.}\PY{n}{then}\PY{p}{(}\PY{n}{lit}\PY{p}{(}\PY{l+m+mf}{1.0}\PY{p}{)}\PY{+w}{ }\PY{o}{/}\PY{+w}{ }\PY{p}{(}\PY{n}{lit}\PY{p}{(}\PY{l+m+mf}{1.0}\PY{p}{)}\PY{+w}{ }\PY{o}{+}\PY{+w}{ }\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{forward curve}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{p}{.}\PY{n}{cum\PYZus{}prod}\PY{p}{(}\PY{k+kc}{false}\PY{p}{)}\PY{p}{)}
\PY{+w}{            }\PY{p}{.}\PY{n}{otherwise}\PY{p}{(}\PY{n}{lit}\PY{p}{(}\PY{n}{NULL}\PY{p}{)}\PY{p}{)}
\PY{+w}{            }\PY{p}{.}\PY{n}{alias}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{discount curve}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{+w}{    }\PY{p}{)}
\PY{+w}{    }\PY{p}{.}\PY{n}{collect}\PY{p}{(}\PY{p}{)}\PY{o}{?}\PY{p}{;}

\PY{n}{LaTeXDataFrame}\PY{p}{(}\PY{n}{df}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}
 
            
\prompt{Out}{outcolor}{73}{}
    
    \begin{tabularx}{\textwidth}{|*8{p{\dimexpr\textwidth/8-2\tabcolsep\relax}|}}
\hlinerate type & maturity & inputs & bond cash flow & zero curve & forward curve & par curve & discount curve \\
\hline
cash & 1.0000 & 0.0318 & 3 & 0.0318 & 0.0318 & null & 0.9692 \\
\hline
cash & 2.0000 & 0.0322 & 3 & 0.0322 & 0.0326 & null & 0.9385 \\
\hline
forwards & 3.0000 & 0.0326 & 3 & null & 0.0326 & null & 0.9089 \\
\hline
forwards & 4.0000 & 0.0329 & 3 & null & 0.0329 & null & 0.8800 \\
\hline
forwards & 5.0000 & 0.0335 & 3 & null & 0.0335 & null & 0.8515 \\
\hline
swaps & 6.0000 & 0.0340 & 3 & null & null & 0.0340 & null \\
\hline
swaps & 7.0000 & 0.0344 & 3 & null & null & 0.0344 & null \\
\hline
swaps & 8.0000 & 0.0335 & 3 & null & null & 0.0335 & null \\
\hline
swaps & 9.0000 & 0.0330 & 103 & null & null & 0.0330 & null \\
\hline
swaps & 10.0000 & 0.0354 & 0 & null & null & 0.0354 & null \\
\hline
\end{tabularx}

    

    Fill in the par curve from the discount curve.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{74}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kd}{let}\PY{+w}{ }\PY{n}{df}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{df}
\PY{+w}{    }\PY{p}{.}\PY{n}{lazy}\PY{p}{(}\PY{p}{)}
\PY{+w}{    }\PY{p}{.}\PY{n}{with\PYZus{}column}\PY{p}{(}
\PY{+w}{        }\PY{n}{when}\PY{p}{(}\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{discount curve}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{.}\PY{n}{is\PYZus{}not\PYZus{}null}\PY{p}{(}\PY{p}{)}\PY{p}{)}
\PY{+w}{            }\PY{p}{.}\PY{n}{then}\PY{p}{(}\PY{p}{(}\PY{n}{lit}\PY{p}{(}\PY{l+m+mf}{1.0}\PY{p}{)}\PY{+w}{ }\PY{o}{\PYZhy{}}\PY{+w}{ }\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{discount curve}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{+w}{ }\PY{o}{/}\PY{+w}{ }\PY{p}{(}\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{discount curve}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{.}\PY{n}{cum\PYZus{}sum}\PY{p}{(}\PY{k+kc}{false}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\PY{+w}{            }\PY{p}{.}\PY{n}{otherwise}\PY{p}{(}\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{par curve}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
\PY{+w}{            }\PY{p}{.}\PY{n}{alias}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{par curve}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{+w}{    }\PY{p}{)}
\PY{+w}{    }\PY{p}{.}\PY{n}{collect}\PY{p}{(}\PY{p}{)}\PY{o}{?}\PY{p}{;}

\PY{n}{LaTeXDataFrame}\PY{p}{(}\PY{n}{df}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}
 
            
\prompt{Out}{outcolor}{74}{}
    
    \begin{tabularx}{\textwidth}{|*8{p{\dimexpr\textwidth/8-2\tabcolsep\relax}|}}
\hlinerate type & maturity & inputs & bond cash flow & zero curve & forward curve & par curve & discount curve \\
\hline
cash & 1.0000 & 0.0318 & 3 & 0.0318 & 0.0318 & 0.0318 & 0.9692 \\
\hline
cash & 2.0000 & 0.0322 & 3 & 0.0322 & 0.0326 & 0.0322 & 0.9385 \\
\hline
forwards & 3.0000 & 0.0326 & 3 & null & 0.0326 & 0.0323 & 0.9089 \\
\hline
forwards & 4.0000 & 0.0329 & 3 & null & 0.0329 & 0.0325 & 0.8800 \\
\hline
forwards & 5.0000 & 0.0335 & 3 & null & 0.0335 & 0.0327 & 0.8515 \\
\hline
swaps & 6.0000 & 0.0340 & 3 & null & null & 0.0340 & null \\
\hline
swaps & 7.0000 & 0.0344 & 3 & null & null & 0.0344 & null \\
\hline
swaps & 8.0000 & 0.0335 & 3 & null & null & 0.0335 & null \\
\hline
swaps & 9.0000 & 0.0330 & 103 & null & null & 0.0330 & null \\
\hline
swaps & 10.0000 & 0.0354 & 0 & null & null & 0.0354 & null \\
\hline
\end{tabularx}

    

    Bootstrap the rest of the discount curve from the par curve.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{75}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{fn}\PY{+w}{ }\PY{n+nf}{bootstrap\PYZus{}discount}\PY{p}{(}\PY{k}{mut}\PY{+w}{ }\PY{n}{df}\PY{p}{:}\PY{+w}{ }\PY{n+nc}{DataFrame}\PY{p}{)}\PY{+w}{ }\PY{p}{\PYZhy{}\PYZgt{}}\PY{+w}{ }\PY{n+nc}{PolarsResult}\PY{o}{\PYZlt{}}\PY{n}{DataFrame}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{    }\PY{k+kd}{let}\PY{+w}{ }\PY{k}{mut}\PY{+w}{ }\PY{n}{bootstrapped\PYZus{}discount\PYZus{}curve}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{df}\PY{p}{.}\PY{n}{column}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{discount curve}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{o}{?}\PY{p}{.}\PY{k+kt}{f64}\PY{p}{(}\PY{p}{)}\PY{o}{?}\PY{p}{.}\PY{n}{to\PYZus{}vec}\PY{p}{(}\PY{p}{)}\PY{p}{;}

\PY{+w}{    }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{start\PYZus{}idx}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{bootstrapped\PYZus{}discount\PYZus{}curve}
\PY{+w}{        }\PY{p}{.}\PY{n}{iter}\PY{p}{(}\PY{p}{)}
\PY{+w}{        }\PY{p}{.}\PY{n}{position}\PY{p}{(}\PY{o}{|}\PY{o}{\PYZam{}}\PY{n}{x}\PY{o}{|}\PY{+w}{ }\PY{n}{x}\PY{p}{.}\PY{n}{is\PYZus{}none}\PY{p}{(}\PY{p}{)}\PY{p}{)}
\PY{+w}{        }\PY{p}{.}\PY{n}{unwrap}\PY{p}{(}\PY{p}{)}\PY{p}{;}

\PY{+w}{    }\PY{k}{for}\PY{+w}{ }\PY{n}{i}\PY{+w}{ }\PY{k}{in}\PY{+w}{ }\PY{n}{start\PYZus{}idx}\PY{o}{..}\PY{n}{bootstrapped\PYZus{}discount\PYZus{}curve}\PY{p}{.}\PY{n}{len}\PY{p}{(}\PY{p}{)}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{        }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{par\PYZus{}val\PYZus{}opt}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{df}\PY{p}{.}\PY{n}{column}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{par curve}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{o}{?}\PY{p}{.}\PY{k+kt}{f64}\PY{p}{(}\PY{p}{)}\PY{o}{?}\PY{p}{.}\PY{n}{get}\PY{p}{(}\PY{n}{i}\PY{p}{)}\PY{p}{;}

\PY{+w}{        }\PY{n}{bootstrapped\PYZus{}discount\PYZus{}curve}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{k}{if}\PY{+w}{ }\PY{k+kd}{let}\PY{+w}{ }\PY{n+nb}{Some}\PY{p}{(}\PY{n}{par\PYZus{}val}\PY{p}{)}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{par\PYZus{}val\PYZus{}opt}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{            }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{previous\PYZus{}discount\PYZus{}vals}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{o}{\PYZam{}}\PY{n}{bootstrapped\PYZus{}discount\PYZus{}curve}\PY{p}{[}\PY{o}{..}\PY{n}{i}\PY{p}{]}\PY{p}{;}

\PY{+w}{            }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{sum}\PY{p}{:}\PY{+w}{ }\PY{k+kt}{f64}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{previous\PYZus{}discount\PYZus{}vals}
\PY{+w}{                }\PY{p}{.}\PY{n}{iter}\PY{p}{(}\PY{p}{)}
\PY{+w}{                }\PY{p}{.}\PY{n}{map}\PY{p}{(}\PY{o}{|}\PY{n}{x}\PY{o}{|}\PY{+w}{ }\PY{n}{x}\PY{p}{.}\PY{n}{unwrap\PYZus{}or}\PY{p}{(}\PY{l+m+mf}{0.0}\PY{p}{)}\PY{p}{)}
\PY{+w}{                }\PY{p}{.}\PY{n}{sum}\PY{p}{(}\PY{p}{)}\PY{p}{;}

\PY{+w}{            }\PY{n+nb}{Some}\PY{p}{(}\PY{p}{(}\PY{l+m+mf}{1.0}\PY{+w}{ }\PY{o}{\PYZhy{}}\PY{+w}{ }\PY{n}{par\PYZus{}val}\PY{+w}{ }\PY{o}{*}\PY{+w}{ }\PY{n}{sum}\PY{p}{)}\PY{+w}{ }\PY{o}{/}\PY{+w}{ }\PY{p}{(}\PY{l+m+mf}{1.0}\PY{+w}{ }\PY{o}{+}\PY{+w}{ }\PY{n}{par\PYZus{}val}\PY{p}{)}\PY{p}{)}
\PY{+w}{        }\PY{p}{\PYZcb{}}\PY{+w}{ }\PY{k}{else}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{            }\PY{n+nb}{None}
\PY{+w}{        }\PY{p}{\PYZcb{}}\PY{p}{;}
\PY{+w}{    }\PY{p}{\PYZcb{}}

\PY{+w}{    }\PY{n}{df}\PY{p}{.}\PY{n}{replace}\PY{p}{(}
\PY{+w}{        }\PY{l+s}{\PYZdq{}}\PY{l+s}{discount curve}\PY{l+s}{\PYZdq{}}\PY{p}{,}
\PY{+w}{        }\PY{n}{Series}\PY{p}{::}\PY{n}{new}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{discount curve}\PY{l+s}{\PYZdq{}}\PY{p}{.}\PY{n}{into}\PY{p}{(}\PY{p}{)}\PY{p}{,}\PY{+w}{ }\PY{n}{bootstrapped\PYZus{}discount\PYZus{}curve}\PY{p}{)}\PY{p}{,}
\PY{+w}{    }\PY{p}{)}\PY{o}{?}\PY{p}{;}

\PY{+w}{    }\PY{n+nb}{Ok}\PY{p}{(}\PY{n}{df}\PY{p}{)}
\PY{p}{\PYZcb{}}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{76}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kd}{let}\PY{+w}{ }\PY{n}{df}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{bootstrap\PYZus{}discount}\PY{p}{(}\PY{n}{df}\PY{p}{)}\PY{o}{?}\PY{p}{;}
\PY{n}{LaTeXDataFrame}\PY{p}{(}\PY{n}{df}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}
 
            
\prompt{Out}{outcolor}{76}{}
    
    \begin{tabularx}{\textwidth}{|*8{p{\dimexpr\textwidth/8-2\tabcolsep\relax}|}}
\hlinerate type & maturity & inputs & bond cash flow & zero curve & forward curve & par curve & discount curve \\
\hline
cash & 1.0000 & 0.0318 & 3 & 0.0318 & 0.0318 & 0.0318 & 0.9692 \\
\hline
cash & 2.0000 & 0.0322 & 3 & 0.0322 & 0.0326 & 0.0322 & 0.9385 \\
\hline
forwards & 3.0000 & 0.0326 & 3 & null & 0.0326 & 0.0323 & 0.9089 \\
\hline
forwards & 4.0000 & 0.0329 & 3 & null & 0.0329 & 0.0325 & 0.8800 \\
\hline
forwards & 5.0000 & 0.0335 & 3 & null & 0.0335 & 0.0327 & 0.8515 \\
\hline
swaps & 6.0000 & 0.0340 & 3 & null & null & 0.0340 & 0.8173 \\
\hline
swaps & 7.0000 & 0.0344 & 3 & null & null & 0.0344 & 0.7882 \\
\hline
swaps & 8.0000 & 0.0335 & 3 & null & null & 0.0335 & 0.7681 \\
\hline
swaps & 9.0000 & 0.0330 & 103 & null & null & 0.0330 & 0.7469 \\
\hline
swaps & 10.0000 & 0.0354 & 0 & null & null & 0.0354 & 0.7035 \\
\hline
\end{tabularx}

    

    Get the zero curve from the discount curve.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{77}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kd}{let}\PY{+w}{ }\PY{n}{df}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{df}
\PY{+w}{    }\PY{p}{.}\PY{n}{lazy}\PY{p}{(}\PY{p}{)}
\PY{+w}{    }\PY{p}{.}\PY{n}{with\PYZus{}column}\PY{p}{(}
\PY{+w}{        }\PY{n}{when}\PY{p}{(}\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{zero curve}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{.}\PY{n}{is\PYZus{}null}\PY{p}{(}\PY{p}{)}\PY{p}{)}
\PY{+w}{            }\PY{p}{.}\PY{n}{then}\PY{p}{(}\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{discount curve}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{.}\PY{n}{pow}\PY{p}{(}\PY{n}{lit}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mf}{1.0}\PY{p}{)}\PY{+w}{ }\PY{o}{/}\PY{+w}{ }\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{maturity}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{+w}{ }\PY{o}{\PYZhy{}}\PY{+w}{ }\PY{n}{lit}\PY{p}{(}\PY{l+m+mf}{1.0}\PY{p}{)}\PY{p}{)}
\PY{+w}{            }\PY{p}{.}\PY{n}{otherwise}\PY{p}{(}\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{zero curve}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
\PY{+w}{            }\PY{p}{.}\PY{n}{alias}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{zero curve}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{+w}{    }\PY{p}{)}
\PY{+w}{    }\PY{p}{.}\PY{n}{collect}\PY{p}{(}\PY{p}{)}\PY{o}{?}\PY{p}{;}

\PY{n}{LaTeXDataFrame}\PY{p}{(}\PY{n}{df}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}
 
            
\prompt{Out}{outcolor}{77}{}
    
    \begin{tabularx}{\textwidth}{|*8{p{\dimexpr\textwidth/8-2\tabcolsep\relax}|}}
\hlinerate type & maturity & inputs & bond cash flow & zero curve & forward curve & par curve & discount curve \\
\hline
cash & 1.0000 & 0.0318 & 3 & 0.0318 & 0.0318 & 0.0318 & 0.9692 \\
\hline
cash & 2.0000 & 0.0322 & 3 & 0.0322 & 0.0326 & 0.0322 & 0.9385 \\
\hline
forwards & 3.0000 & 0.0326 & 3 & 0.0323 & 0.0326 & 0.0323 & 0.9089 \\
\hline
forwards & 4.0000 & 0.0329 & 3 & 0.0325 & 0.0329 & 0.0325 & 0.8800 \\
\hline
forwards & 5.0000 & 0.0335 & 3 & 0.0327 & 0.0335 & 0.0327 & 0.8515 \\
\hline
swaps & 6.0000 & 0.0340 & 3 & 0.0342 & null & 0.0340 & 0.8173 \\
\hline
swaps & 7.0000 & 0.0344 & 3 & 0.0346 & null & 0.0344 & 0.7882 \\
\hline
swaps & 8.0000 & 0.0335 & 3 & 0.0335 & null & 0.0335 & 0.7681 \\
\hline
swaps & 9.0000 & 0.0330 & 103 & 0.0330 & null & 0.0330 & 0.7469 \\
\hline
swaps & 10.0000 & 0.0354 & 0 & 0.0358 & null & 0.0354 & 0.7035 \\
\hline
\end{tabularx}

    

    Continue bootstrapping forward curve with finished zero curve.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{78}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kd}{let}\PY{+w}{ }\PY{n}{df}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{bootstrap\PYZus{}forward}\PY{p}{(}\PY{n}{df}\PY{p}{)}\PY{o}{?}\PY{p}{;}
\PY{n}{LaTeXDataFrame}\PY{p}{(}\PY{n}{df}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}
 
            
\prompt{Out}{outcolor}{78}{}
    
    \begin{tabularx}{\textwidth}{|*8{p{\dimexpr\textwidth/8-2\tabcolsep\relax}|}}
\hlinerate type & maturity & inputs & bond cash flow & zero curve & forward curve & par curve & discount curve \\
\hline
cash & 1.0000 & 0.0318 & 3 & 0.0318 & 0.0318 & 0.0318 & 0.9692 \\
\hline
cash & 2.0000 & 0.0322 & 3 & 0.0322 & 0.0326 & 0.0322 & 0.9385 \\
\hline
forwards & 3.0000 & 0.0326 & 3 & 0.0323 & 0.0326 & 0.0323 & 0.9089 \\
\hline
forwards & 4.0000 & 0.0329 & 3 & 0.0325 & 0.0329 & 0.0325 & 0.8800 \\
\hline
forwards & 5.0000 & 0.0335 & 3 & 0.0327 & 0.0335 & 0.0327 & 0.8515 \\
\hline
swaps & 6.0000 & 0.0340 & 3 & 0.0342 & 0.0418 & 0.0340 & 0.8173 \\
\hline
swaps & 7.0000 & 0.0344 & 3 & 0.0346 & 0.0369 & 0.0344 & 0.7882 \\
\hline
swaps & 8.0000 & 0.0335 & 3 & 0.0335 & 0.0261 & 0.0335 & 0.7681 \\
\hline
swaps & 9.0000 & 0.0330 & 103 & 0.0330 & 0.0284 & 0.0330 & 0.7469 \\
\hline
swaps & 10.0000 & 0.0354 & 0 & 0.0358 & 0.0617 & 0.0354 & 0.7035 \\
\hline
\end{tabularx}

    

    \subsection{b)}\label{b}

    Get present value of the bond cash flows.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{79}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kd}{let}\PY{+w}{ }\PY{n}{pv}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{p}{(}\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{discount curve}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{+w}{ }\PY{o}{*}\PY{+w}{ }\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{bond cash flow}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
\PY{+w}{    }\PY{p}{.}\PY{n}{sum}\PY{p}{(}\PY{p}{)}
\PY{+w}{    }\PY{p}{.}\PY{n}{alias}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{pv}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{;}

\PY{n}{LaTeXDataFrame}\PY{p}{(}\PY{n}{df}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{.}\PY{n}{lazy}\PY{p}{(}\PY{p}{)}\PY{p}{.}\PY{n}{select}\PY{p}{(}\PY{p}{[}\PY{n}{pv}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{]}\PY{p}{)}\PY{p}{.}\PY{n}{collect}\PY{p}{(}\PY{p}{)}\PY{o}{?}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}
 
            
\prompt{Out}{outcolor}{79}{}
    
    \begin{tabularx}{\textwidth}{|*1{p{\dimexpr\textwidth/1-2\tabcolsep\relax}|}}
\hlinepv \\
\hline
97.6994 \\
\hline
\end{tabularx}

    

    \subsection{c)}\label{c}

    We will need to calculate DV01, the dollar value of one basis point:

\[DV01 = -\frac{\Delta P}{10,000 \cdot \Delta y}\]

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{80}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{const}\PY{+w}{ }\PY{n}{BP}\PY{p}{:}\PY{+w}{ }\PY{k+kt}{f64}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{l+m+mf}{0.0001}\PY{p}{;}

\PY{k+kd}{let}\PY{+w}{ }\PY{n}{discount\PYZus{}curve\PYZus{}up}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{p}{(}\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{discount curve}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{+w}{ }\PY{o}{/}\PY{+w}{ }\PY{n}{lit}\PY{p}{(}\PY{l+m+mf}{1.0}\PY{+w}{ }\PY{o}{+}\PY{+w}{ }\PY{n}{BP}\PY{p}{)}\PY{p}{)}\PY{p}{.}\PY{n}{alias}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{discount curve up}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{;}

\PY{k+kd}{let}\PY{+w}{ }\PY{n}{discount\PYZus{}curve\PYZus{}down}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{p}{(}\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{discount curve}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{+w}{ }\PY{o}{*}\PY{+w}{ }\PY{n}{lit}\PY{p}{(}\PY{l+m+mf}{1.0}\PY{+w}{ }\PY{o}{+}\PY{+w}{ }\PY{n}{BP}\PY{p}{)}\PY{p}{)}\PY{p}{.}\PY{n}{alias}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{discount curve down}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{;}

\PY{k+kd}{let}\PY{+w}{ }\PY{n}{pv\PYZus{}up}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{p}{(}\PY{p}{(}\PY{n}{discount\PYZus{}curve\PYZus{}up}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{+w}{ }\PY{o}{*}\PY{+w}{ }\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{bond cash flow}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{p}{.}\PY{n}{sum}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{.}\PY{n}{alias}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{pv\PYZus{}up}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{;}

\PY{k+kd}{let}\PY{+w}{ }\PY{n}{pv\PYZus{}down}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{p}{(}\PY{p}{(}\PY{n}{discount\PYZus{}curve\PYZus{}down}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{+w}{ }\PY{o}{*}\PY{+w}{ }\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{bond cash flow}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{p}{.}\PY{n}{sum}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{.}\PY{n}{alias}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{pv\PYZus{}down}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{;}

\PY{k+kd}{let}\PY{+w}{ }\PY{n}{dv01}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{p}{(}\PY{p}{(}\PY{n}{pv\PYZus{}up}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{+w}{ }\PY{o}{\PYZhy{}}\PY{+w}{ }\PY{n}{pv\PYZus{}down}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{+w}{ }\PY{o}{/}\PY{+w}{ }\PY{n}{lit}\PY{p}{(}\PY{l+m+mf}{2.0}\PY{p}{)}\PY{p}{)}\PY{p}{.}\PY{n}{alias}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{dv01}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{;}

\PY{n}{LaTeXDataFrame}\PY{p}{(}\PY{n}{df}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{.}\PY{n}{lazy}\PY{p}{(}\PY{p}{)}\PY{p}{.}\PY{n}{select}\PY{p}{(}\PY{p}{[}\PY{n}{dv01}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{]}\PY{p}{)}\PY{p}{.}\PY{n}{collect}\PY{p}{(}\PY{p}{)}\PY{o}{?}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}
 
            
\prompt{Out}{outcolor}{80}{}
    
    \begin{tabularx}{\textwidth}{|*1{p{\dimexpr\textwidth/1-2\tabcolsep\relax}|}}
\hlinedv01 \\
\hline
-0.0098 \\
\hline
\end{tabularx}

    

    We also need to calculate duration, a measure of linear risk.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{81}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kd}{let}\PY{+w}{ }\PY{n}{duration}\PY{+w}{ }\PY{o}{=}
\PY{+w}{    }\PY{p}{(}\PY{p}{(}\PY{n}{pv\PYZus{}up}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{+w}{ }\PY{o}{\PYZhy{}}\PY{+w}{ }\PY{n}{pv\PYZus{}down}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{+w}{ }\PY{o}{/}\PY{+w}{ }\PY{p}{(}\PY{n}{lit}\PY{p}{(}\PY{l+m+mf}{2.0}\PY{+w}{ }\PY{o}{*}\PY{+w}{ }\PY{n}{BP}\PY{p}{)}\PY{+w}{ }\PY{o}{*}\PY{+w}{ }\PY{n}{pv}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{)}\PY{p}{.}\PY{n}{alias}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{duration}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{;}

\PY{n}{LaTeXDataFrame}\PY{p}{(}\PY{n}{df}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{.}\PY{n}{lazy}\PY{p}{(}\PY{p}{)}\PY{p}{.}\PY{n}{select}\PY{p}{(}\PY{p}{[}\PY{n}{duration}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{]}\PY{p}{)}\PY{p}{.}\PY{n}{collect}\PY{p}{(}\PY{p}{)}\PY{o}{?}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}
 
            
\prompt{Out}{outcolor}{81}{}
    
    \begin{tabularx}{\textwidth}{|*1{p{\dimexpr\textwidth/1-2\tabcolsep\relax}|}}
\hlineduration \\
\hline
-1.0000 \\
\hline
\end{tabularx}

    

    One more thing: we need to generate our new discount curve from the
forward curve.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{82}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kd}{let}\PY{+w}{ }\PY{n}{discount\PYZus{}curve}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{p}{(}\PY{n}{lit}\PY{p}{(}\PY{l+m+mf}{1.0}\PY{p}{)}\PY{+w}{ }\PY{o}{/}\PY{+w}{ }\PY{p}{(}\PY{n}{lit}\PY{p}{(}\PY{l+m+mf}{1.0}\PY{p}{)}\PY{+w}{ }\PY{o}{+}\PY{+w}{ }\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{forward curve}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{p}{.}\PY{n}{cum\PYZus{}prod}\PY{p}{(}\PY{k+kc}{false}\PY{p}{)}\PY{p}{.}\PY{n}{implode}\PY{p}{(}\PY{p}{)}\PY{p}{)}
\PY{+w}{    }\PY{p}{.}\PY{n}{alias}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{discount curve}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{;}

\PY{n}{LaTeXDataFrame}\PY{p}{(}
\PY{+w}{    }\PY{n}{df}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}
\PY{+w}{        }\PY{p}{.}\PY{n}{lazy}\PY{p}{(}\PY{p}{)}
\PY{+w}{        }\PY{p}{.}\PY{n}{select}\PY{p}{(}\PY{p}{[}\PY{n}{discount\PYZus{}curve}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{]}\PY{p}{)}
\PY{+w}{        }\PY{p}{.}\PY{n}{collect}\PY{p}{(}\PY{p}{)}\PY{o}{?}\PY{p}{,}
\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}
 
            
\prompt{Out}{outcolor}{82}{}
    
    \begin{tabularx}{\textwidth}{|*1{p{\dimexpr\textwidth/1-2\tabcolsep\relax}|}}
\hlinediscount curve \\
\hline
[0.9692, 0.9385, 0.9089, 0.8800, 0.8515, 0.8173, 0.7882, 0.7681, 0.7469, 0.7035] \\
\hline
\end{tabularx}

    

    Since we are creating ten different scenarios altering each row, we'll
need the row index.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{83}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kd}{let}\PY{+w}{ }\PY{n}{df}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{k}{if}\PY{+w}{ }\PY{n}{df}\PY{p}{.}\PY{n}{column}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{row}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{.}\PY{n}{is\PYZus{}err}\PY{p}{(}\PY{p}{)}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{    }\PY{n}{df}\PY{p}{.}\PY{n}{with\PYZus{}row\PYZus{}index}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{row}\PY{l+s}{\PYZdq{}}\PY{p}{.}\PY{n}{into}\PY{p}{(}\PY{p}{)}\PY{p}{,}\PY{+w}{ }\PY{n+nb}{None}\PY{p}{)}\PY{o}{?}
\PY{p}{\PYZcb{}}\PY{+w}{ }\PY{k}{else}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{    }\PY{n}{df}
\PY{p}{\PYZcb{}}\PY{p}{;}

\PY{n}{LaTeXDataFrame}\PY{p}{(}\PY{n}{df}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}
 
            
\prompt{Out}{outcolor}{83}{}
    
    \begin{tabularx}{\textwidth}{|*9{p{\dimexpr\textwidth/9-2\tabcolsep\relax}|}}
\hlinerow & rate type & maturity & inputs & bond cash flow & zero curve & forward curve & par curve & discount curve \\
\hline
0 & cash & 1.0000 & 0.0318 & 3 & 0.0318 & 0.0318 & 0.0318 & 0.9692 \\
\hline
1 & cash & 2.0000 & 0.0322 & 3 & 0.0322 & 0.0326 & 0.0322 & 0.9385 \\
\hline
2 & forwards & 3.0000 & 0.0326 & 3 & 0.0323 & 0.0326 & 0.0323 & 0.9089 \\
\hline
3 & forwards & 4.0000 & 0.0329 & 3 & 0.0325 & 0.0329 & 0.0325 & 0.8800 \\
\hline
4 & forwards & 5.0000 & 0.0335 & 3 & 0.0327 & 0.0335 & 0.0327 & 0.8515 \\
\hline
5 & swaps & 6.0000 & 0.0340 & 3 & 0.0342 & 0.0418 & 0.0340 & 0.8173 \\
\hline
6 & swaps & 7.0000 & 0.0344 & 3 & 0.0346 & 0.0369 & 0.0344 & 0.7882 \\
\hline
7 & swaps & 8.0000 & 0.0335 & 3 & 0.0335 & 0.0261 & 0.0335 & 0.7681 \\
\hline
8 & swaps & 9.0000 & 0.0330 & 103 & 0.0330 & 0.0284 & 0.0330 & 0.7469 \\
\hline
9 & swaps & 10.0000 & 0.0354 & 0 & 0.0358 & 0.0617 & 0.0354 & 0.7035 \\
\hline
\end{tabularx}

    

    We will now generate ten different scenarios for incrementing each part
of the forward curve.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{84}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kd}{let}\PY{+w}{ }\PY{n}{scenarios\PYZus{}df}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{p}{(}\PY{l+m+mi}{0}\PY{o}{..}\PY{n}{df}\PY{p}{.}\PY{n}{height}\PY{p}{(}\PY{p}{)}\PY{p}{)}
\PY{+w}{    }\PY{p}{.}\PY{n}{map}\PY{p}{(}\PY{o}{|}\PY{n}{i}\PY{o}{|}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{        }\PY{n}{df}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}
\PY{+w}{            }\PY{p}{.}\PY{n}{lazy}\PY{p}{(}\PY{p}{)}
\PY{+w}{            }\PY{p}{.}\PY{n}{with\PYZus{}column}\PY{p}{(}
\PY{+w}{                }\PY{n}{when}\PY{p}{(}\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{row}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{.}\PY{n}{eq}\PY{p}{(}\PY{n}{lit}\PY{p}{(}\PY{n}{i}\PY{+w}{ }\PY{k}{as}\PY{+w}{ }\PY{k+kt}{u32}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\PY{+w}{                    }\PY{p}{.}\PY{n}{then}\PY{p}{(}\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{forward curve}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{+w}{ }\PY{o}{+}\PY{+w}{ }\PY{n}{lit}\PY{p}{(}\PY{l+m+mf}{0.001}\PY{p}{)}\PY{p}{)}
\PY{+w}{                    }\PY{p}{.}\PY{n}{otherwise}\PY{p}{(}\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{forward curve}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
\PY{+w}{                    }\PY{p}{.}\PY{n}{alias}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{forward curve}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{+w}{            }\PY{p}{)}
\PY{+w}{            }\PY{p}{.}\PY{n}{with\PYZus{}column}\PY{p}{(}
\PY{+w}{                }\PY{p}{(}\PY{n}{lit}\PY{p}{(}\PY{l+m+mf}{1.0}\PY{p}{)}\PY{+w}{ }\PY{o}{/}\PY{+w}{ }\PY{p}{(}\PY{n}{lit}\PY{p}{(}\PY{l+m+mf}{1.0}\PY{p}{)}\PY{+w}{ }\PY{o}{+}\PY{+w}{ }\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{forward curve}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{p}{.}\PY{n}{cum\PYZus{}prod}\PY{p}{(}\PY{k+kc}{false}\PY{p}{)}\PY{p}{)}
\PY{+w}{                    }\PY{p}{.}\PY{n}{alias}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{discount curve}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{+w}{            }\PY{p}{)}
\PY{+w}{            }\PY{p}{.}\PY{n}{collect}\PY{p}{(}\PY{p}{)}
\PY{+w}{            }\PY{p}{.}\PY{n}{unwrap}\PY{p}{(}\PY{p}{)}
\PY{+w}{    }\PY{p}{\PYZcb{}}\PY{p}{)}
\PY{+w}{    }\PY{p}{.}\PY{n}{collect}\PY{p}{:}\PY{p}{:}\PY{o}{\PYZlt{}}\PY{n+nb}{Vec}\PY{o}{\PYZlt{}}\PY{n}{\PYZus{}}\PY{o}{\PYZgt{}}\PY{o}{\PYZgt{}}\PY{p}{(}\PY{p}{)}\PY{p}{;}

\PY{n}{LaTeXDataFrame}\PY{p}{(}\PY{n}{scenarios\PYZus{}df}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}
 
            
\prompt{Out}{outcolor}{84}{}
    
    \begin{tabularx}{\textwidth}{|*9{p{\dimexpr\textwidth/9-2\tabcolsep\relax}|}}
\hlinerow & rate type & maturity & inputs & bond cash flow & zero curve & forward curve & par curve & discount curve \\
\hline
0 & cash & 1.0000 & 0.0318 & 3 & 0.0318 & 0.0328 & 0.0318 & 0.9682 \\
\hline
1 & cash & 2.0000 & 0.0322 & 3 & 0.0322 & 0.0326 & 0.0322 & 0.9376 \\
\hline
2 & forwards & 3.0000 & 0.0326 & 3 & 0.0323 & 0.0326 & 0.0323 & 0.9080 \\
\hline
3 & forwards & 4.0000 & 0.0329 & 3 & 0.0325 & 0.0329 & 0.0325 & 0.8791 \\
\hline
4 & forwards & 5.0000 & 0.0335 & 3 & 0.0327 & 0.0335 & 0.0327 & 0.8506 \\
\hline
5 & swaps & 6.0000 & 0.0340 & 3 & 0.0342 & 0.0418 & 0.0340 & 0.8165 \\
\hline
6 & swaps & 7.0000 & 0.0344 & 3 & 0.0346 & 0.0369 & 0.0344 & 0.7874 \\
\hline
7 & swaps & 8.0000 & 0.0335 & 3 & 0.0335 & 0.0261 & 0.0335 & 0.7674 \\
\hline
8 & swaps & 9.0000 & 0.0330 & 103 & 0.0330 & 0.0284 & 0.0330 & 0.7462 \\
\hline
9 & swaps & 10.0000 & 0.0354 & 0 & 0.0358 & 0.0617 & 0.0354 & 0.7029 \\
\hline
\end{tabularx}

    

    Now we will calculate our different values for our metrics.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{85}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kd}{let}\PY{+w}{ }\PY{n}{scenarios}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{concat}\PY{p}{(}
\PY{+w}{    }\PY{n}{scenarios\PYZus{}df}
\PY{+w}{        }\PY{p}{.}\PY{n}{iter}\PY{p}{(}\PY{p}{)}
\PY{+w}{        }\PY{p}{.}\PY{n}{enumerate}\PY{p}{(}\PY{p}{)}
\PY{+w}{        }\PY{p}{.}\PY{n}{map}\PY{p}{(}\PY{o}{|}\PY{p}{(}\PY{n}{i}\PY{p}{,}\PY{+w}{ }\PY{n}{scenario}\PY{p}{)}\PY{o}{|}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{            }\PY{n}{scenario}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{.}\PY{n}{lazy}\PY{p}{(}\PY{p}{)}\PY{p}{.}\PY{n}{select}\PY{p}{(}\PY{p}{[}
\PY{+w}{                }\PY{n}{lit}\PY{p}{(}\PY{n}{i}\PY{+w}{ }\PY{k}{as}\PY{+w}{ }\PY{k+kt}{u32}\PY{p}{)}\PY{p}{.}\PY{n}{alias}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{increment}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{+w}{                }\PY{n}{discount\PYZus{}curve}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{,}
\PY{+w}{                }\PY{n}{pv}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{,}
\PY{+w}{                }\PY{n}{dv01}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{,}
\PY{+w}{                }\PY{n}{duration}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{,}
\PY{+w}{            }\PY{p}{]}\PY{p}{)}
\PY{+w}{        }\PY{p}{\PYZcb{}}\PY{p}{)}
\PY{+w}{        }\PY{p}{.}\PY{n}{collect}\PY{p}{:}\PY{p}{:}\PY{o}{\PYZlt{}}\PY{n+nb}{Vec}\PY{o}{\PYZlt{}}\PY{n}{\PYZus{}}\PY{o}{\PYZgt{}}\PY{o}{\PYZgt{}}\PY{p}{(}\PY{p}{)}\PY{p}{,}
\PY{+w}{    }\PY{n}{UnionArgs}\PY{p}{::}\PY{n}{default}\PY{p}{(}\PY{p}{)}\PY{p}{,}
\PY{p}{)}\PY{o}{?}
\PY{p}{.}\PY{n}{collect}\PY{p}{(}\PY{p}{)}\PY{o}{?}\PY{p}{;}

\PY{n}{LaTeXDataFrame}\PY{p}{(}\PY{n}{scenarios}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}
 
            
\prompt{Out}{outcolor}{85}{}
    
    \begin{tabularx}{\textwidth}{|*5{p{\dimexpr\textwidth/5-2\tabcolsep\relax}|}}
\hlineincrement & discount curve & pv & dv01 & duration \\
\hline
0 & [0.9682, 0.9376, 0.9080, 0.8791, 0.8506, 0.8165, 0.7874, 0.7674, 0.7462, 0.7029] & 97.6048 & -0.0098 & -1.0000 \\
\hline
1 & [0.9692, 0.9376, 0.9080, 0.8791, 0.8507, 0.8165, 0.7874, 0.7674, 0.7462, 0.7029] & 97.6077 & -0.0098 & -1.0000 \\
\hline
2 & [0.9692, 0.9385, 0.9080, 0.8791, 0.8507, 0.8165, 0.7874, 0.7674, 0.7462, 0.7029] & 97.6104 & -0.0098 & -1.0000 \\
\hline
3 & [0.9692, 0.9385, 0.9089, 0.8791, 0.8507, 0.8165, 0.7874, 0.7674, 0.7462, 0.7029] & 97.6131 & -0.0098 & -1.0000 \\
\hline
4 & [0.9692, 0.9385, 0.9089, 0.8800, 0.8507, 0.8165, 0.7874, 0.7674, 0.7462, 0.7029] & 97.6157 & -0.0098 & -1.0000 \\
\hline
5 & [0.9692, 0.9385, 0.9089, 0.8800, 0.8515, 0.8165, 0.7874, 0.7674, 0.7462, 0.7029] & 97.6188 & -0.0098 & -1.0000 \\
\hline
6 & [0.9692, 0.9385, 0.9089, 0.8800, 0.8515, 0.8173, 0.7874, 0.7674, 0.7462, 0.7029] & 97.6208 & -0.0098 & -1.0000 \\
\hline
7 & [0.9692, 0.9385, 0.9089, 0.8800, 0.8515, 0.8173, 0.7882, 0.7674, 0.7462, 0.7029] & 97.6223 & -0.0098 & -1.0000 \\
\hline
8 & [0.9692, 0.9385, 0.9089, 0.8800, 0.8515, 0.8173, 0.7882, 0.7681, 0.7462, 0.7029] & 97.6247 & -0.0098 & -1.0000 \\
\hline
9 & [0.9692, 0.9385, 0.9089, 0.8800, 0.8515, 0.8173, 0.7882, 0.7681, 0.7469, 0.7029] & 97.6994 & -0.0098 & -1.0000 \\
\hline
\end{tabularx}

    

    The forward change is 10 bps, which causes a couple bps change in the
discount curve, a few cents change in the price, a hundredth of a bp
change in DV01, and no change in duration.

The further in time the increment goes: - the higher the final discount
is pushed up, approaching the original discount - the higher the price
becomes, approaching the original price - the higher the duration
becomes, approaching the original duration

    \subsection{d)}\label{d}

    Now we'll move all of the forward rates by 10 bps.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{86}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kd}{let}\PY{+w}{ }\PY{n}{forward\PYZus{}curve\PYZus{}up}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{forward curve}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{+w}{ }\PY{o}{+}\PY{+w}{ }\PY{n}{lit}\PY{p}{(}\PY{l+m+mf}{10.0}\PY{+w}{ }\PY{o}{*}\PY{+w}{ }\PY{n}{BP}\PY{p}{)}\PY{p}{;}

\PY{k+kd}{let}\PY{+w}{ }\PY{n}{forward\PYZus{}curve\PYZus{}down}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{forward curve}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{+w}{ }\PY{o}{\PYZhy{}}\PY{+w}{ }\PY{n}{lit}\PY{p}{(}\PY{l+m+mf}{10.0}\PY{+w}{ }\PY{o}{*}\PY{+w}{ }\PY{n}{BP}\PY{p}{)}\PY{p}{;}

\PY{c+c1}{// redefine discount curve shift from forward curve}

\PY{k+kd}{let}\PY{+w}{ }\PY{n}{discount\PYZus{}curve\PYZus{}up}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{p}{(}\PY{n}{lit}\PY{p}{(}\PY{l+m+mf}{1.0}\PY{p}{)}\PY{+w}{ }\PY{o}{/}\PY{+w}{ }\PY{p}{(}\PY{n}{lit}\PY{p}{(}\PY{l+m+mf}{1.0}\PY{p}{)}\PY{+w}{ }\PY{o}{+}\PY{+w}{ }\PY{n}{forward\PYZus{}curve\PYZus{}up}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{.}\PY{n}{cum\PYZus{}prod}\PY{p}{(}\PY{k+kc}{false}\PY{p}{)}\PY{p}{)}\PY{p}{;}

\PY{k+kd}{let}\PY{+w}{ }\PY{n}{discount\PYZus{}curve\PYZus{}down}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{p}{(}\PY{n}{lit}\PY{p}{(}\PY{l+m+mf}{1.0}\PY{p}{)}\PY{+w}{ }\PY{o}{/}\PY{+w}{ }\PY{p}{(}\PY{n}{lit}\PY{p}{(}\PY{l+m+mf}{1.0}\PY{p}{)}\PY{+w}{ }\PY{o}{+}\PY{+w}{ }\PY{n}{forward\PYZus{}curve\PYZus{}down}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{.}\PY{n}{cum\PYZus{}prod}\PY{p}{(}\PY{k+kc}{false}\PY{p}{)}\PY{p}{)}\PY{p}{;}

\PY{k+kd}{let}\PY{+w}{ }\PY{n}{pv\PYZus{}up}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{p}{(}\PY{p}{(}\PY{n}{discount\PYZus{}curve\PYZus{}up}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{+w}{ }\PY{o}{*}\PY{+w}{ }\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{bond cash flow}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{p}{.}\PY{n}{sum}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{.}\PY{n}{alias}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{pv up}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{;}

\PY{k+kd}{let}\PY{+w}{ }\PY{n}{pv\PYZus{}down}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{p}{(}\PY{p}{(}\PY{n}{discount\PYZus{}curve\PYZus{}down}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{+w}{ }\PY{o}{*}\PY{+w}{ }\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{bond cash flow}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{p}{.}\PY{n}{sum}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{.}\PY{n}{alias}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{pv down}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{;}

\PY{n}{LaTeXDataFrame}\PY{p}{(}
\PY{+w}{    }\PY{n}{df}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}
\PY{+w}{        }\PY{p}{.}\PY{n}{lazy}\PY{p}{(}\PY{p}{)}
\PY{+w}{        }\PY{p}{.}\PY{n}{select}\PY{p}{(}\PY{p}{[}\PY{n}{pv\PYZus{}up}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{,}\PY{+w}{ }\PY{n}{pv\PYZus{}down}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{]}\PY{p}{)}
\PY{+w}{        }\PY{p}{.}\PY{n}{collect}\PY{p}{(}\PY{p}{)}\PY{o}{?}\PY{p}{,}
\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}
 
            
\prompt{Out}{outcolor}{86}{}
    
    \begin{tabularx}{\textwidth}{|*2{p{\dimexpr\textwidth/2-2\tabcolsep\relax}|}}
\hlinepv up & pv down \\
\hline
96.9457 & 98.4601 \\
\hline
\end{tabularx}

    

    And here is the convexity of the bond.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{87}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kd}{let}\PY{+w}{ }\PY{n}{convexity}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{p}{(}\PY{p}{(}\PY{n}{pv\PYZus{}up}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{+w}{ }\PY{o}{+}\PY{+w}{ }\PY{n}{pv\PYZus{}down}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{+w}{ }\PY{o}{\PYZhy{}}\PY{+w}{ }\PY{n}{lit}\PY{p}{(}\PY{l+m+mf}{2.0}\PY{p}{)}\PY{+w}{ }\PY{o}{*}\PY{+w}{ }\PY{n}{pv}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{)}
\PY{+w}{    }\PY{o}{/}\PY{+w}{ }\PY{p}{(}\PY{n}{pv}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{+w}{ }\PY{o}{*}\PY{+w}{ }\PY{p}{(}\PY{n}{lit}\PY{p}{(}\PY{l+m+mf}{10.0}\PY{+w}{ }\PY{o}{*}\PY{+w}{ }\PY{n}{BP}\PY{p}{)}\PY{p}{.}\PY{n}{pow}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\PY{p}{.}\PY{n}{alias}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{convexity}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{;}

\PY{n}{LaTeXDataFrame}\PY{p}{(}\PY{n}{df}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{.}\PY{n}{lazy}\PY{p}{(}\PY{p}{)}\PY{p}{.}\PY{n}{select}\PY{p}{(}\PY{p}{[}\PY{n}{convexity}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{]}\PY{p}{)}\PY{p}{.}\PY{n}{collect}\PY{p}{(}\PY{p}{)}\PY{o}{?}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}
 
            
\prompt{Out}{outcolor}{87}{}
    
    \begin{tabularx}{\textwidth}{|*1{p{\dimexpr\textwidth/1-2\tabcolsep\relax}|}}
\hlineconvexity \\
\hline
72.0404 \\
\hline
\end{tabularx}

    

    \subsection{e)}\label{e}

    We will use linear interpolation to compute the 30 month (2.5 year)
forward price.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{88}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{// turn discount curve into a vec}

\PY{k+kd}{let}\PY{+w}{ }\PY{n}{discount\PYZus{}curve}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{df}
\PY{+w}{    }\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}
\PY{+w}{    }\PY{p}{.}\PY{n}{column}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{discount curve}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{o}{?}
\PY{+w}{    }\PY{p}{.}\PY{k+kt}{f64}\PY{p}{(}\PY{p}{)}\PY{o}{?}
\PY{+w}{    }\PY{p}{.}\PY{n}{to\PYZus{}vec\PYZus{}null\PYZus{}aware}\PY{p}{(}\PY{p}{)}
\PY{+w}{    }\PY{p}{.}\PY{n}{left}\PY{p}{(}\PY{p}{)}
\PY{+w}{    }\PY{p}{.}\PY{n}{unwrap}\PY{p}{(}\PY{p}{)}\PY{p}{;}

\PY{k+kd}{let}\PY{+w}{ }\PY{n}{discount30}\PY{+w}{ }\PY{o}{=}
\PY{+w}{    }\PY{n}{discount\PYZus{}curve}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{+w}{ }\PY{o}{+}\PY{+w}{ }\PY{p}{(}\PY{n}{discount\PYZus{}curve}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{]}\PY{+w}{ }\PY{o}{\PYZhy{}}\PY{+w}{ }\PY{n}{discount\PYZus{}curve}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}\PY{+w}{ }\PY{o}{*}\PY{+w}{ }\PY{p}{(}\PY{l+m+mf}{2.5}\PY{+w}{ }\PY{o}{\PYZhy{}}\PY{+w}{ }\PY{l+m+mf}{2.0}\PY{p}{)}\PY{+w}{ }\PY{o}{/}\PY{+w}{ }\PY{p}{(}\PY{l+m+mf}{3.0}\PY{+w}{ }\PY{o}{\PYZhy{}}\PY{+w}{ }\PY{l+m+mf}{2.0}\PY{p}{)}\PY{p}{;}

\PY{n}{LaTeXDataFrame}\PY{p}{(}
\PY{+w}{    }\PY{n}{df}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}
\PY{+w}{        }\PY{p}{.}\PY{n}{lazy}\PY{p}{(}\PY{p}{)}
\PY{+w}{        }\PY{p}{.}\PY{n}{select}\PY{p}{(}\PY{p}{[}\PY{n}{pv}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{+w}{ }\PY{o}{/}\PY{+w}{ }\PY{n}{lit}\PY{p}{(}\PY{n}{discount30}\PY{p}{)}\PY{p}{]}\PY{p}{)}
\PY{+w}{        }\PY{p}{.}\PY{n}{collect}\PY{p}{(}\PY{p}{)}\PY{o}{?}\PY{p}{,}
\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}
 
            
\prompt{Out}{outcolor}{88}{}
    
    \begin{tabularx}{\textwidth}{|*1{p{\dimexpr\textwidth/1-2\tabcolsep\relax}|}}
\hlinepv \\
\hline
105.7667 \\
\hline
\end{tabularx}

    

    \section{Problem 2}\label{problem-2}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{89}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{use}\PY{+w}{ }\PY{n}{nalgebra}\PY{p}{:}\PY{p}{:}\PY{p}{\PYZob{}}\PY{n}{DMatrix}\PY{p}{,}\PY{+w}{ }\PY{n}{DVector}\PY{p}{\PYZcb{}}\PY{p}{;}
\PY{k}{use}\PY{+w}{ }\PY{n}{plotters}\PY{p}{::}\PY{n}{prelude}\PY{p}{:}\PY{p}{:}\PY{o}{*}\PY{p}{;}
\PY{k}{use}\PY{+w}{ }\PY{n}{plotters}\PY{p}{::}\PY{n}{evcxr}\PY{p}{::}\PY{n}{SVGWrapper}\PY{p}{;}
\PY{k}{use}\PY{+w}{ }\PY{n}{polars}\PY{p}{::}\PY{n}{prelude}\PY{p}{:}\PY{p}{:}\PY{o}{*}\PY{p}{;}
\end{Verbatim}
\end{tcolorbox}

    Initialize data.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{90}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kd}{let}\PY{+w}{ }\PY{n}{df}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{df}\PY{o}{!}\PY{p}{(}
\PY{+w}{    }\PY{l+s}{\PYZdq{}}\PY{l+s}{time to maturity}\PY{l+s}{\PYZdq{}}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{p}{[}\PY{l+m+mf}{0.25}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.5}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{1.0}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{2.0}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{3.0}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{5.0}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{7.0}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{10.0}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{20.0}\PY{p}{]}\PY{p}{,}
\PY{+w}{    }\PY{l+s}{\PYZdq{}}\PY{l+s}{yield rate}\PY{l+s}{\PYZdq{}}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{p}{[}\PY{l+m+mf}{0.0150}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.0160}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.0180}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.0210}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.0240}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.0330}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.03740}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.0405}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.0435}\PY{p}{]}
\PY{p}{)}\PY{o}{?}\PY{p}{;}

\PY{n}{LaTeXDataFrame}\PY{p}{(}\PY{n}{df}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}
 
            
\prompt{Out}{outcolor}{90}{}
    
    \begin{tabularx}{\textwidth}{|*2{p{\dimexpr\textwidth/2-2\tabcolsep\relax}|}}
\hlinetime to maturity & yield rate \\
\hline
0.2500 & 0.0150 \\
\hline
0.5000 & 0.0160 \\
\hline
1.0000 & 0.0180 \\
\hline
2.0000 & 0.0210 \\
\hline
3.0000 & 0.0240 \\
\hline
5.0000 & 0.0330 \\
\hline
7.0000 & 0.0374 \\
\hline
10.0000 & 0.0405 \\
\hline
20.0000 & 0.0435 \\
\hline
\end{tabularx}

    

    We will store information relating to the cubic spline in a struct,
i.e.~the input times and the coefficients.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{91}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+cp}{\PYZsh{}[}\PY{c+cp}{derive(Debug)}\PY{c+cp}{]}

\PY{k}{struct}\PY{+w}{ }\PY{n+nc}{CubicSpline}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{    }\PY{n}{x}\PY{p}{:}\PY{+w}{ }\PY{n+nb}{Vec}\PY{o}{\PYZlt{}}\PY{k+kt}{f64}\PY{o}{\PYZgt{}}\PY{p}{,}

\PY{+w}{    }\PY{n}{a}\PY{p}{:}\PY{+w}{ }\PY{n+nb}{Vec}\PY{o}{\PYZlt{}}\PY{k+kt}{f64}\PY{o}{\PYZgt{}}\PY{p}{,}

\PY{+w}{    }\PY{n}{b}\PY{p}{:}\PY{+w}{ }\PY{n+nb}{Vec}\PY{o}{\PYZlt{}}\PY{k+kt}{f64}\PY{o}{\PYZgt{}}\PY{p}{,}

\PY{+w}{    }\PY{n}{c}\PY{p}{:}\PY{+w}{ }\PY{n+nb}{Vec}\PY{o}{\PYZlt{}}\PY{k+kt}{f64}\PY{o}{\PYZgt{}}\PY{p}{,}

\PY{+w}{    }\PY{n}{d}\PY{p}{:}\PY{+w}{ }\PY{n+nb}{Vec}\PY{o}{\PYZlt{}}\PY{k+kt}{f64}\PY{o}{\PYZgt{}}\PY{p}{,}
\PY{p}{\PYZcb{}}
\end{Verbatim}
\end{tcolorbox}

    First, we need to calculate the second derivatives at each point.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{92}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{fn}\PY{+w}{ }\PY{n+nf}{second\PYZus{}derivatives}\PY{p}{(}\PY{n}{x}\PY{p}{:}\PY{+w}{ }\PY{k+kp}{\PYZam{}}\PY{p}{[}\PY{k+kt}{f64}\PY{p}{]}\PY{p}{,}\PY{+w}{ }\PY{n}{y}\PY{p}{:}\PY{+w}{ }\PY{k+kp}{\PYZam{}}\PY{p}{[}\PY{k+kt}{f64}\PY{p}{]}\PY{p}{)}\PY{+w}{ }\PY{p}{\PYZhy{}\PYZgt{}}\PY{+w}{ }\PY{n+nb}{Vec}\PY{o}{\PYZlt{}}\PY{k+kt}{f64}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{    }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{h}\PY{p}{:}\PY{+w}{ }\PY{n+nb}{Vec}\PY{o}{\PYZlt{}}\PY{k+kt}{f64}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{x}\PY{p}{.}\PY{n}{windows}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{.}\PY{n}{map}\PY{p}{(}\PY{o}{|}\PY{n}{w}\PY{o}{|}\PY{+w}{ }\PY{n}{w}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{+w}{ }\PY{o}{\PYZhy{}}\PY{+w}{ }\PY{n}{w}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}\PY{p}{.}\PY{n}{collect}\PY{p}{(}\PY{p}{)}\PY{p}{;}

\PY{+w}{    }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{n}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{x}\PY{p}{.}\PY{n}{len}\PY{p}{(}\PY{p}{)}\PY{p}{;}

\PY{+w}{    }\PY{k+kd}{let}\PY{+w}{ }\PY{k}{mut}\PY{+w}{ }\PY{n}{a}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{DMatrix}\PY{p}{::}\PY{n}{zeros}\PY{p}{(}\PY{n}{n}\PY{p}{,}\PY{+w}{ }\PY{n}{n}\PY{p}{)}\PY{p}{;}

\PY{+w}{    }\PY{k+kd}{let}\PY{+w}{ }\PY{k}{mut}\PY{+w}{ }\PY{n}{b}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{DVector}\PY{p}{::}\PY{n}{zeros}\PY{p}{(}\PY{n}{n}\PY{p}{)}\PY{p}{;}

\PY{+w}{    }\PY{c+c1}{// Natural spline boundary conditions (M\PYZus{}0 = 0, M\PYZus{}n\PYZhy{}1 = 0)}

\PY{+w}{    }\PY{n}{a}\PY{p}{[}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,}\PY{+w}{ }\PY{l+m+mi}{0}\PY{p}{)}\PY{p}{]}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{l+m+mf}{1.0}\PY{p}{;}

\PY{+w}{    }\PY{n}{a}\PY{p}{[}\PY{p}{(}\PY{n}{n}\PY{+w}{ }\PY{o}{\PYZhy{}}\PY{+w}{ }\PY{l+m+mi}{1}\PY{p}{,}\PY{+w}{ }\PY{n}{n}\PY{+w}{ }\PY{o}{\PYZhy{}}\PY{+w}{ }\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{]}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{l+m+mf}{1.0}\PY{p}{;}

\PY{+w}{    }\PY{k}{for}\PY{+w}{ }\PY{n}{i}\PY{+w}{ }\PY{k}{in}\PY{+w}{ }\PY{l+m+mi}{1}\PY{o}{..}\PY{n}{n}\PY{+w}{ }\PY{o}{\PYZhy{}}\PY{+w}{ }\PY{l+m+mi}{1}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{        }\PY{n}{a}\PY{p}{[}\PY{p}{(}\PY{n}{i}\PY{p}{,}\PY{+w}{ }\PY{n}{i}\PY{+w}{ }\PY{o}{\PYZhy{}}\PY{+w}{ }\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{]}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{h}\PY{p}{[}\PY{n}{i}\PY{+w}{ }\PY{o}{\PYZhy{}}\PY{+w}{ }\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{;}

\PY{+w}{        }\PY{n}{a}\PY{p}{[}\PY{p}{(}\PY{n}{i}\PY{p}{,}\PY{+w}{ }\PY{n}{i}\PY{p}{)}\PY{p}{]}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{l+m+mf}{2.0}\PY{+w}{ }\PY{o}{*}\PY{+w}{ }\PY{p}{(}\PY{n}{h}\PY{p}{[}\PY{n}{i}\PY{+w}{ }\PY{o}{\PYZhy{}}\PY{+w}{ }\PY{l+m+mi}{1}\PY{p}{]}\PY{+w}{ }\PY{o}{+}\PY{+w}{ }\PY{n}{h}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)}\PY{p}{;}

\PY{+w}{        }\PY{n}{a}\PY{p}{[}\PY{p}{(}\PY{n}{i}\PY{p}{,}\PY{+w}{ }\PY{n}{i}\PY{+w}{ }\PY{o}{+}\PY{+w}{ }\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{]}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{h}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{;}

\PY{+w}{        }\PY{n}{b}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{l+m+mf}{6.0}\PY{+w}{ }\PY{o}{*}\PY{+w}{ }\PY{p}{(}\PY{p}{(}\PY{n}{y}\PY{p}{[}\PY{n}{i}\PY{+w}{ }\PY{o}{+}\PY{+w}{ }\PY{l+m+mi}{1}\PY{p}{]}\PY{+w}{ }\PY{o}{\PYZhy{}}\PY{+w}{ }\PY{n}{y}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)}\PY{+w}{ }\PY{o}{/}\PY{+w}{ }\PY{n}{h}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{+w}{ }\PY{o}{\PYZhy{}}\PY{+w}{ }\PY{p}{(}\PY{n}{y}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{+w}{ }\PY{o}{\PYZhy{}}\PY{+w}{ }\PY{n}{y}\PY{p}{[}\PY{n}{i}\PY{+w}{ }\PY{o}{\PYZhy{}}\PY{+w}{ }\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}\PY{+w}{ }\PY{o}{/}\PY{+w}{ }\PY{n}{h}\PY{p}{[}\PY{n}{i}\PY{+w}{ }\PY{o}{\PYZhy{}}\PY{+w}{ }\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}\PY{p}{;}
\PY{+w}{    }\PY{p}{\PYZcb{}}

\PY{+w}{    }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{m}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{a}\PY{p}{.}\PY{n}{lu}\PY{p}{(}\PY{p}{)}\PY{p}{.}\PY{n}{solve}\PY{p}{(}\PY{o}{\PYZam{}}\PY{n}{b}\PY{p}{)}\PY{p}{.}\PY{n}{expect}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{Failed to solve system}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{;}

\PY{+w}{    }\PY{n}{m}\PY{p}{.}\PY{n}{as\PYZus{}slice}\PY{p}{(}\PY{p}{)}\PY{p}{.}\PY{n}{to\PYZus{}vec}\PY{p}{(}\PY{p}{)}
\PY{p}{\PYZcb{}}
\end{Verbatim}
\end{tcolorbox}

    Then, we will compute the coefficients at each endpoint using these
values.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{93}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{fn}\PY{+w}{ }\PY{n+nf}{compute\PYZus{}coefficients}\PY{p}{(}
\PY{+w}{    }\PY{n}{x}\PY{p}{:}\PY{+w}{ }\PY{k+kp}{\PYZam{}}\PY{p}{[}\PY{k+kt}{f64}\PY{p}{]}\PY{p}{,}

\PY{+w}{    }\PY{n}{y}\PY{p}{:}\PY{+w}{ }\PY{k+kp}{\PYZam{}}\PY{p}{[}\PY{k+kt}{f64}\PY{p}{]}\PY{p}{,}

\PY{+w}{    }\PY{n}{m}\PY{p}{:}\PY{+w}{ }\PY{k+kp}{\PYZam{}}\PY{p}{[}\PY{k+kt}{f64}\PY{p}{]}\PY{p}{,}
\PY{p}{)}\PY{+w}{ }\PY{p}{\PYZhy{}\PYZgt{}}\PY{+w}{ }\PY{p}{(}\PY{n+nb}{Vec}\PY{o}{\PYZlt{}}\PY{k+kt}{f64}\PY{o}{\PYZgt{}}\PY{p}{,}\PY{+w}{ }\PY{n+nb}{Vec}\PY{o}{\PYZlt{}}\PY{k+kt}{f64}\PY{o}{\PYZgt{}}\PY{p}{,}\PY{+w}{ }\PY{n+nb}{Vec}\PY{o}{\PYZlt{}}\PY{k+kt}{f64}\PY{o}{\PYZgt{}}\PY{p}{,}\PY{+w}{ }\PY{n+nb}{Vec}\PY{o}{\PYZlt{}}\PY{k+kt}{f64}\PY{o}{\PYZgt{}}\PY{p}{)}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{    }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{n}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{x}\PY{p}{.}\PY{n}{len}\PY{p}{(}\PY{p}{)}\PY{+w}{ }\PY{o}{\PYZhy{}}\PY{+w}{ }\PY{l+m+mi}{1}\PY{p}{;}

\PY{+w}{    }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{h}\PY{p}{:}\PY{+w}{ }\PY{n+nb}{Vec}\PY{o}{\PYZlt{}}\PY{k+kt}{f64}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{x}\PY{p}{.}\PY{n}{windows}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{.}\PY{n}{map}\PY{p}{(}\PY{o}{|}\PY{n}{w}\PY{o}{|}\PY{+w}{ }\PY{n}{w}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{+w}{ }\PY{o}{\PYZhy{}}\PY{+w}{ }\PY{n}{w}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}\PY{p}{.}\PY{n}{collect}\PY{p}{(}\PY{p}{)}\PY{p}{;}

\PY{+w}{    }\PY{k+kd}{let}\PY{+w}{ }\PY{k}{mut}\PY{+w}{ }\PY{n}{a}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n+nf+fm}{vec!}\PY{p}{[}\PY{l+m+mf}{0.0}\PY{p}{;}\PY{+w}{ }\PY{n}{n}\PY{p}{]}\PY{p}{;}

\PY{+w}{    }\PY{k+kd}{let}\PY{+w}{ }\PY{k}{mut}\PY{+w}{ }\PY{n}{b}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n+nf+fm}{vec!}\PY{p}{[}\PY{l+m+mf}{0.0}\PY{p}{;}\PY{+w}{ }\PY{n}{n}\PY{p}{]}\PY{p}{;}

\PY{+w}{    }\PY{k+kd}{let}\PY{+w}{ }\PY{k}{mut}\PY{+w}{ }\PY{n}{c}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n+nf+fm}{vec!}\PY{p}{[}\PY{l+m+mf}{0.0}\PY{p}{;}\PY{+w}{ }\PY{n}{n}\PY{p}{]}\PY{p}{;}

\PY{+w}{    }\PY{k+kd}{let}\PY{+w}{ }\PY{k}{mut}\PY{+w}{ }\PY{n}{d}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n+nf+fm}{vec!}\PY{p}{[}\PY{l+m+mf}{0.0}\PY{p}{;}\PY{+w}{ }\PY{n}{n}\PY{p}{]}\PY{p}{;}

\PY{+w}{    }\PY{k}{for}\PY{+w}{ }\PY{n}{i}\PY{+w}{ }\PY{k}{in}\PY{+w}{ }\PY{l+m+mi}{0}\PY{o}{..}\PY{n}{n}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{        }\PY{n}{a}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{y}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{;}

\PY{+w}{        }\PY{n}{b}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{p}{(}\PY{n}{y}\PY{p}{[}\PY{n}{i}\PY{+w}{ }\PY{o}{+}\PY{+w}{ }\PY{l+m+mi}{1}\PY{p}{]}\PY{+w}{ }\PY{o}{\PYZhy{}}\PY{+w}{ }\PY{n}{y}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)}\PY{+w}{ }\PY{o}{/}\PY{+w}{ }\PY{n}{h}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{+w}{ }\PY{o}{\PYZhy{}}\PY{+w}{ }\PY{p}{(}\PY{n}{h}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{+w}{ }\PY{o}{/}\PY{+w}{ }\PY{l+m+mf}{6.0}\PY{p}{)}\PY{+w}{ }\PY{o}{*}\PY{+w}{ }\PY{p}{(}\PY{n}{m}\PY{p}{[}\PY{n}{i}\PY{+w}{ }\PY{o}{+}\PY{+w}{ }\PY{l+m+mi}{1}\PY{p}{]}\PY{+w}{ }\PY{o}{+}\PY{+w}{ }\PY{l+m+mf}{2.0}\PY{+w}{ }\PY{o}{*}\PY{+w}{ }\PY{n}{m}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)}\PY{p}{;}

\PY{+w}{        }\PY{n}{c}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{m}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{+w}{ }\PY{o}{/}\PY{+w}{ }\PY{l+m+mf}{2.0}\PY{p}{;}

\PY{+w}{        }\PY{n}{d}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{p}{(}\PY{n}{m}\PY{p}{[}\PY{n}{i}\PY{+w}{ }\PY{o}{+}\PY{+w}{ }\PY{l+m+mi}{1}\PY{p}{]}\PY{+w}{ }\PY{o}{\PYZhy{}}\PY{+w}{ }\PY{n}{m}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)}\PY{+w}{ }\PY{o}{/}\PY{+w}{ }\PY{p}{(}\PY{l+m+mf}{6.0}\PY{+w}{ }\PY{o}{*}\PY{+w}{ }\PY{n}{h}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)}\PY{p}{;}
\PY{+w}{    }\PY{p}{\PYZcb{}}

\PY{+w}{    }\PY{p}{(}\PY{n}{a}\PY{p}{,}\PY{+w}{ }\PY{n}{b}\PY{p}{,}\PY{+w}{ }\PY{n}{c}\PY{p}{,}\PY{+w}{ }\PY{n}{d}\PY{p}{)}
\PY{p}{\PYZcb{}}
\end{Verbatim}
\end{tcolorbox}

    Now we can construct the cubic spline struct given the existing yield
curve.

We will implement a method on it to calculate the interpolated rate
given a time \texttt{t}.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{94}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{impl}\PY{+w}{ }\PY{n}{CubicSpline}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{    }\PY{k}{fn}\PY{+w}{ }\PY{n+nf}{new}\PY{p}{(}\PY{n}{x}\PY{p}{:}\PY{+w}{ }\PY{n+nb}{Vec}\PY{o}{\PYZlt{}}\PY{k+kt}{f64}\PY{o}{\PYZgt{}}\PY{p}{,}\PY{+w}{ }\PY{n}{y}\PY{p}{:}\PY{+w}{ }\PY{n+nb}{Vec}\PY{o}{\PYZlt{}}\PY{k+kt}{f64}\PY{o}{\PYZgt{}}\PY{p}{)}\PY{+w}{ }\PY{p}{\PYZhy{}\PYZgt{}}\PY{+w}{ }\PY{n+nc}{Self}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{        }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{n}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{x}\PY{p}{.}\PY{n}{len}\PY{p}{(}\PY{p}{)}\PY{p}{;}

\PY{+w}{        }\PY{n+nf+fm}{assert!}\PY{p}{(}\PY{n}{n}\PY{+w}{ }\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{l+m+mi}{2}\PY{p}{,}\PY{+w}{ }\PY{l+s}{\PYZdq{}}\PY{l+s}{At least two data points are required}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{;}

\PY{+w}{        }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{m}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{second\PYZus{}derivatives}\PY{p}{(}\PY{o}{\PYZam{}}\PY{n}{x}\PY{p}{,}\PY{+w}{ }\PY{o}{\PYZam{}}\PY{n}{y}\PY{p}{)}\PY{p}{;}

\PY{+w}{        }\PY{k+kd}{let}\PY{+w}{ }\PY{p}{(}\PY{n}{a}\PY{p}{,}\PY{+w}{ }\PY{n}{b}\PY{p}{,}\PY{+w}{ }\PY{n}{c}\PY{p}{,}\PY{+w}{ }\PY{n}{d}\PY{p}{)}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{compute\PYZus{}coefficients}\PY{p}{(}\PY{o}{\PYZam{}}\PY{n}{x}\PY{p}{,}\PY{+w}{ }\PY{o}{\PYZam{}}\PY{n}{y}\PY{p}{,}\PY{+w}{ }\PY{o}{\PYZam{}}\PY{n}{m}\PY{p}{)}\PY{p}{;}

\PY{+w}{        }\PY{n+nb+bp}{Self}\PY{+w}{ }\PY{p}{\PYZob{}}\PY{+w}{ }\PY{n}{x}\PY{p}{,}\PY{+w}{ }\PY{n}{a}\PY{p}{,}\PY{+w}{ }\PY{n}{b}\PY{p}{,}\PY{+w}{ }\PY{n}{c}\PY{p}{,}\PY{+w}{ }\PY{n}{d}\PY{+w}{ }\PY{p}{\PYZcb{}}
\PY{+w}{    }\PY{p}{\PYZcb{}}

\PY{+w}{    }\PY{k}{fn}\PY{+w}{ }\PY{n+nf}{interpolated\PYZus{}rate}\PY{p}{(}\PY{o}{\PYZam{}}\PY{n+nb+bp}{self}\PY{p}{,}\PY{+w}{ }\PY{n}{t}\PY{p}{:}\PY{+w}{ }\PY{k+kt}{f64}\PY{p}{)}\PY{+w}{ }\PY{p}{\PYZhy{}\PYZgt{}}\PY{+w}{ }\PY{k+kt}{f64}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{        }\PY{k}{if}\PY{+w}{ }\PY{n}{t}\PY{+w}{ }\PY{o}{\PYZlt{}}\PY{+w}{ }\PY{n+nb+bp}{self}\PY{p}{.}\PY{n}{x}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{+w}{ }\PY{o}{|}\PY{o}{|}\PY{+w}{ }\PY{n}{t}\PY{+w}{ }\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{n+nb+bp}{self}\PY{p}{.}\PY{n}{x}\PY{p}{[}\PY{n+nb+bp}{self}\PY{p}{.}\PY{n}{x}\PY{p}{.}\PY{n}{len}\PY{p}{(}\PY{p}{)}\PY{+w}{ }\PY{o}{\PYZhy{}}\PY{+w}{ }\PY{l+m+mi}{1}\PY{p}{]}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{            }\PY{n+nf+fm}{panic!}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{Extrapolation is not supported!}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{;}
\PY{+w}{        }\PY{p}{\PYZcb{}}

\PY{+w}{        }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{i}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n+nb+bp}{self}
\PY{+w}{            }\PY{p}{.}\PY{n}{x}
\PY{+w}{            }\PY{p}{.}\PY{n}{partition\PYZus{}point}\PY{p}{(}\PY{o}{|}\PY{o}{\PYZam{}}\PY{n}{xi}\PY{o}{|}\PY{+w}{ }\PY{n}{xi}\PY{+w}{ }\PY{o}{\PYZlt{}}\PY{o}{=}\PY{+w}{ }\PY{n}{t}\PY{p}{)}
\PY{+w}{            }\PY{p}{.}\PY{n}{saturating\PYZus{}sub}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{)}
\PY{+w}{            }\PY{p}{.}\PY{n}{min}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{.}\PY{n}{x}\PY{p}{.}\PY{n}{len}\PY{p}{(}\PY{p}{)}\PY{+w}{ }\PY{o}{\PYZhy{}}\PY{+w}{ }\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{;}

\PY{+w}{        }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{dx}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{t}\PY{+w}{ }\PY{o}{\PYZhy{}}\PY{+w}{ }\PY{n+nb+bp}{self}\PY{p}{.}\PY{n}{x}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{;}

\PY{+w}{        }\PY{n+nb+bp}{self}\PY{p}{.}\PY{n}{a}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{+w}{ }\PY{o}{+}\PY{+w}{ }\PY{n+nb+bp}{self}\PY{p}{.}\PY{n}{b}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{+w}{ }\PY{o}{*}\PY{+w}{ }\PY{n}{dx}\PY{+w}{ }\PY{o}{+}\PY{+w}{ }\PY{n+nb+bp}{self}\PY{p}{.}\PY{n}{c}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{+w}{ }\PY{o}{*}\PY{+w}{ }\PY{n}{dx}\PY{p}{.}\PY{n}{powi}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{)}\PY{+w}{ }\PY{o}{+}\PY{+w}{ }\PY{n+nb+bp}{self}\PY{p}{.}\PY{n}{d}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{+w}{ }\PY{o}{*}\PY{+w}{ }\PY{n}{dx}\PY{p}{.}\PY{n}{powi}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{)}
\PY{+w}{    }\PY{p}{\PYZcb{}}
\PY{p}{\PYZcb{}}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}, frame=single, framerule=2mm, rulecolor=\color{outerrorbackground}]
\textcolor{ansi-red}{[E0592] Error:} duplicate definitions with name `new`
   \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{╭}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{[}command\_94:1:1\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{]}
   \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{│}
 \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{2 │} \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{f}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{n}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{n}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{e}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{w}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{(}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{x}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{:}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{V}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{e}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{c}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{<}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{f}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{6}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{4}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{>}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{,}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{y}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{:}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{V}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{e}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{c}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{<}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{f}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{6}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{4}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{>}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{)}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{-}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{>}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{S}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{e}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{l}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{f}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{\{}
 \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{88,88,88}}{  │}     \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{┬}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}  
 \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{88,88,88}}{  │}                         \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{╰}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─} other definition for `new`
\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{───╯}
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}, frame=single, framerule=2mm, rulecolor=\color{outerrorbackground}]
\textcolor{ansi-red}{[E0592] Error:} duplicate definitions with name `interpolated\_rate`
    \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{╭}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{[}command\_94:1:1\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{]}
    \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{│}
 \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{14 │} \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{f}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{n}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{i}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{n}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{t}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{e}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{r}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{p}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{o}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{l}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{a}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{t}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{e}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{d}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{\_}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{r}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{a}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{t}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{e}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{(}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{\&}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{s}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{e}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{l}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{f}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{,}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{t}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{:}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{f}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{6}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{4}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{)}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{-}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{>}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{f}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{6}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{4}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{\{}
 \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{88,88,88}}{   │}     \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{┬}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}  
 \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{88,88,88}}{   │}                          \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{╰}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─} other definition for `interpolated\_rate`
\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{────╯}
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}, frame=single, framerule=2mm, rulecolor=\color{outerrorbackground}]
\textcolor{ansi-red}{[E0034] Error:} multiple applicable items in scope
    \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{╭}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{[}command\_94:1:1\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{]}
    \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{│}
 \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{14 │} \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{f}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{n}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{i}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{n}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{t}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{e}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{r}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{p}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{o}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{l}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{a}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{t}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{e}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{d}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{\_}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{r}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{a}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{t}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{e}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{(}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{\&}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{s}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{e}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{l}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{f}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{,}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{t}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{:}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{f}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{6}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{4}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{)}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{-}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{>}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{f}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{6}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{4}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{\{}
 \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{88,88,88}}{   │}     \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{┬}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}  
 \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{88,88,88}}{   │}                          \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{╰}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─} note: candidate \#2 is defined in an impl for the type `CubicSpline`
 \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{88,88,88}}{   │} 
 \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{88,88,88}}{   │} \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{135,215,175}}{Note}: multiple `interpolated\_rate` foundnote: candidate \#1 is defined in an impl for the type `CubicSpline`
\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{────╯}
    \end{Verbatim}

    We'll convert our existing data to vecs and construct our cubic spline
from it.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kd}{let}\PY{+w}{ }\PY{n}{x}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{df}
\PY{+w}{    }\PY{p}{.}\PY{n}{column}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{time to maturity}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{o}{?}
\PY{+w}{    }\PY{p}{.}\PY{k+kt}{f64}\PY{p}{(}\PY{p}{)}\PY{o}{?}
\PY{+w}{    }\PY{p}{.}\PY{n}{to\PYZus{}vec\PYZus{}null\PYZus{}aware}\PY{p}{(}\PY{p}{)}
\PY{+w}{    }\PY{p}{.}\PY{n}{left}\PY{p}{(}\PY{p}{)}
\PY{+w}{    }\PY{p}{.}\PY{n}{unwrap}\PY{p}{(}\PY{p}{)}\PY{p}{;}

\PY{k+kd}{let}\PY{+w}{ }\PY{n}{y}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{df}
\PY{+w}{    }\PY{p}{.}\PY{n}{column}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{yield rate}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{o}{?}
\PY{+w}{    }\PY{p}{.}\PY{k+kt}{f64}\PY{p}{(}\PY{p}{)}\PY{o}{?}
\PY{+w}{    }\PY{p}{.}\PY{n}{to\PYZus{}vec\PYZus{}null\PYZus{}aware}\PY{p}{(}\PY{p}{)}
\PY{+w}{    }\PY{p}{.}\PY{n}{left}\PY{p}{(}\PY{p}{)}
\PY{+w}{    }\PY{p}{.}\PY{n}{unwrap}\PY{p}{(}\PY{p}{)}\PY{p}{;}

\PY{k+kd}{let}\PY{+w}{ }\PY{n}{cs}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{CubicSpline}\PY{p}{::}\PY{n}{new}\PY{p}{(}\PY{n}{x}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{,}\PY{+w}{ }\PY{n}{y}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{;}

\PY{n}{cs}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
CubicSpline \{ x: [0.25, 0.5, 1.0, 2.0, 3.0, 5.0, 7.0, 10.0, 20.0], a: [0.015,
0.016, 0.018, 0.021, 0.024, 0.033, 0.0374, 0.0405], b: [0.003970767826026503,
0.004058464347947004, 0.0037076782602649813, 0.0026370017425160915,
0.0037443147696706587, 0.0037601078969438624, 0.0013152536425538944,
0.0007835699418147365], c: [0.0, 0.00035078608768200154, -0.0010523582630460463,
-1.8318254702843784e-5, 0.0011256312818574109, -0.0011177347182208088,
-0.00010469240897417541, -7.253549127221053e-5], d: [0.00046771478357600203,
-0.0009354295671520318, 0.0003446800027810675, 0.00038131651218675154,
-0.0003738943333463699, 0.0001688403848744389, 3.572990855773876e-6,
2.4178497090736844e-6] \}
\end{Verbatim}
\end{tcolorbox}
        
    \subsection{a)}\label{a}

    We will plot the yield curve and the original rates.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{fn}\PY{+w}{ }\PY{n+nf}{plot\PYZus{}yield\PYZus{}curve}\PY{p}{(}\PY{n}{cs}\PY{p}{:}\PY{+w}{ }\PY{k+kp}{\PYZam{}}\PY{n+nc}{CubicSpline}\PY{p}{,}\PY{+w}{ }\PY{n}{x\PYZus{}data}\PY{p}{:}\PY{+w}{ }\PY{k+kp}{\PYZam{}}\PY{p}{[}\PY{k+kt}{f64}\PY{p}{]}\PY{p}{,}\PY{+w}{ }\PY{n}{y\PYZus{}data}\PY{p}{:}\PY{+w}{ }\PY{k+kp}{\PYZam{}}\PY{p}{[}\PY{k+kt}{f64}\PY{p}{]}\PY{p}{)}\PY{+w}{ }\PY{p}{\PYZhy{}\PYZgt{}}\PY{+w}{ }\PY{n+nc}{PlotWrapper}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{    }\PY{n}{my\PYZus{}evcxr\PYZus{}figure}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{800}\PY{p}{,}\PY{+w}{ }\PY{l+m+mi}{600}\PY{p}{)}\PY{p}{,}\PY{+w}{ }\PY{o}{|}\PY{n}{root}\PY{o}{|}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{        }\PY{n}{root}\PY{p}{.}\PY{n}{fill}\PY{p}{(}\PY{o}{\PYZam{}}\PY{n}{WHITE}\PY{p}{)}\PY{p}{.}\PY{n}{unwrap}\PY{p}{(}\PY{p}{)}\PY{p}{;}

\PY{+w}{        }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{min\PYZus{}x}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{o}{*}\PY{n}{x\PYZus{}data}\PY{p}{.}\PY{n}{first}\PY{p}{(}\PY{p}{)}\PY{p}{.}\PY{n}{unwrap}\PY{p}{(}\PY{p}{)}\PY{p}{;}

\PY{+w}{        }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{max\PYZus{}x}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{o}{*}\PY{n}{x\PYZus{}data}\PY{p}{.}\PY{n}{last}\PY{p}{(}\PY{p}{)}\PY{p}{.}\PY{n}{unwrap}\PY{p}{(}\PY{p}{)}\PY{p}{;}

\PY{+w}{        }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{min\PYZus{}y}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{o}{*}\PY{n}{y\PYZus{}data}
\PY{+w}{            }\PY{p}{.}\PY{n}{iter}\PY{p}{(}\PY{p}{)}
\PY{+w}{            }\PY{p}{.}\PY{n}{min\PYZus{}by}\PY{p}{(}\PY{o}{|}\PY{n}{a}\PY{p}{,}\PY{+w}{ }\PY{n}{b}\PY{o}{|}\PY{+w}{ }\PY{n}{a}\PY{p}{.}\PY{n}{partial\PYZus{}cmp}\PY{p}{(}\PY{n}{b}\PY{p}{)}\PY{p}{.}\PY{n}{unwrap}\PY{p}{(}\PY{p}{)}\PY{p}{)}
\PY{+w}{            }\PY{p}{.}\PY{n}{unwrap}\PY{p}{(}\PY{p}{)}\PY{p}{;}

\PY{+w}{        }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{max\PYZus{}y}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{o}{*}\PY{n}{y\PYZus{}data}
\PY{+w}{            }\PY{p}{.}\PY{n}{iter}\PY{p}{(}\PY{p}{)}
\PY{+w}{            }\PY{p}{.}\PY{n}{max\PYZus{}by}\PY{p}{(}\PY{o}{|}\PY{n}{a}\PY{p}{,}\PY{+w}{ }\PY{n}{b}\PY{o}{|}\PY{+w}{ }\PY{n}{a}\PY{p}{.}\PY{n}{partial\PYZus{}cmp}\PY{p}{(}\PY{n}{b}\PY{p}{)}\PY{p}{.}\PY{n}{unwrap}\PY{p}{(}\PY{p}{)}\PY{p}{)}
\PY{+w}{            }\PY{p}{.}\PY{n}{unwrap}\PY{p}{(}\PY{p}{)}\PY{p}{;}

\PY{+w}{        }\PY{k+kd}{let}\PY{+w}{ }\PY{k}{mut}\PY{+w}{ }\PY{n}{chart}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{ChartBuilder}\PY{p}{::}\PY{n}{on}\PY{p}{(}\PY{o}{\PYZam{}}\PY{n}{root}\PY{p}{)}
\PY{+w}{            }\PY{p}{.}\PY{n}{caption}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{Cubic Spline Yield Curve}\PY{l+s}{\PYZdq{}}\PY{p}{,}\PY{+w}{ }\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{sans\PYZhy{}serif}\PY{l+s}{\PYZdq{}}\PY{p}{,}\PY{+w}{ }\PY{l+m+mi}{20}\PY{p}{)}\PY{p}{)}
\PY{+w}{            }\PY{p}{.}\PY{n}{margin}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{)}
\PY{+w}{            }\PY{p}{.}\PY{n}{x\PYZus{}label\PYZus{}area\PYZus{}size}\PY{p}{(}\PY{l+m+mi}{40}\PY{p}{)}
\PY{+w}{            }\PY{p}{.}\PY{n}{y\PYZus{}label\PYZus{}area\PYZus{}size}\PY{p}{(}\PY{l+m+mi}{40}\PY{p}{)}
\PY{+w}{            }\PY{p}{.}\PY{n}{build\PYZus{}cartesian\PYZus{}2d}\PY{p}{(}\PY{n}{min\PYZus{}x}\PY{o}{..}\PY{n}{max\PYZus{}x}\PY{p}{,}\PY{+w}{ }\PY{n}{min\PYZus{}y}\PY{o}{..}\PY{n}{max\PYZus{}y}\PY{p}{)}
\PY{+w}{            }\PY{p}{.}\PY{n}{unwrap}\PY{p}{(}\PY{p}{)}\PY{p}{;}

\PY{+w}{        }\PY{n}{chart}\PY{p}{.}\PY{n}{configure\PYZus{}mesh}\PY{p}{(}\PY{p}{)}\PY{p}{.}\PY{n}{draw}\PY{p}{(}\PY{p}{)}\PY{p}{.}\PY{n}{unwrap}\PY{p}{(}\PY{p}{)}\PY{p}{;}

\PY{+w}{        }\PY{c+c1}{// Compute interpolated values}

\PY{+w}{        }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{x\PYZus{}fine}\PY{p}{:}\PY{+w}{ }\PY{n+nb}{Vec}\PY{o}{\PYZlt{}}\PY{k+kt}{f64}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{p}{(}\PY{l+m+mi}{0}\PY{o}{..}\PY{l+m+mi}{100}\PY{p}{)}
\PY{+w}{            }\PY{p}{.}\PY{n}{map}\PY{p}{(}\PY{o}{|}\PY{n}{i}\PY{o}{|}\PY{+w}{ }\PY{n}{min\PYZus{}x}\PY{+w}{ }\PY{o}{+}\PY{+w}{ }\PY{n}{i}\PY{+w}{ }\PY{k}{as}\PY{+w}{ }\PY{k+kt}{f64}\PY{+w}{ }\PY{o}{*}\PY{+w}{ }\PY{p}{(}\PY{n}{max\PYZus{}x}\PY{+w}{ }\PY{o}{\PYZhy{}}\PY{+w}{ }\PY{n}{min\PYZus{}x}\PY{p}{)}\PY{+w}{ }\PY{o}{/}\PY{+w}{ }\PY{l+m+mf}{99.0}\PY{p}{)}
\PY{+w}{            }\PY{p}{.}\PY{n}{collect}\PY{p}{(}\PY{p}{)}\PY{p}{;}

\PY{+w}{        }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{y\PYZus{}fine}\PY{p}{:}\PY{+w}{ }\PY{n+nb}{Vec}\PY{o}{\PYZlt{}}\PY{k+kt}{f64}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{x\PYZus{}fine}\PY{p}{.}\PY{n}{iter}\PY{p}{(}\PY{p}{)}\PY{p}{.}\PY{n}{map}\PY{p}{(}\PY{o}{|}\PY{o}{\PYZam{}}\PY{n}{t}\PY{o}{|}\PY{+w}{ }\PY{n}{cs}\PY{p}{.}\PY{n}{interpolated\PYZus{}rate}\PY{p}{(}\PY{n}{t}\PY{p}{)}\PY{p}{)}\PY{p}{.}\PY{n}{collect}\PY{p}{(}\PY{p}{)}\PY{p}{;}

\PY{+w}{        }\PY{c+c1}{// Draw the interpolated curve}

\PY{+w}{        }\PY{n}{chart}
\PY{+w}{            }\PY{p}{.}\PY{n}{draw\PYZus{}series}\PY{p}{(}\PY{n}{LineSeries}\PY{p}{::}\PY{n}{new}\PY{p}{(}
\PY{+w}{                }\PY{n}{x\PYZus{}fine}\PY{p}{.}\PY{n}{iter}\PY{p}{(}\PY{p}{)}\PY{p}{.}\PY{n}{zip}\PY{p}{(}\PY{n}{y\PYZus{}fine}\PY{p}{.}\PY{n}{iter}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{.}\PY{n}{map}\PY{p}{(}\PY{o}{|}\PY{p}{(}\PY{o}{\PYZam{}}\PY{n}{x}\PY{p}{,}\PY{+w}{ }\PY{o}{\PYZam{}}\PY{n}{y}\PY{p}{)}\PY{o}{|}\PY{+w}{ }\PY{p}{(}\PY{n}{x}\PY{p}{,}\PY{+w}{ }\PY{n}{y}\PY{p}{)}\PY{p}{)}\PY{p}{,}
\PY{+w}{                }\PY{o}{\PYZam{}}\PY{n}{BLUE}\PY{p}{,}
\PY{+w}{            }\PY{p}{)}\PY{p}{)}
\PY{+w}{            }\PY{p}{.}\PY{n}{unwrap}\PY{p}{(}\PY{p}{)}
\PY{+w}{            }\PY{p}{.}\PY{n}{label}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{Cubic Spline Interpolation}\PY{l+s}{\PYZdq{}}\PY{p}{)}
\PY{+w}{            }\PY{p}{.}\PY{n}{legend}\PY{p}{(}\PY{o}{|}\PY{p}{(}\PY{n}{x}\PY{p}{,}\PY{+w}{ }\PY{n}{y}\PY{p}{)}\PY{o}{|}\PY{+w}{ }\PY{n}{PathElement}\PY{p}{::}\PY{n}{new}\PY{p}{(}\PY{n+nf+fm}{vec!}\PY{p}{[}\PY{p}{(}\PY{n}{x}\PY{p}{,}\PY{+w}{ }\PY{n}{y}\PY{p}{)}\PY{p}{,}\PY{+w}{ }\PY{p}{(}\PY{n}{x}\PY{+w}{ }\PY{o}{+}\PY{+w}{ }\PY{l+m+mi}{20}\PY{p}{,}\PY{+w}{ }\PY{n}{y}\PY{p}{)}\PY{p}{]}\PY{p}{,}\PY{+w}{ }\PY{n}{BLUE}\PY{p}{)}\PY{p}{)}\PY{p}{;}

\PY{+w}{        }\PY{c+c1}{// Draw original data points}

\PY{+w}{        }\PY{n}{chart}
\PY{+w}{            }\PY{p}{.}\PY{n}{draw\PYZus{}series}\PY{p}{(}\PY{n}{PointSeries}\PY{p}{::}\PY{n}{of\PYZus{}element}\PY{p}{(}
\PY{+w}{                }\PY{n}{x\PYZus{}data}\PY{p}{.}\PY{n}{iter}\PY{p}{(}\PY{p}{)}\PY{p}{.}\PY{n}{zip}\PY{p}{(}\PY{n}{y\PYZus{}data}\PY{p}{.}\PY{n}{iter}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{.}\PY{n}{map}\PY{p}{(}\PY{o}{|}\PY{p}{(}\PY{o}{\PYZam{}}\PY{n}{x}\PY{p}{,}\PY{+w}{ }\PY{o}{\PYZam{}}\PY{n}{y}\PY{p}{)}\PY{o}{|}\PY{+w}{ }\PY{p}{(}\PY{n}{x}\PY{p}{,}\PY{+w}{ }\PY{n}{y}\PY{p}{)}\PY{p}{)}\PY{p}{,}
\PY{+w}{                }\PY{l+m+mi}{5}\PY{p}{,}
\PY{+w}{                }\PY{o}{\PYZam{}}\PY{n}{RED}\PY{p}{,}
\PY{+w}{                }\PY{o}{\PYZam{}}\PY{o}{|}\PY{n}{coord}\PY{p}{,}\PY{+w}{ }\PY{n}{size}\PY{p}{,}\PY{+w}{ }\PY{n}{style}\PY{o}{|}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{                    }\PY{n}{EmptyElement}\PY{p}{::}\PY{n}{at}\PY{p}{(}\PY{n}{coord}\PY{p}{)}\PY{+w}{ }\PY{o}{+}\PY{+w}{ }\PY{n}{Circle}\PY{p}{::}\PY{n}{new}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,}\PY{+w}{ }\PY{l+m+mi}{0}\PY{p}{)}\PY{p}{,}\PY{+w}{ }\PY{n}{size}\PY{p}{,}\PY{+w}{ }\PY{n}{style}\PY{p}{.}\PY{n}{filled}\PY{p}{(}\PY{p}{)}\PY{p}{)}
\PY{+w}{                }\PY{p}{\PYZcb{}}\PY{p}{,}
\PY{+w}{            }\PY{p}{)}\PY{p}{)}
\PY{+w}{            }\PY{p}{.}\PY{n}{unwrap}\PY{p}{(}\PY{p}{)}
\PY{+w}{            }\PY{p}{.}\PY{n}{label}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{Original Data Points}\PY{l+s}{\PYZdq{}}\PY{p}{)}
\PY{+w}{            }\PY{p}{.}\PY{n}{legend}\PY{p}{(}\PY{o}{|}\PY{p}{(}\PY{n}{x}\PY{p}{,}\PY{+w}{ }\PY{n}{y}\PY{p}{)}\PY{o}{|}\PY{+w}{ }\PY{n}{Circle}\PY{p}{::}\PY{n}{new}\PY{p}{(}\PY{p}{(}\PY{n}{x}\PY{p}{,}\PY{+w}{ }\PY{n}{y}\PY{p}{)}\PY{p}{,}\PY{+w}{ }\PY{l+m+mi}{5}\PY{p}{,}\PY{+w}{ }\PY{n}{RED}\PY{p}{)}\PY{p}{)}\PY{p}{;}

\PY{+w}{        }\PY{n}{chart}
\PY{+w}{            }\PY{p}{.}\PY{n}{configure\PYZus{}series\PYZus{}labels}\PY{p}{(}\PY{p}{)}
\PY{+w}{            }\PY{p}{.}\PY{n}{border\PYZus{}style}\PY{p}{(}\PY{n}{BLACK}\PY{p}{)}
\PY{+w}{            }\PY{p}{.}\PY{n}{draw}\PY{p}{(}\PY{p}{)}
\PY{+w}{            }\PY{p}{.}\PY{n}{unwrap}\PY{p}{(}\PY{p}{)}\PY{p}{;}

\PY{+w}{        }\PY{n+nb}{Ok}\PY{p}{(}\PY{p}{(}\PY{p}{)}\PY{p}{)}
\PY{+w}{    }\PY{p}{\PYZcb{}}\PY{p}{)}
\PY{p}{\PYZcb{}}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{plot\PYZus{}yield\PYZus{}curve}\PY{p}{(}\PY{o}{\PYZam{}}\PY{n}{cs}\PY{p}{,}\PY{+w}{ }\PY{o}{\PYZam{}}\PY{n}{x}\PY{p}{,}\PY{+w}{ }\PY{o}{\PYZam{}}\PY{n}{y}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    We can see that the cubic spline interpolation passes through the
existing points, and smoothly curves in the interpolation.

    \subsection{b)}\label{b}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{cs}\PY{p}{.}\PY{n}{interpolated\PYZus{}rate}\PY{p}{(}\PY{l+m+mf}{4.0}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
0.0284960517181817
\end{Verbatim}
\end{tcolorbox}
        
    \section{Problem 3}\label{problem-3}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{use}\PY{+w}{ }\PY{n}{argmin}\PY{p}{:}\PY{p}{:}\PY{p}{\PYZob{}}
\PY{+w}{    }\PY{n}{core}\PY{p}{:}\PY{p}{:}\PY{p}{\PYZob{}}\PY{n}{CostFunction}\PY{p}{,}\PY{+w}{ }\PY{n}{Executor}\PY{p}{\PYZcb{}}\PY{p}{,}
\PY{+w}{    }\PY{n}{solver}\PY{p}{::}\PY{n}{neldermead}\PY{p}{::}\PY{n}{NelderMead}\PY{p}{,}
\PY{p}{\PYZcb{}}\PY{p}{;}

\PY{k}{use}\PY{+w}{ }\PY{n}{itertools}\PY{p}{::}\PY{n}{izip}\PY{p}{;}

\PY{k}{use}\PY{+w}{ }\PY{n}{plotters}\PY{p}{::}\PY{n}{prelude}\PY{p}{:}\PY{p}{:}\PY{o}{*}\PY{p}{;}

\PY{k}{use}\PY{+w}{ }\PY{n}{polars}\PY{p}{::}\PY{n}{prelude}\PY{p}{:}\PY{p}{:}\PY{o}{*}\PY{p}{;}
\end{Verbatim}
\end{tcolorbox}

    Initialize data.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{98}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kd}{let}\PY{+w}{ }\PY{n}{df}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{df}\PY{o}{!}\PY{p}{(}
\PY{+w}{    }\PY{l+s}{\PYZdq{}}\PY{l+s}{time to next payment}\PY{l+s}{\PYZdq{}}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{p}{[}\PY{l+m+mf}{0.4356}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.2644}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.2658}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.4342}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.0192}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.4753}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.3534}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.1000}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.2685}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.4342}\PY{p}{,}
\PY{+w}{                               }\PY{l+m+mf}{0.2274}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.1027}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.2712}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.4370}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.4822}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.2260}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.4822}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.2260}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.2301}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.4808}\PY{p}{,}
\PY{+w}{                               }\PY{l+m+mf}{0.4932}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.4959}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.2397}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.4959}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.2397}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.4959}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.2397}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.2438}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.4945}\PY{p}{]}\PY{p}{,}
\PY{+w}{    }\PY{l+s}{\PYZdq{}}\PY{l+s}{payment frequency}\PY{l+s}{\PYZdq{}}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{p}{[}\PY{l+m+mf}{0.5}\PY{p}{;}\PY{+w}{ }\PY{l+m+mi}{29}\PY{p}{]}\PY{p}{,}
\PY{+w}{    }\PY{l+s}{\PYZdq{}}\PY{l+s}{time to maturity}\PY{l+s}{\PYZdq{}}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{p}{[}\PY{l+m+mf}{0.4356}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.7644}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{1.2658}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{1.9342}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{2.0192}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{2.9753}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{3.3534}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{3.6000}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{4.2685}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{4.9342}\PY{p}{,}
\PY{+w}{                           }\PY{l+m+mf}{5.2274}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{5.6027}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{6.2712}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{6.9370}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{7.4822}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{7.7260}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{8.4822}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{8.7260}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{9.2301}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{9.9808}\PY{p}{,}
\PY{+w}{                           }\PY{l+m+mf}{25.4932}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{26.4959}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{26.7397}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{27.4959}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{27.7397}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{28.4959}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{28.7397}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{29.2438}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{29.9945}\PY{p}{]}\PY{p}{,}
\PY{+w}{    }\PY{l+s}{\PYZdq{}}\PY{l+s}{coupon rate}\PY{l+s}{\PYZdq{}}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{p}{[}\PY{l+m+mf}{0.0078}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.0078}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.0065}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.0053}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.0028}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.0065}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.0140}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.0165}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.0203}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.0165}\PY{p}{,}
\PY{+w}{                      }\PY{l+m+mf}{0.0440}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.0228}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.0265}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.0228}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.0340}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.0378}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.0265}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.0303}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.0328}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.0253}\PY{p}{,}
\PY{+w}{                      }\PY{l+m+mf}{0.0440}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.0465}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.0490}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.0428}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.0440}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.0340}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.0415}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.0428}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{0.0378}\PY{p}{]}\PY{p}{,}
\PY{+w}{    }\PY{l+s}{\PYZdq{}}\PY{l+s}{clean price}\PY{l+s}{\PYZdq{}}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{p}{[}\PY{l+m+mf}{100.30}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{100.48}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{100.50}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{100.31}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{99.78}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{100.16}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{102.34}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{103.08}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{104.19}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{102.06}\PY{p}{,}
\PY{+w}{                      }\PY{l+m+mf}{115.91}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{104.36}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{105.86}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{102.97}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{110.53}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{113.09}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{103.98}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{106.50}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{108.00}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{101.19}\PY{p}{,}
\PY{+w}{                      }\PY{l+m+mf}{117.58}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{122.28}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{126.97}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{115.19}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{117.47}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{98.98}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{112.44}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{114.67}\PY{p}{,}\PY{+w}{ }\PY{l+m+mf}{105.75}\PY{p}{]}
\PY{p}{)}\PY{o}{?}\PY{p}{;}

\PY{n}{LaTeXDataFrame}\PY{p}{(}\PY{n}{df}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}
 
            
\prompt{Out}{outcolor}{98}{}
    
    \begin{tabularx}{\textwidth}{|*5{p{\dimexpr\textwidth/5-2\tabcolsep\relax}|}}
\hlinetime to next payment & payment frequency & time to maturity & coupon rate & clean price \\
\hline
0.4356 & 0.5000 & 0.4356 & 0.0078 & 100.3000 \\
\hline
0.2644 & 0.5000 & 0.7644 & 0.0078 & 100.4800 \\
\hline
0.2658 & 0.5000 & 1.2658 & 0.0065 & 100.5000 \\
\hline
0.4342 & 0.5000 & 1.9342 & 0.0053 & 100.3100 \\
\hline
0.0192 & 0.5000 & 2.0192 & 0.0028 & 99.7800 \\
\hline
0.4753 & 0.5000 & 2.9753 & 0.0065 & 100.1600 \\
\hline
0.3534 & 0.5000 & 3.3534 & 0.0140 & 102.3400 \\
\hline
0.1000 & 0.5000 & 3.6000 & 0.0165 & 103.0800 \\
\hline
0.2685 & 0.5000 & 4.2685 & 0.0203 & 104.1900 \\
\hline
0.4342 & 0.5000 & 4.9342 & 0.0165 & 102.0600 \\
\hline
0.2274 & 0.5000 & 5.2274 & 0.0440 & 115.9100 \\
\hline
0.1027 & 0.5000 & 5.6027 & 0.0228 & 104.3600 \\
\hline
0.2712 & 0.5000 & 6.2712 & 0.0265 & 105.8600 \\
\hline
0.4370 & 0.5000 & 6.9370 & 0.0228 & 102.9700 \\
\hline
0.4822 & 0.5000 & 7.4822 & 0.0340 & 110.5300 \\
\hline
0.2260 & 0.5000 & 7.7260 & 0.0378 & 113.0900 \\
\hline
0.4822 & 0.5000 & 8.4822 & 0.0265 & 103.9800 \\
\hline
0.2260 & 0.5000 & 8.7260 & 0.0303 & 106.5000 \\
\hline
0.2301 & 0.5000 & 9.2301 & 0.0328 & 108.0000 \\
\hline
0.4808 & 0.5000 & 9.9808 & 0.0253 & 101.1900 \\
\hline
0.4932 & 0.5000 & 25.4932 & 0.0440 & 117.5800 \\
\hline
0.4959 & 0.5000 & 26.4959 & 0.0465 & 122.2800 \\
\hline
0.2397 & 0.5000 & 26.7397 & 0.0490 & 126.9700 \\
\hline
0.4959 & 0.5000 & 27.4959 & 0.0428 & 115.1900 \\
\hline
0.2397 & 0.5000 & 27.7397 & 0.0440 & 117.4700 \\
\hline
0.4959 & 0.5000 & 28.4959 & 0.0340 & 98.9800 \\
\hline
0.2397 & 0.5000 & 28.7397 & 0.0415 & 112.4400 \\
\hline
0.2438 & 0.5000 & 29.2438 & 0.0428 & 114.6700 \\
\hline
0.4945 & 0.5000 & 29.9945 & 0.0378 & 105.7500 \\
\hline
\end{tabularx}

    

    We'll have some initial constants for when we begin to optimize our
Nelson-Siegel model.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{99}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{const}\PY{+w}{ }\PY{n}{INIT\PYZus{}BETA\PYZus{}0}\PY{p}{:}\PY{+w}{ }\PY{k+kt}{f64}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{l+m+mf}{0.03}\PY{p}{;}
\PY{k}{const}\PY{+w}{ }\PY{n}{INIT\PYZus{}BETA\PYZus{}1}\PY{p}{:}\PY{+w}{ }\PY{k+kt}{f64}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.02}\PY{p}{;}
\PY{k}{const}\PY{+w}{ }\PY{n}{INIT\PYZus{}BETA\PYZus{}2}\PY{p}{:}\PY{+w}{ }\PY{k+kt}{f64}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{l+m+mf}{0.02}\PY{p}{;}
\PY{k}{const}\PY{+w}{ }\PY{n}{INIT\PYZus{}LAMBDA}\PY{p}{:}\PY{+w}{ }\PY{k+kt}{f64}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{l+m+mf}{1.0}\PY{p}{;}
\PY{k}{const}\PY{+w}{ }\PY{n}{P}\PY{p}{:}\PY{+w}{ }\PY{k+kt}{f64}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{l+m+mf}{100.0}\PY{p}{;}
\end{Verbatim}
\end{tcolorbox}

    Before we run Nelson-Siegel, we need to add some extra columns that we
will need for our calculations.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{100}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kd}{let}\PY{+w}{ }\PY{n}{coupon\PYZus{}payment}\PY{+w}{ }\PY{o}{=}
\PY{+w}{    }\PY{p}{(}\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{coupon rate}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{+w}{ }\PY{o}{*}\PY{+w}{ }\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{payment frequency}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{+w}{ }\PY{o}{*}\PY{+w}{ }\PY{n}{lit}\PY{p}{(}\PY{n}{P}\PY{p}{)}\PY{p}{)}\PY{p}{.}\PY{n}{alias}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{coupon payment}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{;}

\PY{k+kd}{let}\PY{+w}{ }\PY{n}{dirty\PYZus{}price}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{p}{(}\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{clean price}\PY{l+s}{\PYZdq{}}\PY{p}{)}
\PY{+w}{    }\PY{o}{+}\PY{+w}{ }\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{coupon payment}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{+w}{ }\PY{o}{*}\PY{+w}{ }\PY{p}{(}\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{payment frequency}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{+w}{ }\PY{o}{\PYZhy{}}\PY{+w}{ }\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{time to next payment}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
\PY{+w}{        }\PY{o}{/}\PY{+w}{ }\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{payment frequency}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
\PY{p}{.}\PY{n}{alias}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{dirty price}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{;}

\PY{k+kd}{let}\PY{+w}{ }\PY{n}{num\PYZus{}remaining\PYZus{}payments}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{p}{(}\PY{p}{(}\PY{p}{(}\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{time to maturity}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{+w}{ }\PY{o}{/}\PY{+w}{ }\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{payment frequency}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{p}{.}\PY{n}{floor}\PY{p}{(}\PY{p}{)}
\PY{+w}{    }\PY{o}{+}\PY{+w}{ }\PY{n}{lit}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)}
\PY{p}{.}\PY{n}{cast}\PY{p}{(}\PY{n}{DataType}\PY{p}{::}\PY{n}{Int32}\PY{p}{)}\PY{p}{)}
\PY{p}{.}\PY{n}{alias}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{num remaining payments}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{;}

\PY{k+kd}{let}\PY{+w}{ }\PY{n}{weight}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{lit}\PY{p}{(}\PY{l+m+mf}{1.0}\PY{p}{)}\PY{p}{.}\PY{n}{alias}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{weight}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{;}

\PY{k+kd}{let}\PY{+w}{ }\PY{n}{df}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{df}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{.}\PY{n}{lazy}\PY{p}{(}\PY{p}{)}\PY{p}{.}\PY{n}{with\PYZus{}column}\PY{p}{(}\PY{n}{coupon\PYZus{}payment}\PY{p}{)}\PY{p}{.}\PY{n}{collect}\PY{p}{(}\PY{p}{)}\PY{o}{?}\PY{p}{;}

\PY{k+kd}{let}\PY{+w}{ }\PY{n}{df}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{df}
\PY{+w}{    }\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}
\PY{+w}{    }\PY{p}{.}\PY{n}{lazy}\PY{p}{(}\PY{p}{)}
\PY{+w}{    }\PY{p}{.}\PY{n}{with\PYZus{}columns}\PY{p}{(}\PY{n+nf+fm}{vec!}\PY{p}{[}
\PY{+w}{        }\PY{n}{dirty\PYZus{}price}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{,}
\PY{+w}{        }\PY{n}{num\PYZus{}remaining\PYZus{}payments}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{,}
\PY{+w}{        }\PY{n}{weight}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{,}
\PY{+w}{    }\PY{p}{]}\PY{p}{)}
\PY{+w}{    }\PY{p}{.}\PY{n}{collect}\PY{p}{(}\PY{p}{)}\PY{o}{?}\PY{p}{;}

\PY{n}{LaTeXDataFrame}\PY{p}{(}\PY{n}{df}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}
 
            
\prompt{Out}{outcolor}{100}{}
    
    \begin{tabularx}{\textwidth}{|*9{p{\dimexpr\textwidth/9-2\tabcolsep\relax}|}}
\hlinetime to next payment & payment frequency & time to maturity & coupon rate & clean price & coupon payment & dirty price & num remaining payments & weight \\
\hline
0.4356 & 0.5000 & 0.4356 & 0.0078 & 100.3000 & 0.3900 & 100.3502 & 1 & 1.0000 \\
\hline
0.2644 & 0.5000 & 0.7644 & 0.0078 & 100.4800 & 0.3900 & 100.6638 & 2 & 1.0000 \\
\hline
0.2658 & 0.5000 & 1.2658 & 0.0065 & 100.5000 & 0.3250 & 100.6522 & 3 & 1.0000 \\
\hline
0.4342 & 0.5000 & 1.9342 & 0.0053 & 100.3100 & 0.2650 & 100.3449 & 4 & 1.0000 \\
\hline
0.0192 & 0.5000 & 2.0192 & 0.0028 & 99.7800 & 0.1400 & 99.9146 & 5 & 1.0000 \\
\hline
0.4753 & 0.5000 & 2.9753 & 0.0065 & 100.1600 & 0.3250 & 100.1761 & 6 & 1.0000 \\
\hline
0.3534 & 0.5000 & 3.3534 & 0.0140 & 102.3400 & 0.7000 & 102.5452 & 7 & 1.0000 \\
\hline
0.1000 & 0.5000 & 3.6000 & 0.0165 & 103.0800 & 0.8250 & 103.7400 & 8 & 1.0000 \\
\hline
0.2685 & 0.5000 & 4.2685 & 0.0203 & 104.1900 & 1.0150 & 104.6599 & 9 & 1.0000 \\
\hline
0.4342 & 0.5000 & 4.9342 & 0.0165 & 102.0600 & 0.8250 & 102.1686 & 10 & 1.0000 \\
\hline
0.2274 & 0.5000 & 5.2274 & 0.0440 & 115.9100 & 2.2000 & 117.1094 & 11 & 1.0000 \\
\hline
0.1027 & 0.5000 & 5.6027 & 0.0228 & 104.3600 & 1.1400 & 105.2658 & 12 & 1.0000 \\
\hline
0.2712 & 0.5000 & 6.2712 & 0.0265 & 105.8600 & 1.3250 & 106.4663 & 13 & 1.0000 \\
\hline
0.4370 & 0.5000 & 6.9370 & 0.0228 & 102.9700 & 1.1400 & 103.1136 & 14 & 1.0000 \\
\hline
0.4822 & 0.5000 & 7.4822 & 0.0340 & 110.5300 & 1.7000 & 110.5905 & 15 & 1.0000 \\
\hline
0.2260 & 0.5000 & 7.7260 & 0.0378 & 113.0900 & 1.8900 & 114.1257 & 16 & 1.0000 \\
\hline
0.4822 & 0.5000 & 8.4822 & 0.0265 & 103.9800 & 1.3250 & 104.0272 & 17 & 1.0000 \\
\hline
0.2260 & 0.5000 & 8.7260 & 0.0303 & 106.5000 & 1.5150 & 107.3302 & 18 & 1.0000 \\
\hline
0.2301 & 0.5000 & 9.2301 & 0.0328 & 108.0000 & 1.6400 & 108.8853 & 19 & 1.0000 \\
\hline
0.4808 & 0.5000 & 9.9808 & 0.0253 & 101.1900 & 1.2650 & 101.2386 & 20 & 1.0000 \\
\hline
0.4932 & 0.5000 & 25.4932 & 0.0440 & 117.5800 & 2.2000 & 117.6099 & 51 & 1.0000 \\
\hline
0.4959 & 0.5000 & 26.4959 & 0.0465 & 122.2800 & 2.3250 & 122.2991 & 53 & 1.0000 \\
\hline
0.2397 & 0.5000 & 26.7397 & 0.0490 & 126.9700 & 2.4500 & 128.2455 & 54 & 1.0000 \\
\hline
0.4959 & 0.5000 & 27.4959 & 0.0428 & 115.1900 & 2.1400 & 115.2075 & 55 & 1.0000 \\
\hline
0.2397 & 0.5000 & 27.7397 & 0.0440 & 117.4700 & 2.2000 & 118.6153 & 56 & 1.0000 \\
\hline
0.4959 & 0.5000 & 28.4959 & 0.0340 & 98.9800 & 1.7000 & 98.9939 & 57 & 1.0000 \\
\hline
0.2397 & 0.5000 & 28.7397 & 0.0415 & 112.4400 & 2.0750 & 113.5202 & 58 & 1.0000 \\
\hline
0.2438 & 0.5000 & 29.2438 & 0.0428 & 114.6700 & 2.1400 & 115.7665 & 59 & 1.0000 \\
\hline
0.4945 & 0.5000 & 29.9945 & 0.0378 & 105.7500 & 1.8900 & 105.7708 & 60 & 1.0000 \\
\hline
\end{tabularx}

    

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]

\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
shape: (29, 9)
┌────────────┬────────────┬────────────┬────────┬───┬────────────┬────────────┬─
──────────┬────────┐
│ time to    ┆ payment    ┆ time to    ┆ coupon ┆ … ┆ coupon     ┆ dirty      ┆
num       ┆ weight │
│ next       ┆ frequency  ┆ maturity   ┆ rate   ┆   ┆ payment    ┆ price      ┆
remaining ┆ ---    │
│ payment    ┆ ---        ┆ ---        ┆ ---    ┆   ┆ ---        ┆ ---        ┆
payments  ┆ f64    │
│ ---        ┆ f64        ┆ f64        ┆ f64    ┆   ┆ f64        ┆ f64        ┆
---       ┆        │
│ f64        ┆            ┆            ┆        ┆   ┆            ┆            ┆
i32       ┆        │
╞════════════╪════════════╪════════════╪════════╪═══╪════════════╪════════════╪═
══════════╪════════╡
│ 0.4356     ┆ 0.5        ┆ 0.4356     ┆ 0.0078 ┆ … ┆ 0.39       ┆ 100.350232 ┆
1         ┆ 1.0    │
│ 0.2644     ┆ 0.5        ┆ 0.7644     ┆ 0.0078 ┆ … ┆ 0.39       ┆ 100.663768 ┆
2         ┆ 1.0    │
│ 0.2658     ┆ 0.5        ┆ 1.2658     ┆ 0.0065 ┆ … ┆ 0.325      ┆ 100.65223  ┆
3         ┆ 1.0    │
│ 0.4342     ┆ 0.5        ┆ 1.9342     ┆ 0.0053 ┆ … ┆ 0.265      ┆ 100.344874 ┆
4         ┆ 1.0    │
│ 0.0192     ┆ 0.5        ┆ 2.0192     ┆ 0.0028 ┆ … ┆ 0.14       ┆ 99.914624  ┆
5         ┆ 1.0    │
│ …          ┆ …          ┆ …          ┆ …      ┆ … ┆ …          ┆ …          ┆
…         ┆ …      │
│ 0.2397     ┆ 0.5        ┆ 27.7397    ┆ 0.044  ┆ … ┆ 2.2        ┆ 118.61532  ┆
56        ┆ 1.0    │
│ 0.4959     ┆ 0.5        ┆ 28.4959    ┆ 0.034  ┆ … ┆ 1.7        ┆ 98.99394   ┆
57        ┆ 1.0    │
│ 0.2397     ┆ 0.5        ┆ 28.7397    ┆ 0.0415 ┆ … ┆ 2.075      ┆ 113.520245 ┆
58        ┆ 1.0    │
│ 0.2438     ┆ 0.5        ┆ 29.2438    ┆ 0.0428 ┆ … ┆ 2.14       ┆ 115.766536 ┆
59        ┆ 1.0    │
│ 0.4945     ┆ 0.5        ┆ 29.9945    ┆ 0.0378 ┆ … ┆ 1.89       ┆ 105.77079  ┆
60        ┆ 1.0    │
└────────────┴────────────┴────────────┴────────┴───┴────────────┴────────────┴─
──────────┴────────┘
\end{Verbatim}
\end{tcolorbox}
        
    We'll define the rate function as:
\[ R(0, t) = \beta_0 + \beta_1 \left(\frac{1 - e^{-\lambda t}}{\lambda t}\right) + \beta_2 \left(\frac{1 - e^{-\lambda t}}{\lambda t} - e^{-\lambda t}\right)\]

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{101}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{fn}\PY{+w}{ }\PY{n+nf}{r}\PY{p}{(}\PY{n}{beta\PYZus{}0}\PY{p}{:}\PY{+w}{ }\PY{k+kt}{f64}\PY{p}{,}\PY{+w}{ }\PY{n}{beta\PYZus{}1}\PY{p}{:}\PY{+w}{ }\PY{k+kt}{f64}\PY{p}{,}\PY{+w}{ }\PY{n}{beta\PYZus{}2}\PY{p}{:}\PY{+w}{ }\PY{k+kt}{f64}\PY{p}{,}\PY{+w}{ }\PY{n}{lambda}\PY{p}{:}\PY{+w}{ }\PY{k+kt}{f64}\PY{p}{,}\PY{+w}{ }\PY{n}{t}\PY{p}{:}\PY{+w}{ }\PY{k+kt}{f64}\PY{p}{)}\PY{+w}{ }\PY{p}{\PYZhy{}\PYZgt{}}\PY{+w}{ }\PY{k+kt}{f64}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{    }\PY{n}{beta\PYZus{}0}
\PY{+w}{        }\PY{o}{+}\PY{+w}{ }\PY{n}{beta\PYZus{}1}\PY{+w}{ }\PY{o}{*}\PY{+w}{ }\PY{p}{(}\PY{p}{(}\PY{l+m+mf}{1.0}\PY{+w}{ }\PY{o}{\PYZhy{}}\PY{+w}{ }\PY{p}{(}\PY{o}{\PYZhy{}}\PY{n}{lambda}\PY{+w}{ }\PY{o}{*}\PY{+w}{ }\PY{n}{t}\PY{p}{)}\PY{p}{.}\PY{n}{exp}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{+w}{ }\PY{o}{/}\PY{+w}{ }\PY{p}{(}\PY{n}{lambda}\PY{+w}{ }\PY{o}{*}\PY{+w}{ }\PY{n}{t}\PY{p}{)}\PY{p}{)}
\PY{+w}{        }\PY{o}{+}\PY{+w}{ }\PY{n}{beta\PYZus{}2}\PY{+w}{ }\PY{o}{*}\PY{+w}{ }\PY{p}{(}\PY{p}{(}\PY{l+m+mf}{1.0}\PY{+w}{ }\PY{o}{\PYZhy{}}\PY{+w}{ }\PY{p}{(}\PY{o}{\PYZhy{}}\PY{n}{lambda}\PY{+w}{ }\PY{o}{*}\PY{+w}{ }\PY{n}{t}\PY{p}{)}\PY{p}{.}\PY{n}{exp}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{+w}{ }\PY{o}{/}\PY{+w}{ }\PY{p}{(}\PY{n}{lambda}\PY{+w}{ }\PY{o}{*}\PY{+w}{ }\PY{n}{t}\PY{p}{)}\PY{+w}{ }\PY{o}{\PYZhy{}}\PY{+w}{ }\PY{p}{(}\PY{o}{\PYZhy{}}\PY{n}{lambda}\PY{+w}{ }\PY{o}{*}\PY{+w}{ }\PY{n}{t}\PY{p}{)}\PY{p}{.}\PY{n}{exp}\PY{p}{(}\PY{p}{)}\PY{p}{)}
\PY{p}{\PYZcb{}}
\end{Verbatim}
\end{tcolorbox}

    And store the dataframe of bond information in a struct, so we can
implement optimization on it.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{102}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+cp}{\PYZsh{}[}\PY{c+cp}{derive(Clone, Default)}\PY{c+cp}{]}

\PY{k}{struct}\PY{+w}{ }\PY{n+nc}{NelsonSiegel}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{    }\PY{n}{df}\PY{p}{:}\PY{+w}{ }\PY{n+nc}{DataFrame}\PY{p}{,}
\PY{p}{\PYZcb{}}
\end{Verbatim}
\end{tcolorbox}

    In our optimizer, we need to calculate the theoretical price using our
rate function and discounting each payoff.

\[\hat{B} = \sum_{i=1}^m \left[e^{-r(0, t_i) \cdot t_i} \cdot c\right] + e^{-r(0, t_m) \cdot t_m} \cdot P\]

We want to find \(\beta_0\), \(\beta_1\), \(\beta_2\), and \(\lambda\)
that minimizes

\[\sum_{i=1}^N w_i (\hat{B_i} - B_i)^2\]

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{impl}\PY{+w}{ }\PY{n}{CostFunction}\PY{+w}{ }\PY{k}{for}\PY{+w}{ }\PY{n}{NelsonSiegel}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{    }\PY{k}{type}\PY{+w}{ }\PY{n+nc}{Param}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n+nb}{Vec}\PY{o}{\PYZlt{}}\PY{k+kt}{f64}\PY{o}{\PYZgt{}}\PY{p}{;}

\PY{+w}{    }\PY{k}{type}\PY{+w}{ }\PY{n+nc}{Output}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{k+kt}{f64}\PY{p}{;}

\PY{+w}{    }\PY{k}{fn}\PY{+w}{ }\PY{n+nf}{cost}\PY{p}{(}\PY{o}{\PYZam{}}\PY{n+nb+bp}{self}\PY{p}{,}\PY{+w}{ }\PY{n}{param}\PY{p}{:}\PY{+w}{ }\PY{k+kp}{\PYZam{}}\PY{n+nc}{Self}\PY{p}{::}\PY{n}{Param}\PY{p}{)}\PY{+w}{ }\PY{p}{\PYZhy{}\PYZgt{}}\PY{+w}{ }\PY{n+nb}{Result}\PY{o}{\PYZlt{}}\PY{n+nb+bp}{Self}\PY{p}{::}\PY{n}{Output}\PY{p}{,}\PY{+w}{ }\PY{n}{argmin\PYZus{}math}\PY{p}{::}\PY{n}{Error}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{        }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{beta\PYZus{}0}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{param}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{;}

\PY{+w}{        }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{beta\PYZus{}1}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{param}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{;}

\PY{+w}{        }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{beta\PYZus{}2}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{param}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{]}\PY{p}{;}

\PY{+w}{        }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{lambda}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{param}\PY{p}{[}\PY{l+m+mi}{3}\PY{p}{]}\PY{p}{;}

\PY{+w}{        }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{lf}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n+nb+bp}{self}\PY{p}{.}\PY{n}{df}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{.}\PY{n}{lazy}\PY{p}{(}\PY{p}{)}\PY{p}{.}\PY{n}{with\PYZus{}column}\PY{p}{(}
\PY{+w}{            }\PY{n}{map\PYZus{}multiple}\PY{p}{(}
\PY{+w}{                }\PY{k}{move}\PY{+w}{ }\PY{o}{|}\PY{n}{cols}\PY{o}{|}\PY{+w}{ }\PY{k}{match}\PY{+w}{ }\PY{n}{cols}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{                    }\PY{p}{[}\PY{n}{a}\PY{p}{,}\PY{+w}{ }\PY{n}{b}\PY{p}{,}\PY{+w}{ }\PY{n}{c}\PY{p}{,}\PY{+w}{ }\PY{n}{d}\PY{p}{,}\PY{+w}{ }\PY{n}{e}\PY{p}{]}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{                        }\PY{k+kd}{let}\PY{+w}{ }\PY{p}{(}\PY{n}{a}\PY{p}{,}\PY{+w}{ }\PY{n}{b}\PY{p}{,}\PY{+w}{ }\PY{n}{c}\PY{p}{,}\PY{+w}{ }\PY{n}{d}\PY{p}{,}\PY{+w}{ }\PY{n}{e}\PY{p}{)}\PY{+w}{ }\PY{o}{=}
\PY{+w}{                            }\PY{p}{(}\PY{n}{a}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{,}\PY{+w}{ }\PY{n}{b}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{,}\PY{+w}{ }\PY{n}{c}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{,}\PY{+w}{ }\PY{n}{d}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{,}\PY{+w}{ }\PY{n}{e}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{;}

\PY{+w}{                        }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{num\PYZus{}remaining\PYZus{}payments}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{a}\PY{p}{.}\PY{k+kt}{i32}\PY{p}{(}\PY{p}{)}\PY{o}{?}\PY{p}{;}

\PY{+w}{                        }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{time\PYZus{}to\PYZus{}next\PYZus{}payment}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{b}\PY{p}{.}\PY{k+kt}{f64}\PY{p}{(}\PY{p}{)}\PY{o}{?}\PY{p}{;}

\PY{+w}{                        }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{time\PYZus{}to\PYZus{}maturity}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{c}\PY{p}{.}\PY{k+kt}{f64}\PY{p}{(}\PY{p}{)}\PY{o}{?}\PY{p}{;}

\PY{+w}{                        }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{coupon\PYZus{}payment}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{d}\PY{p}{.}\PY{k+kt}{f64}\PY{p}{(}\PY{p}{)}\PY{o}{?}\PY{p}{;}

\PY{+w}{                        }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{payment\PYZus{}frequency}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{e}\PY{p}{.}\PY{k+kt}{f64}\PY{p}{(}\PY{p}{)}\PY{o}{?}\PY{p}{;}

\PY{+w}{                        }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{res}\PY{p}{:}\PY{+w}{ }\PY{n+nc}{Float64Chunked}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{izip}\PY{o}{!}\PY{p}{(}
\PY{+w}{                            }\PY{n}{num\PYZus{}remaining\PYZus{}payments}\PY{p}{,}
\PY{+w}{                            }\PY{n}{time\PYZus{}to\PYZus{}next\PYZus{}payment}\PY{p}{,}
\PY{+w}{                            }\PY{n}{time\PYZus{}to\PYZus{}maturity}\PY{p}{,}
\PY{+w}{                            }\PY{n}{coupon\PYZus{}payment}\PY{p}{,}
\PY{+w}{                            }\PY{n}{payment\PYZus{}frequency}
\PY{+w}{                        }\PY{p}{)}
\PY{+w}{                        }\PY{c+c1}{// calculate theoretical price}
\PY{+w}{                        }\PY{p}{.}\PY{n}{map}\PY{p}{(}\PY{o}{|}\PY{p}{(}\PY{n}{m}\PY{p}{,}\PY{+w}{ }\PY{n}{t1}\PY{p}{,}\PY{+w}{ }\PY{n}{tm}\PY{p}{,}\PY{+w}{ }\PY{n}{c}\PY{p}{,}\PY{+w}{ }\PY{n}{dt}\PY{p}{)}\PY{o}{|}\PY{+w}{ }\PY{k}{match}\PY{+w}{ }\PY{p}{(}\PY{n}{m}\PY{p}{,}\PY{+w}{ }\PY{n}{t1}\PY{p}{,}\PY{+w}{ }\PY{n}{tm}\PY{p}{,}\PY{+w}{ }\PY{n}{c}\PY{p}{,}\PY{+w}{ }\PY{n}{dt}\PY{p}{)}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{                            }\PY{c+c1}{// coupon payments}
\PY{+w}{                            }\PY{p}{(}\PY{n+nb}{Some}\PY{p}{(}\PY{n}{m}\PY{p}{)}\PY{p}{,}\PY{+w}{ }\PY{n+nb}{Some}\PY{p}{(}\PY{n}{t1}\PY{p}{)}\PY{p}{,}\PY{+w}{ }\PY{n+nb}{Some}\PY{p}{(}\PY{n}{tm}\PY{p}{)}\PY{p}{,}\PY{+w}{ }\PY{n+nb}{Some}\PY{p}{(}\PY{n}{c}\PY{p}{)}\PY{p}{,}\PY{+w}{ }\PY{n+nb}{Some}\PY{p}{(}\PY{n}{dt}\PY{p}{)}\PY{p}{)}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{n+nb}{Some}\PY{p}{(}
\PY{+w}{                                }\PY{p}{(}\PY{l+m+mi}{1}\PY{o}{..=}\PY{n}{m}\PY{p}{)}\PY{p}{.}\PY{n}{map}\PY{p}{(}\PY{o}{|}\PY{n}{i}\PY{o}{|}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{                                    }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{t}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{t1}\PY{+w}{ }\PY{o}{+}\PY{+w}{ }\PY{p}{(}\PY{n}{i}\PY{+w}{ }\PY{k}{as}\PY{+w}{ }\PY{k+kt}{f64}\PY{+w}{ }\PY{o}{\PYZhy{}}\PY{+w}{ }\PY{l+m+mf}{1.0}\PY{p}{)}\PY{+w}{ }\PY{o}{*}\PY{+w}{ }\PY{n}{dt}\PY{p}{;}
\PY{+w}{                                    }\PY{p}{(}\PY{o}{\PYZhy{}}\PY{n}{r}\PY{p}{(}\PY{n}{beta\PYZus{}0}\PY{p}{,}\PY{+w}{ }\PY{n}{beta\PYZus{}1}\PY{p}{,}\PY{+w}{ }\PY{n}{beta\PYZus{}2}\PY{p}{,}\PY{+w}{ }\PY{n}{lambda}\PY{p}{,}\PY{+w}{ }\PY{n}{t}\PY{p}{)}\PY{+w}{ }\PY{o}{*}\PY{+w}{ }\PY{n}{t}\PY{p}{)}\PY{p}{.}\PY{n}{exp}\PY{p}{(}\PY{p}{)}\PY{+w}{ }\PY{o}{*}\PY{+w}{ }\PY{n}{c}
\PY{+w}{                                }\PY{p}{\PYZcb{}}\PY{p}{)}
\PY{+w}{                                }\PY{p}{.}\PY{n}{sum}\PY{p}{:}\PY{p}{:}\PY{o}{\PYZlt{}}\PY{k+kt}{f64}\PY{o}{\PYZgt{}}\PY{p}{(}\PY{p}{)}

\PY{+w}{                                }\PY{c+c1}{// add principal}
\PY{+w}{                                }\PY{o}{+}\PY{+w}{ }\PY{p}{(}\PY{o}{\PYZhy{}}\PY{n}{r}\PY{p}{(}\PY{n}{beta\PYZus{}0}\PY{p}{,}\PY{+w}{ }\PY{n}{beta\PYZus{}1}\PY{p}{,}\PY{+w}{ }\PY{n}{beta\PYZus{}2}\PY{p}{,}\PY{+w}{ }\PY{n}{lambda}\PY{p}{,}\PY{+w}{ }\PY{n}{tm}\PY{p}{)}\PY{+w}{ }\PY{o}{*}\PY{+w}{ }\PY{n}{tm}\PY{p}{)}\PY{p}{.}\PY{n}{exp}\PY{p}{(}\PY{p}{)}
\PY{+w}{                                    }\PY{o}{*}\PY{+w}{ }\PY{n}{P}\PY{p}{,}
\PY{+w}{                            }\PY{p}{)}\PY{p}{,}

\PY{+w}{                            }\PY{n}{\PYZus{}}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{n+nb}{None}\PY{p}{,}
\PY{+w}{                        }\PY{p}{\PYZcb{}}\PY{p}{)}
\PY{+w}{                        }\PY{p}{.}\PY{n}{collect}\PY{p}{(}\PY{p}{)}\PY{p}{;}

\PY{+w}{                        }\PY{n+nb}{Ok}\PY{p}{(}\PY{n+nb}{Some}\PY{p}{(}\PY{n}{res}\PY{p}{.}\PY{n}{into\PYZus{}column}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\PY{+w}{                    }\PY{p}{\PYZcb{}}

\PY{+w}{                    }\PY{n}{\PYZus{}}\PY{+w}{ }\PY{o}{=}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{n+nb}{Err}\PY{p}{(}\PY{n}{PolarsError}\PY{p}{::}\PY{n}{ComputeError}\PY{p}{(}
\PY{+w}{                        }\PY{l+s}{\PYZdq{}}\PY{l+s}{Expected exactly 5 columns}\PY{l+s}{\PYZdq{}}\PY{p}{.}\PY{n}{into}\PY{p}{(}\PY{p}{)}\PY{p}{,}
\PY{+w}{                    }\PY{p}{)}\PY{p}{)}\PY{p}{,}
\PY{+w}{                }\PY{p}{\PYZcb{}}\PY{p}{,}
\PY{+w}{                }\PY{o}{\PYZam{}}\PY{p}{[}
\PY{+w}{                    }\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{num remaining payments}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{+w}{                    }\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{time to next payment}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{+w}{                    }\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{time to maturity}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{+w}{                    }\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{coupon payment}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{+w}{                    }\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{payment frequency}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{+w}{                }\PY{p}{]}\PY{p}{,}
\PY{+w}{                }\PY{n}{GetOutput}\PY{p}{::}\PY{n}{from\PYZus{}type}\PY{p}{(}\PY{n}{DataType}\PY{p}{::}\PY{n}{Float64}\PY{p}{)}\PY{p}{,}
\PY{+w}{            }\PY{p}{)}
\PY{+w}{            }\PY{p}{.}\PY{n}{alias}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{theoretical price}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{,}
\PY{+w}{        }\PY{p}{)}\PY{p}{;}

\PY{+w}{        }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{cost\PYZus{}expr}\PY{+w}{ }\PY{o}{=}
\PY{+w}{            }\PY{p}{(}\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{dirty price}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{+w}{ }\PY{o}{\PYZhy{}}\PY{+w}{ }\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{theoretical price}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{p}{.}\PY{n}{pow}\PY{p}{(}\PY{l+m+mf}{2.0}\PY{p}{)}\PY{+w}{ }\PY{o}{*}\PY{+w}{ }\PY{n}{col}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{weight}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{;}

\PY{+w}{        }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{cost\PYZus{}df}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{lf}\PY{p}{.}\PY{n}{select}\PY{p}{(}\PY{p}{[}\PY{n}{cost\PYZus{}expr}\PY{p}{.}\PY{n}{sum}\PY{p}{(}\PY{p}{)}\PY{p}{.}\PY{n}{alias}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{cost}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{p}{]}\PY{p}{)}\PY{p}{.}\PY{n}{collect}\PY{p}{(}\PY{p}{)}\PY{o}{?}\PY{p}{;}

\PY{+w}{        }\PY{k+kd}{let}\PY{+w}{ }\PY{n}{cost}\PY{p}{:}\PY{+w}{ }\PY{k+kt}{f64}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{cost\PYZus{}df}\PY{p}{.}\PY{n}{column}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{cost}\PY{l+s}{\PYZdq{}}\PY{p}{)}\PY{o}{?}\PY{p}{.}\PY{k+kt}{f64}\PY{p}{(}\PY{p}{)}\PY{o}{?}\PY{p}{.}\PY{n}{get}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{)}\PY{p}{.}\PY{n}{unwrap}\PY{p}{(}\PY{p}{)}\PY{p}{;}

\PY{+w}{        }\PY{n+nb}{Ok}\PY{p}{(}\PY{n}{cost}\PY{p}{)}
\PY{+w}{    }\PY{p}{\PYZcb{}}
\PY{p}{\PYZcb{}}
\end{Verbatim}
\end{tcolorbox}

    We'll be using Nelder-Mead for optimization, because it only requires a
cost function. We will begin by constructing our simplex for it, then
creating the solver, then executing it.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{105}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kd}{let}\PY{+w}{ }\PY{n}{nelson\PYZus{}siegel}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{NelsonSiegel}\PY{+w}{ }\PY{p}{\PYZob{}}\PY{+w}{ }\PY{n}{df}\PY{p}{:}\PY{+w}{ }\PY{n+nc}{df}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{+w}{ }\PY{p}{\PYZcb{}}\PY{p}{;}

\PY{k+kd}{let}\PY{+w}{ }\PY{n}{initial\PYZus{}params}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n+nf+fm}{vec!}\PY{p}{[}\PY{n}{INIT\PYZus{}BETA\PYZus{}0}\PY{p}{,}\PY{+w}{ }\PY{n}{INIT\PYZus{}BETA\PYZus{}1}\PY{p}{,}\PY{+w}{ }\PY{n}{INIT\PYZus{}BETA\PYZus{}2}\PY{p}{,}\PY{+w}{ }\PY{n}{INIT\PYZus{}LAMBDA}\PY{p}{]}\PY{p}{;}

\PY{k+kd}{let}\PY{+w}{ }\PY{n}{perturbation}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{l+m+mf}{0.1}\PY{p}{;}

\PY{k+kd}{let}\PY{+w}{ }\PY{k}{mut}\PY{+w}{ }\PY{n}{simplex}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n+nf+fm}{vec!}\PY{p}{[}\PY{n}{initial\PYZus{}params}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{]}\PY{p}{;}

\PY{k}{for}\PY{+w}{ }\PY{n}{i}\PY{+w}{ }\PY{k}{in}\PY{+w}{ }\PY{l+m+mi}{0}\PY{o}{..}\PY{n}{initial\PYZus{}params}\PY{p}{.}\PY{n}{len}\PY{p}{(}\PY{p}{)}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{    }\PY{k+kd}{let}\PY{+w}{ }\PY{k}{mut}\PY{+w}{ }\PY{n}{new\PYZus{}vertex}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{initial\PYZus{}params}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{;}

\PY{+w}{    }\PY{n}{new\PYZus{}vertex}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{+w}{ }\PY{o}{+}\PY{o}{=}\PY{+w}{ }\PY{n}{perturbation}\PY{p}{;}

\PY{+w}{    }\PY{n}{simplex}\PY{p}{.}\PY{n}{push}\PY{p}{(}\PY{n}{new\PYZus{}vertex}\PY{p}{)}\PY{p}{;}
\PY{p}{\PYZcb{}}

\PY{k+kd}{let}\PY{+w}{ }\PY{n}{solver}\PY{p}{:}\PY{+w}{ }\PY{n+nc}{NelderMead}\PY{o}{\PYZlt{}}\PY{n+nb}{Vec}\PY{o}{\PYZlt{}}\PY{k+kt}{f64}\PY{o}{\PYZgt{}}\PY{p}{,}\PY{+w}{ }\PY{k+kt}{f64}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{NelderMead}\PY{p}{::}\PY{n}{new}\PY{p}{(}\PY{n}{simplex}\PY{p}{)}\PY{p}{.}\PY{n}{with\PYZus{}sd\PYZus{}tolerance}\PY{p}{(}\PY{l+m+mf}{1e\PYZhy{}10}\PY{p}{)}\PY{o}{?}\PY{p}{;}

\PY{k+kd}{let}\PY{+w}{ }\PY{n}{res}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{Executor}\PY{p}{::}\PY{n}{new}\PY{p}{(}\PY{n}{nelson\PYZus{}siegel}\PY{p}{,}\PY{+w}{ }\PY{n}{solver}\PY{p}{)}\PY{p}{.}\PY{n}{run}\PY{p}{(}\PY{p}{)}\PY{p}{.}\PY{n}{unwrap}\PY{p}{(}\PY{p}{)}\PY{p}{;}

\PY{k+kd}{let}\PY{+w}{ }\PY{n}{state}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{res}\PY{p}{.}\PY{n}{state}\PY{p}{(}\PY{p}{)}\PY{p}{.}\PY{n}{param}\PY{p}{.}\PY{n}{clone}\PY{p}{(}\PY{p}{)}\PY{p}{.}\PY{n}{unwrap}\PY{p}{(}\PY{p}{)}\PY{p}{;}

\PY{k+kd}{let}\PY{+w}{ }\PY{n}{beta\PYZus{}0}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{state}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{;}

\PY{k+kd}{let}\PY{+w}{ }\PY{n}{beta\PYZus{}1}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{state}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{;}

\PY{k+kd}{let}\PY{+w}{ }\PY{n}{beta\PYZus{}2}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{state}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{]}\PY{p}{;}

\PY{k+kd}{let}\PY{+w}{ }\PY{n}{lambda}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{state}\PY{p}{[}\PY{l+m+mi}{3}\PY{p}{]}\PY{p}{;}

\PY{p}{(}\PY{n}{beta\PYZus{}0}\PY{p}{,}\PY{+w}{ }\PY{n}{beta\PYZus{}1}\PY{p}{,}\PY{+w}{ }\PY{n}{beta\PYZus{}2}\PY{p}{,}\PY{+w}{ }\PY{n}{lambda}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
thread '<unnamed>' panicked at C:\textbackslash{}Users\textbackslash{}shaason\textbackslash{}.cargo\textbackslash{}registry\textbackslash{}src\textbackslash{}index.crates
.io-6f17d22bba15001f\textbackslash{}argmin-0.10.0\textbackslash{}src\textbackslash{}solver\textbackslash{}neldermead\textbackslash{}mod.rs:334:53:
called `Result::unwrap()` on an `Err` value: not found: num\_remaining\_payments

Resolved plan until failure:

        ---> FAILED HERE RESOLVING 'select' <---
DF ["time to next payment", "payment frequency", "time to maturity", "coupon
rate"]; PROJECT */9 COLUMNS

Stack backtrace:
   0: std::backtrace\_rs::backtrace::dbghelp64::trace
             at /rustc/e71f9a9a98b0faf423844bf0ba7438f29dc27d58\textbackslash{}library/std\textbackslash{}src\textbackslash{}
..\textbackslash{}..\textbackslash{}backtrace\textbackslash{}src\textbackslash{}backtrace\textbackslash{}dbghelp64.rs:91
   1: std::backtrace\_rs::backtrace::trace\_unsynchronized
             at /rustc/e71f9a9a98b0faf423844bf0ba7438f29dc27d58\textbackslash{}library/std\textbackslash{}src\textbackslash{}
..\textbackslash{}..\textbackslash{}backtrace\textbackslash{}src\textbackslash{}backtrace\textbackslash{}mod.rs:66
   2: std::backtrace::Backtrace::create
             at
/rustc/e71f9a9a98b0faf423844bf0ba7438f29dc27d58\textbackslash{}library/std\textbackslash{}src\textbackslash{}backtrace.rs:331
   3: std::backtrace::Backtrace::capture
             at
/rustc/e71f9a9a98b0faf423844bf0ba7438f29dc27d58\textbackslash{}library/std\textbackslash{}src\textbackslash{}backtrace.rs:296
   4: <unknown>
   5: <unknown>
   6: <unknown>
   7: <unknown>
   8: <unknown>
   9: <unknown>
  10: <unknown>
  11: <unknown>
  12: <unknown>
  13: <unknown>
  14: <unknown>
  15: BaseThreadInitThunk
  16: RtlUserThreadStart
stack backtrace:
   0: std::panicking::begin\_panic\_handler
             at
/rustc/e71f9a9a98b0faf423844bf0ba7438f29dc27d58\textbackslash{}library/std\textbackslash{}src\textbackslash{}panicking.rs:665
   1: core::panicking::panic\_fmt
             at
/rustc/e71f9a9a98b0faf423844bf0ba7438f29dc27d58\textbackslash{}library/core\textbackslash{}src\textbackslash{}panicking.rs:76
   2: core::result::unwrap\_failed
             at
/rustc/e71f9a9a98b0faf423844bf0ba7438f29dc27d58\textbackslash{}library/core\textbackslash{}src\textbackslash{}result.rs:1699
   3: <unknown>
   4: <unknown>
   5: <unknown>
   6: <unknown>
   7: <unknown>
   8: <unknown>
   9: <unknown>
  10: <unknown>
  11: BaseThreadInitThunk
  12: RtlUserThreadStart
note: Some details are omitted, run with `RUST\_BACKTRACE=full` for a verbose
backtrace.
    \end{Verbatim}

    Now we will plot the yield curve generated by the Nelson-Siegel model.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{96}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kd}{let}\PY{+w}{ }\PY{n}{t\PYZus{}values}\PY{p}{:}\PY{+w}{ }\PY{n+nb}{Vec}\PY{o}{\PYZlt{}}\PY{k+kt}{f64}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{p}{(}\PY{l+m+mi}{5}\PY{o}{..=}\PY{l+m+mi}{300}\PY{p}{)}\PY{p}{.}\PY{n}{map}\PY{p}{(}\PY{o}{|}\PY{n}{x}\PY{o}{|}\PY{+w}{ }\PY{n}{x}\PY{+w}{ }\PY{k}{as}\PY{+w}{ }\PY{k+kt}{f64}\PY{+w}{ }\PY{o}{/}\PY{+w}{ }\PY{l+m+mf}{10.0}\PY{p}{)}\PY{p}{.}\PY{n}{collect}\PY{p}{(}\PY{p}{)}\PY{p}{;}

\PY{k+kd}{let}\PY{+w}{ }\PY{n}{yield\PYZus{}values}\PY{p}{:}\PY{+w}{ }\PY{n+nb}{Vec}\PY{o}{\PYZlt{}}\PY{k+kt}{f64}\PY{o}{\PYZgt{}}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{t\PYZus{}values}
\PY{+w}{    }\PY{p}{.}\PY{n}{iter}\PY{p}{(}\PY{p}{)}
\PY{+w}{    }\PY{p}{.}\PY{n}{map}\PY{p}{(}\PY{o}{|}\PY{o}{\PYZam{}}\PY{n}{t}\PY{o}{|}\PY{+w}{ }\PY{n}{r}\PY{p}{(}\PY{n}{beta\PYZus{}0}\PY{p}{,}\PY{+w}{ }\PY{n}{beta\PYZus{}1}\PY{p}{,}\PY{+w}{ }\PY{n}{beta\PYZus{}2}\PY{p}{,}\PY{+w}{ }\PY{n}{lambda}\PY{p}{,}\PY{+w}{ }\PY{n}{t}\PY{p}{)}\PY{p}{)}
\PY{+w}{    }\PY{p}{.}\PY{n}{collect}\PY{p}{(}\PY{p}{)}\PY{p}{;}

\PY{n}{my\PYZus{}evcxr\PYZus{}figure}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{800}\PY{p}{,}\PY{+w}{ }\PY{l+m+mi}{600}\PY{p}{)}\PY{p}{,}\PY{+w}{ }\PY{o}{|}\PY{n}{root}\PY{o}{|}\PY{+w}{ }\PY{p}{\PYZob{}}
\PY{+w}{    }\PY{n}{root}\PY{p}{.}\PY{n}{fill}\PY{p}{(}\PY{o}{\PYZam{}}\PY{n}{WHITE}\PY{p}{)}\PY{p}{.}\PY{n}{unwrap}\PY{p}{(}\PY{p}{)}\PY{p}{;}

\PY{+w}{    }\PY{k+kd}{let}\PY{+w}{ }\PY{k}{mut}\PY{+w}{ }\PY{n}{chart}\PY{+w}{ }\PY{o}{=}\PY{+w}{ }\PY{n}{ChartBuilder}\PY{p}{::}\PY{n}{on}\PY{p}{(}\PY{o}{\PYZam{}}\PY{n}{root}\PY{p}{)}
\PY{+w}{        }\PY{p}{.}\PY{n}{caption}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{Yield Curve (Nelson\PYZhy{}Siegel)}\PY{l+s}{\PYZdq{}}\PY{p}{,}\PY{+w}{ }\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{sans\PYZhy{}serif}\PY{l+s}{\PYZdq{}}\PY{p}{,}\PY{+w}{ }\PY{l+m+mi}{25}\PY{p}{)}\PY{p}{)}
\PY{+w}{        }\PY{p}{.}\PY{n}{margin}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{)}
\PY{+w}{        }\PY{p}{.}\PY{n}{x\PYZus{}label\PYZus{}area\PYZus{}size}\PY{p}{(}\PY{l+m+mi}{40}\PY{p}{)}
\PY{+w}{        }\PY{p}{.}\PY{n}{y\PYZus{}label\PYZus{}area\PYZus{}size}\PY{p}{(}\PY{l+m+mi}{50}\PY{p}{)}
\PY{+w}{        }\PY{p}{.}\PY{n}{build\PYZus{}cartesian\PYZus{}2d}\PY{p}{(}\PY{l+m+mf}{0.}\PY{l+m+mi}{0}\PY{o}{..}\PY{l+m+mf}{30.0}\PY{p}{,}\PY{+w}{ }\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.}\PY{l+m+mi}{0}\PY{o}{..}\PY{l+m+mf}{0.05}\PY{p}{)}
\PY{+w}{        }\PY{p}{.}\PY{n}{unwrap}\PY{p}{(}\PY{p}{)}\PY{p}{;}

\PY{+w}{    }\PY{n}{chart}\PY{p}{.}\PY{n}{configure\PYZus{}mesh}\PY{p}{(}\PY{p}{)}\PY{p}{.}\PY{n}{draw}\PY{p}{(}\PY{p}{)}\PY{p}{.}\PY{n}{unwrap}\PY{p}{(}\PY{p}{)}\PY{p}{;}

\PY{+w}{    }\PY{c+c1}{// Plot the yield curve}

\PY{+w}{    }\PY{n}{chart}
\PY{+w}{        }\PY{p}{.}\PY{n}{draw\PYZus{}series}\PY{p}{(}\PY{n}{LineSeries}\PY{p}{::}\PY{n}{new}\PY{p}{(}
\PY{+w}{            }\PY{n}{t\PYZus{}values}
\PY{+w}{                }\PY{p}{.}\PY{n}{iter}\PY{p}{(}\PY{p}{)}
\PY{+w}{                }\PY{p}{.}\PY{n}{zip}\PY{p}{(}\PY{n}{yield\PYZus{}values}\PY{p}{.}\PY{n}{iter}\PY{p}{(}\PY{p}{)}\PY{p}{)}
\PY{+w}{                }\PY{p}{.}\PY{n}{map}\PY{p}{(}\PY{o}{|}\PY{p}{(}\PY{o}{\PYZam{}}\PY{n}{t}\PY{p}{,}\PY{+w}{ }\PY{o}{\PYZam{}}\PY{n}{y}\PY{p}{)}\PY{o}{|}\PY{+w}{ }\PY{p}{(}\PY{n}{t}\PY{p}{,}\PY{+w}{ }\PY{n}{y}\PY{p}{)}\PY{p}{)}\PY{p}{,}
\PY{+w}{            }\PY{o}{\PYZam{}}\PY{n}{BLUE}\PY{p}{,}
\PY{+w}{        }\PY{p}{)}\PY{p}{)}
\PY{+w}{        }\PY{p}{.}\PY{n}{unwrap}\PY{p}{(}\PY{p}{)}
\PY{+w}{        }\PY{p}{.}\PY{n}{label}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{Yield}\PY{l+s}{\PYZdq{}}\PY{p}{)}
\PY{+w}{        }\PY{p}{.}\PY{n}{legend}\PY{p}{(}\PY{o}{|}\PY{p}{(}\PY{n}{x}\PY{p}{,}\PY{+w}{ }\PY{n}{y}\PY{p}{)}\PY{o}{|}\PY{+w}{ }\PY{n}{PathElement}\PY{p}{::}\PY{n}{new}\PY{p}{(}\PY{n+nf+fm}{vec!}\PY{p}{[}\PY{p}{(}\PY{n}{x}\PY{p}{,}\PY{+w}{ }\PY{n}{y}\PY{p}{)}\PY{p}{,}\PY{+w}{ }\PY{p}{(}\PY{n}{x}\PY{+w}{ }\PY{o}{+}\PY{+w}{ }\PY{l+m+mi}{20}\PY{p}{,}\PY{+w}{ }\PY{n}{y}\PY{p}{)}\PY{p}{]}\PY{p}{,}\PY{+w}{ }\PY{n}{BLUE}\PY{p}{)}\PY{p}{)}\PY{p}{;}

\PY{+w}{    }\PY{c+c1}{// Configure the legend}

\PY{+w}{    }\PY{n}{chart}
\PY{+w}{        }\PY{p}{.}\PY{n}{configure\PYZus{}series\PYZus{}labels}\PY{p}{(}\PY{p}{)}
\PY{+w}{        }\PY{p}{.}\PY{n}{background\PYZus{}style}\PY{p}{(}\PY{n}{WHITE}\PY{p}{)}
\PY{+w}{        }\PY{p}{.}\PY{n}{draw}\PY{p}{(}\PY{p}{)}
\PY{+w}{        }\PY{p}{.}\PY{n}{unwrap}\PY{p}{(}\PY{p}{)}\PY{p}{;}

\PY{+w}{    }\PY{n+nb}{Ok}\PY{p}{(}\PY{p}{(}\PY{p}{)}\PY{p}{)}
\PY{p}{\PYZcb{}}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}, frame=single, framerule=2mm, rulecolor=\color{outerrorbackground}]
\textcolor{ansi-red}{[E0425] Error:} cannot find value `beta\_0` in this scope
   \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{╭}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{[}command\_96:1:1\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{]}
   \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{│}
 \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{5 │} \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{.}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{m}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{a}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{p}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{(}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{|}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{\&}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{t}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{|}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{r}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{(}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{b}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{e}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{t}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{a}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{\_}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{0}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{,}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{b}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{e}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{t}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{a}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{\_}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{1}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{,}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{b}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{e}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{t}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{a}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{\_}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{2}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{,}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{l}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{a}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{m}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{b}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{d}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{a}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{,}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{t}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{)}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{)}
 \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{88,88,88}}{  │}                 \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{┬}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}  
 \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{88,88,88}}{  │}                    \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{╰}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─} not found in this scope
\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{───╯}
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}, frame=single, framerule=2mm, rulecolor=\color{outerrorbackground}]
\textcolor{ansi-red}{[E0425] Error:} cannot find value `beta\_1` in this scope
   \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{╭}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{[}command\_96:1:1\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{]}
   \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{│}
 \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{5 │} \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{.}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{m}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{a}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{p}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{(}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{|}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{\&}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{t}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{|}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{r}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{(}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{b}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{e}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{t}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{a}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{\_}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{0}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{,}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{b}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{e}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{t}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{a}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{\_}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{1}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{,}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{b}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{e}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{t}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{a}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{\_}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{2}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{,}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{l}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{a}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{m}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{b}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{d}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{a}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{,}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{t}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{)}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{)}
 \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{88,88,88}}{  │}                         \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{┬}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}  
 \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{88,88,88}}{  │}                            \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{╰}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─} not found in this scope
\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{───╯}
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}, frame=single, framerule=2mm, rulecolor=\color{outerrorbackground}]
\textcolor{ansi-red}{[E0425] Error:} cannot find value `beta\_2` in this scope
   \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{╭}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{[}command\_96:1:1\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{]}
   \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{│}
 \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{5 │} \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{.}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{m}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{a}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{p}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{(}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{|}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{\&}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{t}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{|}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{r}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{(}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{b}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{e}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{t}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{a}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{\_}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{0}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{,}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{b}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{e}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{t}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{a}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{\_}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{1}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{,}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{b}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{e}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{t}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{a}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{\_}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{2}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{,}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{l}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{a}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{m}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{b}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{d}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{a}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{,}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{t}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{)}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{)}
 \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{88,88,88}}{  │}                                 \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{┬}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}  
 \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{88,88,88}}{  │}                                    \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{╰}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─} not found in this scope
\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{───╯}
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}, frame=single, framerule=2mm, rulecolor=\color{outerrorbackground}]
\textcolor{ansi-red}{[E0425] Error:} cannot find value `lambda` in this scope
   \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{╭}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{[}command\_96:1:1\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{]}
   \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{│}
 \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{5 │} \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{.}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{m}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{a}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{p}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{(}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{|}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{\&}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{t}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{|}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{r}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{(}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{b}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{e}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{t}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{a}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{\_}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{0}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{,}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{b}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{e}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{t}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{a}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{\_}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{1}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{,}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{b}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{e}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{t}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{a}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{\_}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{2}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{,}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{l}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{a}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{m}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{b}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{d}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{a}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{,}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{ }\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{t}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{)}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{178,178,178}}{)}
 \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{88,88,88}}{  │}                                         \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{┬}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}  
 \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{88,88,88}}{  │}                                            \def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{╰}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─}\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{95,0,135}}{─} not found in this scope
\def\tcRGB{\textcolor[RGB]}\expandafter\tcRGB\expandafter{\detokenize{148,148,148}}{───╯}
    \end{Verbatim}


    % Add a bibliography block to the postdoc
    
    
    
\end{document}
